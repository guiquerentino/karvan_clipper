* SISTEMA MICRO-PE€AS 2000
* AUTOR:= MARCELO FRANCISCO QUERENTINO
* DATA INICIO := 05/03/99
* DATA ULTIMA ATUALIZA€ÇO:= 30/06/02 º 26/03/03   

RUN NET TIME \\SERVIDOR /SET /YES
NUMREG=3 
SET TALK OFF
SET SCOR OFF
SET STAT OFF
SET CENT OFF
SET DELI OFF
SET DELE ON
SET DATE TO BRIT
SET WRAP ON
SET CURS ON
SET MESS TO 23 CENTER
FREETSLICE(20)
OL_AutoYield(.t.)
REQUEST DBFCDX
RDDSETDEFAULT("DBFCDX")
DBSETDRIVER("DBFCDX")
# INCLUDE "FILEIO.CH"

****************************** PARAMETROS ************************************

DINICIO=DATE() && DATA INICIO P/ CONSULTA
DFINAL=DATE() && DATA FINAL P/ CONSULTA
LIN=01 && LINHA P/ IMPRESSÃO
TOT=0
ACESSO=0  && CONTROLA O ACESSO AO SISTEMA
PUBLIC OK && LIBERA O TESTE CNPJ/CPF 
OK=.f.
PUBLIC NFABRQTD
MVALENTREG=0
NFABRQTD=0
PUBLIC MTAXAT
PUBLIC MTAXAS
PUBLIC MMSG1
PUBLIC MMSG2
PUBLIC MMSG3
PUBLIC MMSG4
PUBLIC MMSG5
PUBLIC ETIQ_EST
PUBLIC MMSG6
PUBLIC DESCONTO
PUBLIC MCODPECA
PUBLIC MABATIMENTO
PUBLIC MTROCO
PUBLIC MNOTPAG
PUBLIC XPTOTG
PUBLIC FUNCIONARIO
PUBLIC CONPED
PUBLIC MNCM
PUBLIC MCFOP
PUBLIC MQTDANTIGO
PUBLIC MCEST
PUBLIC TEXTO
PUBLIC VENDACUSTO
PUBLIC MPTOTG
PUBLIC CONTSAIDA
PUBLIC VIA
PUBLIC MV_CREDITO
PUBLIC MCLICRE
PUBLIC TOTDESC
PUBLIC MNOTFUNC
PUBLIC MEMPRESA
PUBLIC CONTZEBRA
PUBLIC NOMEZEBRA
PUBLIC LINZEBRA
PUBLIC MP_CUSTO
PUBLIC MQTDFIS
PUBLIC FISAPK
PUBLIC CNPJ
PUBLIC RUNORCA
PUBLIC NTX
RUNORCA=0
MTROCO=0
FUNCIONARIO=SPACE(10)
CONPED=0
NTX=1
ETIQ_EST="N"
NOMEZEBRA=1
MEMPRESA=SPACE(1)
VIA=1
MPTOTG=0
VENDACUSTO=0
MABATIMENTO=0
TESTATIME="00:01:00"
CONT=110
PUBLIC RDISTRIB
PUBLIC VARIA
PUBLIC VARI
PUBLIC VARDIG
PUBLIC MCODCRE
PRIVATE MSG_TEL:="11-97615-2800"
RDISTRIB=SPACE(20)
CODCLI=0
NOMECLI=SPACE(35)
V_DESCR:=SPACE(20)
V_BUSCA:=SPACE(20)
V_APLIC:=SPACE(15)

DESC1="N"
PUBLIC CRED1
CRED1="N"
&& TESTANDO SE A REDE ESTA FUNCIONANDO 

IF ! FILE("d:\karvan\KARVAN.EXE")
       RUN NET USE D: \\SERVIDOR\D /YES
       IF ! FILE("d:\karvan\KARVAN.EXE")
                OL_Yield()
                ALERT('REDE NAO DISPONIVEL, TENTE MAIS TARDE')
                CLS
                CLOSE ALL
                BREAK
       ENDIF
ENDIF

IF .NOT. FILE ("PEDIDO.DBF")
        DBFPEDIDO()
ENDIF

PEDIDOEX()
IF LASTREC()>0
        ALERT('EXISTE OUTRA TELA DE PEDIDO ABERTO, FINALIZE E TENTE NOVAMENTE')
        ACESSO()
        IF ACESSO=1 
                PEDIDOEX()
                ZAP
             ELSE
                CLS
                CLOSE ALL
                BREAK
        ENDIF
ENDIF        

SELE 1
PECAS()
SELE 2
FISCAL()

SELE 2
MFISCAL=FISCAL
IF DAY(DATE())>=05 .AND. MFISCAL#1
        BLOQUEIO()
        REPLACE FISCAL WITH 1
        UNLOCK
ENDIF 

MFISCAL=FISCAL
IF DAY(DATE())=01 .OR. DAY(DATE())=02 .OR. DAY(DATE())=03 .OR. DAY(DATE())=04
        IF MFISCAL=1
                SELE 2
                BLOQUEIO()
                REPLACE FISCAL WITH 0
                UNLOCK
                DBCOMMIT()
                SELE 1
                DO WHILE ! EOF()
                        BLOQUEIO()
                        REPLACE QTDMAX3 WITH QTDMAX2
                        REPLACE QTDMAX2 WITH QTDMAX1
                        REPLACE QTDMAX1 WITH QTDMAX
                        REPLACE QTDMAX  WITH 0
                        UNLOCK
                        SKIP
                ENDDO
       ENDIF
ENDIF

SELE 1
INDEX ON NOMEPECA TO TEMP

DADOS2()
MTAXAT=TAXAT
MTAXAS=TAXAS
MCONTSAIDA=CONTSAIDA
MMSG1=""
*MSG1
MMSG2=""
*MSG2
MMSG3=""
*MSG3
MMSG4=""
*MSG4
MMSG5=""
*MSG5
MMSG6=""
*MSG6

TESTAIMP()

CLS

IF .NOT. FILE ("D:\KARVAN\CONFERE\CONFERE.DBF")
        DBFCONFERE()
ENDIF

IF .NOT. FILE ("D:\KARVAN\DEVOLCRE.DBF")
        DEVOLCREDBF()
ENDIF

IF .NOT. FILE ("C:\KARVAN\DEVTEMP.DBF")
        DEVTEMPDBF()
ENDIF

IF .NOT. FILE ("C:\TEMP\PEDIDO.DBF")
        DBFPEDORCA()
ENDIF    
IF .NOT. FILE("d:\karvan\ENDERECO.CDX")
        REINENDE()
ENDIF

IF .NOT. FILE("d:\karvan\PEDCUP.CDX")
        REINPEDC()
ENDIF
IF .NOT. FILE("d:\karvan\DEVOLCRE.CDX")
        REINDECRE()
ENDIF            
IF .NOT. FILE("d:\karvan\PAGAMENTO.CDX")
        REINPAGA()
ENDIF
IF .NOT. FILE("D:\KARVAN\PECAS.CDX")
        REINPECA()
ENDIF

IF .NOT. FILE("d:\karvan\IBPT.CDX")
        REINIBPT()
ENDIF

IF .NOT. FILE("d:\karvan\CEST.CDX")
        REINCEST()
ENDIF

IF .NOT. FILE ("d:\karvan\CUPOM.CDX")
        REINCUPO()
ENDIF
IF .NOT. FILE ("d:\karvan\ENVIADOS.CDX")
        REINENVIA()
ENDIF


IF .NOT. FILE ("d:\karvan\ENTREGA.CDX")
        REINENTR()
ENDIF
IF .NOT. FILE("d:\karvan\CLIENTES.CDX")
        REINCLIE()
ENDIF
IF .NOT. FILE("d:\karvan\CHEQUE.CDX")
        REINCHE()
ENDIF
IF .NOT. FILE ("d:\karvan\ROTA.CDX")
        REINROTA()
ENDIF
IF .NOT. FILE ("d:\karvan\ENTRADA.CDX")
        REINENTRADA()
ENDIF
IF .NOT. FILE ("d:\karvan\REL_ENTR.CDX")
        REINRELE()
ENDIF           
IF .NOT. FILE ("d:\karvan\GARANTIA.CDX")
        REINGARA()
ENDIF

IF .NOT. FILE("d:\karvan\FORNEC.CDX")
        REINFORN()
ENDIF   
IF .NOT. FILE("d:\karvan\NOTAS.CDX")
        REINNOTA()
ENDIF   

IF .NOT. FILE ("d:\karvan\FUNC.CDX")
        REINFUNC()
ENDIF
IF .NOT. FILE ("d:\karvan\DEVOLUCAO.CDX")
        REINDEVOL()
ENDIF
IF .NOT. FILE ("d:\karvan\MOTOBOY.CDX")
        REINMOTO()
ENDIF           
IF .NOT. FILE ("d:\karvan\ENTR_CLI.CDX")
        RENTRCLI()
ENDIF

DO WHILE .T.
    SETCOLOR("W+/B+,N/W")
    CLS
    CLOSE ALL
    MCAD=0
    CONT=110
    CONPEC=1
    REIM=0
    SEPARA=0
    CONFERE="N"
    ENTREGA="N"
    KEYBOARD CHR(0)
    
    SET KEY -04 TO CALC()    // F5        
    SET KEY -41 TO CONVENDA() // F12

    KEYNORMAL()
    @ 00,00 TO 02,79 DOUBLE
    @ 22,00 TO 24,79 DOUBLE
    @ 00,03 SAY " SISTEMA MICRO-PE€AS 2007 " 
    DADOS2()
    @ 01,02 SAY RSOCIAL
    @ 23,02 SAY "Mensagem.:"
    @ 23,68 SAY TIME()
    @ 01,40 SAY CIDADE+","
    @ 01,56 SAY STR(DAY(DATE()))+" "+"de"
    @ 01,63 SAY CMONTH(DATE())+STR(YEAR(DATE()))
    SETCOLOR("/W")
    @ 03,00 CLEAR TO 21,79
    @ 05,05 SAY REPL ("²",70)
    SETCOLOR("N/W")
    @ 21,01 SAY PADC("F1=SENHA    F7=SAIDA    F8=CHEGADA    F9=ENTREGAS    F10=RELATORIO",78)
    SETCOLOR("/B+")
    @ 04,01 CLEAR TO 04,78
    SETCOLOR("W+/B+,N/W")
    *DADOS2()
    @ 04,04 PROMPT "CADASTRO"    MESS "CADASTRO DE DADOS "
    @ 04,17 PROMPT "DEVOL/CRED." MESS "DEVOLUCOES COM CREDITO"
    @ 04,31 PROMPT "PEDIDO"      MESS "EMITE CUPOM DE OR€AMENTO"
    @ 04,42 PROMPT "MANUTEN€AO"  MESS "PESQUISA DE REGISTROS "
    @ 04,55 PROMPT "UTILITARIOS" MESS "UTILITARIOS DO SISTEMA "
    @ 04,70 PROMPT "SAIR"        MESS "VOLTA AO SISTEMA OPERACIONAL"
    SAVE SCREEN TO FTELA   
    TMOTO()
        DO WHILE .T.
            INKEY(0.01)
            IF LASTKEY() <> 0
                TECLA=LASTKEY()
                KEYBOARD CHR(TECLA)
                KEYBOARD CHR(TECLA)
                KEYBOARD CHR(TECLA)

                MENU TO OP
       
                DO CASE
                      CASE OP == 1                
                           KEYOTARIOS()                 
                           CADASTRO()
                      CASE OP == 2                
                           KEYOTARIOS()
                           USE C:\KARVAN\DEVTEMP
                           ZAP
                           OP=01
                           @ 06,18 CLEAR TO 10,33
                           @ 06,18 TO 10,33 DOUBLE
                           @ 07,19 PROMPT "1-CREDITO    " MESS "REALIZA O CREDITO"
                           @ 08,19 PROMPT "2-CONSULTA   " MESS "CONSULTA AS DEVOLUCOES"
                           @ 09,19 PROMPT "3-CANHOTOS   " MESS "BAIXA PEDIDOS ENVIADOS"
                           MENU TO OP
                           DO CASE
                              CASE OP == 1
                                DEVCRED()
                                ACESSO=0
                           CASE OP == 2
                                CONDECRE()
                                ACESSO=0
                           CASE OP == 3
                                ACESSO()
                                IF ACESSO=1
                                        ENVIA()
                                ENDIF
                                ACESSO=0
                        ENDCASE                            
                      CASE OP == 3
                           KEYOTARIOS()
                           VENDA()
                      CASE OP == 4
                           OP=1                   
                           KEYOTARIOS()
                           CONSULTA()
                      CASE OP == 5
                           OP=1                  
                           KEYOTARIOS()
                           UTILIT()
                      CASE OP == 6
                           CLS
                           CLOSE ALL
                           BREAK
                ENDCASE
                   EXIT
            ENDIF
            IF CONT>115
                    TMOTO()
                    SETCOLOR("/W")
                    @ 07,00 CLEAR TO 19,79
                    ENTREGA()
                    ORDSETFOCUS("CODIGO")
                    GOTO TOP
                    LINHA=07
                    COLUNA=10
                    MP1=0
                    MP2=0
                    MP3=0
                    MP4=0
                    MP5=0
                    DO WHILE ! EOF()
                            SETCOLOR("N/W")
                          * @ LINHA,COLUNA SAY RTRIM(ENTREGAS)
                            @ LINHA,COLUNA SAY SomaH:=SEC2TIME( TIME2SEC(TIME())-TIME2SEC(HORA) )
                            IF PONTO="P1"
                                 MP1++
                            ENDIF     
                            IF PONTO="P2"
                                 MP2++
                            ENDIF     
                            IF PONTO="P3"
                                  MP3++
                            ENDIF     
                            IF PONTO="P4"
                                  MP4++
                            ENDIF
                            IF PONTO="P5"
                                  MP5++
                            ENDIF
                            IF LINHA=18
                                 COLUNA=COLUNA+10
                                 LINHA=06
                            ENDIF     
                            SKIP
                            LINHA++
                    ENDDO
                    SETCOLOR("W+/B+,N/W")
                    IF MP1>0
                          SETCOLOR("W+/B+,N*/R")
                    ENDIF
                     MP1=MP1+MP2+MP3+MP4+MP5   
                    @ 19,03 SAY "ENTREGAS:" GET MP1 PICT "99"
                    SETCOLOR("W+/B+,N/W")
                    CLEAR GETS
                    CONT=0
            ENDIF
            @ 23,68 SAY TIME()
            CONT++
            USE
        ENDDO
ENDDO


******************************************************************************

*********************************/FUN€AO CADASTRO\*****************************

FUNCTION CADASTRO
SETCOLOR("W+/R,N/W")
@ 05,06 CLEAR TO 14,24
@ 05,06 TO 14,23 DOUBLE
@ 06,07 PROMPT "1-PE€AS         " MESS "     CADASTRO DE PE€AS     "
@ 07,07 PROMPT "2-CLIENTES      " MESS "   CADASTRO DE CLIENTES    "
@ 08,07 PROMPT "3-GARANTIA      " MESS "  CADASTRO DE GARANTIAS    "
@ 09,07 PROMPT "4-FORNECEDORES  " MESS " CADASTRO DE FORNECEDORES  "
@ 10,07 PROMPT "5-NOTAS         " MESS "CADASTRO/CONSULTA DE  NOTAS"
@ 11,07 PROMPT "6-ESTOQUE MAXIMO" MESS "CADASTRO O ESTOQUE MAXIMO  "
@ 12,07 PROMPT "7-RECIBO/CREDITO" MESS "IMPRIMIR RECIBO / CREDITO  "
@ 13,07 PROMPT "8-CHEQUES       " MESS "    CADASTRO DE CHEQUES    "
MENU TO OP
DO CASE
   CASE OP == 1
       CADPEC()
   CASE OP == 2
       DO CADCLI
        ACESSO=0
   CASE OP == 3
       DO CADGAR
        ACESSO=0
   CASE OP == 4
       DO CADFOR
   CASE OP == 5
        OP=01
        @ 10,24 CLEAR TO 16,38
        @ 10,24 TO 16,38 DOUBLE
        @ 11,25 PROMPT "1-ENTRADA    " MESS "     ENTRADA DE NOTAS      "
        @ 12,25 PROMPT "2-CONS.ENTRAD" MESS " CONSULTA ENTRADA DE NOTAS "
        @ 13,25 PROMPT "3-CONFERENCIA" MESS "   CONFERENCIA DE NOTAS    "
        @ 14,25 PROMPT "4-CADASTRO   " MESS "   CADASTRO DE NOTAS       "
        @ 15,25 PROMPT "5-CONS.NOTAS " MESS "     CONSULTA NOTAS        "
        MENU TO OP
        DO CASE
           CASE OP == 1
                CADNOT()
           CASE OP == 2
                DO CONNOTA
           CASE OP == 3
                DO ENTRANOT
           CASE OP == 4
                DO CADNOTA
                ACESSO=0
           CASE OP == 5
                DO CONNOTAS                
                ACESSO=0
        ENDCASE
   CASE OP == 6
        IF ACESSO=1
                IF CONFIRMA("CONFIRMA REORGANIZAR OS ARQUIVOS!!!")=1
                            ACESSO()
                            IF ACESSO=1 .AND. ALLTRIM(FUNCIONARIO)="MARCELO"
                                    DO CADMAX
                                ELSE
                                    RETURN(.T.)
                            ENDIF
                ENDIF
             ELSE
                OL_Yield()
                ALERT('ACESSO NEGADO !!!')
                RETURN(.T.)
        ENDIF
        ACESSO=0
   CASE OP == 7
        OP=01
        @ 10,24 CLEAR TO 15,37
        @ 10,24 TO 15,37 DOUBLE
        @ 11,25 PROMPT "1-PAGAMENTO " MESS "RECIBO DE PAGAMENTO "
        @ 12,25 PROMPT "2-CREDITO   " MESS "CREDITO PARA CLIENTES"
        @ 13,25 PROMPT "3-CHEQUE S/F" MESS "   CHEQUE DEVOLVIDO  "
        @ 14,25 PROMPT "4-CONSULTA  " MESS " CONSULTA PAGAMENTO  "
        MENU TO OP
        DO CASE
           CASE OP == 1
                MFORMA="RECIBO DE PAGAMENTO"
                DO CADRECIB
           CASE OP == 2
                IF ACESSO#1
                        RETURN(.T.)
                ENDIF
                MFORMA="CREDITO EM PECAS"
                OP=01
                @ 13,37 CLEAR TO 18,48
                @ 13,37 TO 18,48 DOUBLE
                @ 14,38 PROMPT "1-DINHEIRO" MESS "PAGAMENTO DINHEIRO"
                @ 15,38 PROMPT "2-CHEQUE  " MESS " PAGAMENTO CHEQUE "
                @ 16,38 PROMPT "3-CREDITO " MESS " PAGAMENTO CREDITO"
                @ 17,38 PROMPT "4-DEBITO  " MESS " PAGAMENTO DEBITO "
                MENU TO OP
                DO CASE
                   CASE OP == 1
                        MTIPO="DINHEIRO"
                        DO CADRECIB
                   CASE OP == 2
                        MTIPO="CHEQUE"
                        DO CADRECIB
                   CASE OP == 3
                        MTIPO="CREDITO"
                        DO CADRECIB
                   CASE OP == 4
                        MTIPO="DEBITO"
                        DO CADRECIB
                ENDCASE
                ACESSO=0
           CASE OP == 3
                MFORMA="CHEQUE DEVOLVIDO"
                MTIPO="CHEQUE"
                DO CADRECIB
           CASE OP == 4
                DO CONPAGA    
                ACESSO=0
        ENDCASE
   CASE OP == 8
        DO CADCHE
ENDCASE
OP=1
RETURN (.T.)

******************************/FUN€AO CONSULTA\******************************

FUNCTION CONSULTA
SETCOLOR("W+/R,N/W")
@ 05,28 CLEAR TO 19,48
@ 05,28 TO 19,48 DOUBLE
@ 06,29 PROMPT "1-PE€AS          " MESS "CONSULTA BANCO DE DADOS DE PE€AS "
@ 07,29 PROMPT "2-CLIENTES       " MESS "CONSULTA BANCO DE DADOS DE CLIENTES"
@ 08,29 PROMPT "3-CUPOM DE PEDIDO" MESS "CONSULTA DE CUPOM EMITIDAS"
@ 09,29 PROMPT "4-FORNECEDORES   " MESS "CONSULTA FORNECEDORES"
@ 10,29 PROMPT "5-PEDIDOS        " MESS "PE€AS COM ESTOQUE INSUFICIENTE"
@ 11,29 PROMPT "6-CONTROLE       " MESS "CONTROLA DIVIDAS DA SEMANA"
@ 12,29 PROMPT "7-GARANTIA       " MESS "CONSULTA DADOS DE GARANTIA"
@ 13,29 PROMPT "8-COMISSAO       " MESS "VERIFICA O VALOR PARA COMISSAO"
@ 14,29 PROMPT "9-VERIFICA€AO    " MESS "CONSULTA PE€AS VENDIDA A CLIENTES"
@ 15,29 PROMPT "10-CHEQUES       " MESS "CONSULTA CHEQUE A DEPOSITAR"
@ 16,29 PROMPT "11-VENDA/PRODUTOS" MESS "CONSULTA VENDAS X PRODUTOS"
@ 17,29 PROMPT "12-DEVOLUCOES    " MESS "CONSULTA DEVOLUCOES"
@ 18,29 PROMPT "13-CANCELAMENTO  " MESS "CONTROLA PECAS DEVOLVIDAS"
MENU TO OP
DO CASE
   CASE OP == 1
        CONPEC=0        
        NTX=1
        CONPEC()
        ACESSO=0
   CASE OP == 2 
        DO CONCLI
   CASE OP == 3 
        DO CONNOT
        ACESSO=0
   CASE OP == 4
        DO CONFOR
   CASE OP == 5
        OP=01
        @ 11,48 CLEAR TO 14,63
        @ 11,48 TO 14,63 DOUBLE
        @ 12,49 PROMPT "1-PEDIDOS    " MESS "REALIZA PEDIDOS FORNECEDOR"
        @ 13,49 PROMPT "2-CONSULTA   " MESS " CONSULTA PEDIDOS REALIZADOS"
        MENU TO OP
        DO CASE
           CASE OP == 1
                ESTMIN()
           CASE OP==2
                CONPED()
        ENDCASE
   CASE OP == 6
        OP=01
        @ 11,48 CLEAR TO 14,63
        @ 11,48 TO 14,63 DOUBLE
        @ 12,49 PROMPT "1-FECHAMENTO " MESS "REALIZA O FECHAMENTO CONVENIO"
        @ 13,49 PROMPT "2-CONSULTA   " MESS " CONSULTA VALORES MENSAIS  "
        MENU TO OP
        DO CASE
           CASE OP == 1
                IF ALLTRIM(FUNCIONARIO)="MARCELO" .OR. ALLTRIM(FUNCIONARIO)="TIAGO"

                      ELSE
                        OL_Yield()
                        ALERT('ACESSO NAO AUTORIZADO')               
                        RETURN(.T.)
                ENDIF
                CONDIV()
           CASE OP == 2
                IF ALLTRIM(FUNCIONARIO)="MARCELO" .OR. ALLTRIM(FUNCIONARIO)="FABIO"

                      ELSE
                        OL_Yield()
                        ALERT('ACESSO NAO AUTORIZADO')               
                        RETURN(.T.)
                ENDIF
                CONFECHA()
        ENDCASE            
   CASE OP == 7
        DO CONGAR
   CASE OP == 8
        COMISSAO()
   CASE OP == 9        
        C_PECAS()
   CASE OP == 10
        DO CONCHE
   CASE OP == 11
        RELAT()
        ACESSO=0
   CASE OP == 12
        CONDEVOL()
   CASE OP == 13
        CANCELA()
        ACESSO=0
ENDCASE
OP=03
RETURN(.T.)
                   
********************************/FUN€AO UTILITARIO\***************************
                                                                
FUNCTION UTILIT
SETCOLOR("W+/R,N/W")
@ 05,47 CLEAR TO 20,63
@ 05,47 TO 20,63 DOUBLE
@ 06,48 PROMPT "1-REINDEX      " MESS "REINDEXA TODOS OS ARQUIVOS"
@ 07,48 PROMPT "2-DADOS        " MESS "ALTERA OS DADOS DA EMPRESA"
@ 08,48 PROMPT "3-DEVOLU€AO    " MESS "EFETUA DEVOLU€AO DE CUPOM"
@ 09,48 PROMPT "4-OR€AMENTO    " MESS "FAZ OR€AMENTO NO BALCAO"
@ 10,48 PROMPT "5-RECUPERA     " MESS "RECUPERA OS ARQUIVOS DELETADOS"
@ 11,48 PROMPT "6-DELETA       " MESS "DELETA OS ARQUIVOS PERMANENTE"
@ 12,48 PROMPT "7-CONSULTA ORCA" MESS "CONSULTA OR€AMENTO"
@ 13,48 PROMPT "8-HORARIO      " MESS "CONSULTA QUANTIDADE VENDA POR HORARIO"
@ 14,48 PROMPT "9-SENHA        " MESS "CADASTRA SENHA P/ USUARIOS DO SISTEMA"
@ 15,48 PROMPT "10-LIMPA DADOS " MESS "FAZ LIMPEZA BANCOS BANCOS DE DADOS   "
@ 16,48 PROMPT "11-DESTRAVA    " MESS "DESTRAVA IMPRESSORA E MOTOBOY"
@ 17,48 PROMPT "12-DBFXLS      " MESS "CRIA ARQUIVO DBF EM EXCEL"
@ 18,48 PROMPT "13-LIMPA TEMP. " MESS "LIMPA TEMPORARIOS/NOTAS"
@ 19,48 PROMPT "14-UNIFICA     " MESS "UNIFICA CREDITOS"
MENU TO OP
DO CASE
   CASE OP == 1
        IF ACESSO=1
                IF CONFIRMA("CONFIRMA REINDEXAR OS ARQUIVOS!!!")=1
                            ACESSO()
                            IF ACESSO=1 .AND. ALLTRIM(FUNCIONARIO)="MARCELO" 
                                    REINDEX()
                                ELSE
                                    RETURN(.T.)
                            ENDIF
                ENDIF
             ELSE
                OL_Yield()
                ALERT('ACESSO NEGADO !!!')
                RETURN(.T.)
        ENDIF
        ACESSO=0
   CASE OP == 2
      DADOS()
   CASE OP == 3
        DEVOLUCAO()
        ACESSO=0
   CASE OP == 4
        MNOMEPECA=SPACE(45)
        DO ORCAMEN
   CASE OP == 5
        REC()
        ACESSO=0
   CASE OP == 6
        DEL()
        ACESSO=0
   CASE OP == 7
        OP=01
        @ 13,58 CLEAR TO 16,73
        @ 13,58 TO 16,73 DOUBLE
        @ 14,59 PROMPT "1-REIMPRIME " MESS "REIMPRIME ORCAMENTOS"
        @ 15,59 PROMPT "2-ZERA      " MESS " ZERA OS ORCAMENTOS "
        MENU TO OP
        DO CASE
           CASE OP == 2
                IF ALLTRIM(FUNCIONARIO)="MARCELO"
                        ORCAEX()
                        ZAP
                        ORCAPEDEX()
                        ZAP
                      ELSE
                        OL_Yield()
                        ALERT('ACESSO NAO AUTORIZADO')               
                        RETURN(.T.)
                ENDIF
           CASE OP == 1

                DO CONORCA

        ENDCASE           
   CASE OP == 08
        CONHORA()
   CASE OP == 09        
        SENHA()
   CASE OP == 10
        DELNOTAS()
        ACESSO=0
   CASE OP == 11
        DESTRAVA()
        ACESSO=0
   CASE OP == 12
        DBFXLS()
        ACESSO=0
   CASE OP == 13
        IF ACESSO=1
                IF CONFIRMA("CONFIRMA LIMPAR OS TEMPORARIOS!!!")=1
                            ACESSO()
                            IF ACESSO=1 .AND. ALLTRIM(FUNCIONARIO)="FABIO"
                                    LIMPATEM()
                                ELSE
                                    RETURN(.T.)
                            ENDIF
                ENDIF
             ELSE
                OL_Yield()
                ALERT('ACESSO NEGADO !!!')
                RETURN(.T.)
        ENDIF
        ACESSO=0
   CASE OP == 14
        UNIFICA()
ENDCASE
OP=02
RETURN(.T.)

**************************FUNCAO INICIA VARIAVEIS ENVIADOS*****************
PROCEDURE INIVAENV
MCODNOT=0
MNOTCLI=SPACE(35)
MNOTFUNC=SPACE(10)
MNOTPAG=SPACE(10)
MNOTTOTG=0
D_NOT=DATE()
MMOTOCA=SPACE(10)
MTROCO=0
MNOTDESC=0
RETURN

**************************FUNCAO INICIA VARIAVEIS PEDIDO*****************
PROCEDURE INIVAPED
MCODNOT=0
MCNOTFUNC=0
MCNOTCLI=0
MNOTCLI=SPACE(35)
MNOTFUNC=SPACE(10)
MNOTPAG=SPACE(10)
MNOTTOTG=0
D_NOT=DATE()
MHORANOT=SPACE(05)
RETURN


**************************FUNCAO PUBLICA VARIAVEIS DADOS***********************

PROCEDURE PUVARDA
PUBLIC MRSOCIAL,MNOMEABR,MENDEMPR,MBAIRRO,MCIDADE,MCEP,MESTADO,MCGCEMPR,mtaxas
PUBLIC MINSCEST,MTELE,MFAX,MMENS1,MMENS2,MP1,MP2,MP3,MP4,MQTDFIS,MFISAPK,mtaxat
PUBLIC MCONTSAIDA,MMSG1,MMSG2,MMSG3,MMSG4,MMSG5,MMSG6
RETURN

**************************FUNCAO PUBLICA VARIAVEIS PEDIDO***********************

PROCEDURE PUVARPED
PUBLIC MCODNOT,MNOTCLI,MNOTFUNC,MNOTPAG,MHORANOT,MNOTTOTG,MCNOTFUNC,MCNOTCLI
RETURN

**************************FUNCAO PUBLICA VARIAVEIS REL_ENTR********************

PROCEDURE PUVARENT
PUBLIC MCODENTR,MMOTOBOY,MQTDENTR,MHORAS_S,MHORA_C,MTEMPO,MKM
RETURN
 
*************************/FUN€AO IGUALA VARIVEIS PECAS************************

PROCEDURE IGUAVARPE
MCODBARRA=CODBARRA
MCODBARRA1=CODBARRA1
MCODBARRA2=CODBARRA2
MCODBARRA3=CODBARRA3
MCODBARRA4=CODBARRA4
MCODPECA=CODPECA
MDIGITO=DIGITO
MLOCAL=LOCAL
MLACRE=LACRE
MNOMEPECA=NOMEPECA
MNOMEPECA2=NOMEPECA2
MNOMEPECA3=NOMEPECA3
MNOMEPECA4=NOMEPECA4
MNOMEPECA7=NOMEPECA7
MPRECO=PRECO
MP_CUSTO=P_CUSTO
MP_CUSTO2=P_CUSTO2
MP_CUSTO3=P_CUSTO3
MP_CUSTO4=P_CUSTO4
MQTD=QTD
MCUSTO1=CUSTO1
MCUSTO2=CUSTO2
MCUSTO3=CUSTO3
MCUSTO4=CUSTO4
MCUSTO5=CUSTO5
MTEMP=TEMP
MTEMPPED=TEMPPED
MQTD2=QTD2
MQTD3=QTD3
MQTD4=QTD4
MQTD5=QTD5
MQTD6=QTD6
MEQTD1=EQTD1
MEQTD2=EQTD2
MEQTD3=EQTD3
MEQTD4=EQTD4
MNCM=NCM
MCEST=CEST
MORIGINAL=ORIGINAL
MCFOP=CFOP
MCQTD2=CQTD2
MCQTD3=CQTD3
MCQTD4=CQTD4
MCQTD5=CQTD5
MCQTD6=CQTD6
MDISTRIB=DISTRIB
MMULTIPLO=MULTIPLO
MDATA1=DATA1
MDATA2=DATA2
MDATA3=DATA3
MDATA4=DATA4
MDISTRIB2=DISTRIB2
MDISTRIB3=DISTRIB3
MDISTRIB4=DISTRIB4
MQTDMIN=QTDMIN
MQTDMAX=QTDMAX
MQTDMAX1=QTDMAX1
MQTDMAX2=QTDMAX2
MQTDMAX3=QTDMAX3
MFABRIC=FABRIC
MNFABRIC=NFABRIC
MFABRIC2=FABRIC2
MNFABRIC2=NFABRIC2
MFABRIC3=FABRIC3
MNFABRIC3=NFABRIC3
MFABRIC4=FABRIC4
MNFABRIC4=NFABRIC4
MFABRIC5=FABRIC5
MNFABRIC5=NFABRIC5
MDATAENTR=DATAENTR
MUNIDADE=UNIDADE
MTEMPUNI=TEMPUNI
MLOCAL_E=LOCAL_E
MQTD_E=QTD_E
MQTD_P=QTD_P
MQTD_C=QTD_C
RETURN

*************************/FUN€AO IGUALA VARIVEIS DADOS************************

PROCEDURE IGUAVARDA
MRSOCIAL=RSOCIAL
MNOMEABR=NOMEABR
MENDEMPR=ENDEMPR
MBAIRRO=BAIRRO
MCIDADE=CIDADE
MCEP=CEP
MESTADO=ESTADO
MCGCEMPR=CGCEMPR
MINSCEST=INSCEST
MTELE=TELE
MFAX=FAX
MMENS1=MENS1
MMENS2=MENS2
MQTDFIS=QTDFIS
MFISAPK=FISAPK
mtaxas=taxas
mtaxat=taxat
MCONTSAIDA=CONTSAIDA
MMSG1=MSG1
MMSG2=MSG2
MMSG3=MSG3
MMSG4=MSG4
MMSG5=MSG5
MMSG6=MSG6
RETURN

*************************/FUN€AO IGUALA VARIVEIS CHEQUE**********************
PROCEDURE IGUAVARCHE
MCLIENTE=CLIENTE
MNOME=NOME
MCPF=CPF
MDATA_D=DATA_D
MDATA_R=DATA_R
MOBS=OBS
MVALOR=VALOR
RETURN

*************************/FUN€AO IGUALA VARIVEIS REL_ENTR********************

PROCEDURE IGUAVAENT
MCODENTR=CODENTR
MMOTOBOY=MOTOBOY
MQTDENTR=QTDENTR
MHORA_S=HORA_S
MHORA_C=HORA_C
MTEMPO=TEMPO
MPONTO=PONTO                                     
MKM=KM
MDATA=DATA
RETURN

*************************/FUN€AO REPA€A VARIVEIS CLIENTES*********************

FUNCTION REPLCLI
BLOQUEIO()
REPLACE CODCLI  WITH MCODCLI
REPLACE NOMECLI WITH MNOMECLI
REPLACE RESPCLI WITH MRESPCLI
REPLACE ENDCLI  WITH MENDCLI
REPLACE CIDADE  WITH MCIDADE
REPLACE ESTADO  WITH MESTADO
REPLACE CGC     WITH MCGC
REPLACE INSCR   WITH MINSCR
REPLACE TEL     WITH MTEL
REPLACE TAXA    WITH MTAXA
REPLACE TAXA_DUPLA WITH MTAXA_DUPLA
REPLACE T_MOTO  WITH MT_MOTO
REPLACE BLOQUEIO WITH MBLOQUEIO
REPLACE CEL      WITH MCEL
REPLACE P1      WITH MP1
REPLACE P2      WITH MP2
REPLACE P3      WITH MP3
REPLACE P4      WITH MP4
REPLACE KM      WITH MKM
REPLACE MANDANOTA WITH MMANDANOTA
REPLACE DT_FECHA WITH MDT_FECHA
DBCOMMIT()
UNLOCK
RETURN

*************************/FUN€AO PUBLICA VARIVEIS CLIENTES*********************

PROCEDURE PUVARCLI
PUBLIC MCODCLI,MNOMECLI,MRESPCLI,MENDCLI,MCGC,MTEL,MINSCR
PUBLIC MESTADO,MCIDADE,MTAXA,MP1,MP2,MP3,MP4,MKM,MBLOQUEIO,MCEL
PUBLIC MMANDANOTA,MT_MOTO,MTAXA_DUPLA,MDT_FECHA
RETURN

*************************/FUN€AO INICIA VARIAVEIS CLIENTES**********************

PROCEDURE INIVACLI
MCODCLI=CODCLI+1
MNOMECLI=SPACE(35)
MRESPCLI=SPACE(35)
MENDCLI=SPACE(35)
MCGC=SPACE(18)
MESTADO=SPACE(02)
MCIDADE=SPACE(20)
MTEL=SPACE(09)
MTAXA=SPACE(01)
MTAXA_DUPLA=0
MT_MOTO=0
MBLOQUEIO=SPACE(01)
MINSCR=SPACE(15)
MP1=SPACE(2)
MP2=SPACE(2)
MP3=SPACE(2)
MP4=SPACE(2)
MCEL=SPACE(10)
MKM=0
MMANDANOTA=SPACE(01)
MDT_FECHA=SPACE(10)
RETURN

*************************/FUN€AO MOSTRATEXTO CLIENTES*************************

PROCEDURE MOSTECLI
@ 04,14 SAY "Cliente.....:" GET MNOMECLI PICT "@!"  
@ 06,14 SAY "Responsavel.:" GET MRESPCLI PICT "@!"
@ 08,14 SAY "Endereco....:" GET MENDCLI  PICT "@!"
@ 10,14 SAY "Cidade......:" GET MCIDADE  PICT "@!"
@ 10,52 SAY "ESTADO.:" GET MESTADO  PICT "@!"
@ 12,14 SAY "CGC (CIC)...:" GET MCGC     PICT "99.999.999/9999-99"
@ 14,14 SAY "Inscricao...:" GET MINSCR   PICT "999.999.999.999"
@ 14,44 GET MDT_FECHA PICT "@D"
@ 16,14 SAY "Fone:" GET MTEL PICT "9999-9999"
@ 16,30 SAY "Cel:" GET MCEL PICT "99999-9999"
@ 18,12 SAY "Fecha:"GET MMANDANOTA PICT "@!" VALID MMANDANOTA $ ("S/N")
@ 18,21 SAY "Taxa:"GET MTAXA PICT "@!" VALID MTAXA $ ("S/N/T/Q")
@ 18,29 SAY "Bloq:"GET MBLOQUEIO PICT "@!" VALID MBLOQUEIO $ ("S/N")
@ 18,37 SAY "T_MOTO:"GET MT_MOTO PICT "99"
@ 18,48 SAY "TX_D:"GET MTAXA_DUPLA PICT "9" VALID MTAXA_DUPLA >=1
@ 18,56 SAY ULTCOMPRA PICT "@D"
@ 12,54 SAY "Ponto 1:" GET MP1 PICT "@!"  VALID MP1 $ ("P1/P2/P3/P4/P5")
@ 13,54 SAY "Ponto 2:" GET MP2 PICT "@!"  VALID MP2 $ ("P1/P2/P3/P4/P5/  ")
@ 14,54 SAY "Ponto 3:" GET MP3 PICT "@!"  VALID MP3 $ ("P1/P2/P3/P4/P5/  ")
@ 15,54 SAY "Exclui.:" GET MP4 PICT "@!"  VALID MP4 $ ("P1/P2/P3/P4/P5/  ")
@ 16,50 SAY "KM.....:" GET MKM PICT "99.999"
RETURN                                           

*************************/FUN€AO INICIA VARIAVEIS FORNECEDORES******************

PROCEDURE INIVAFOR
MCODFOR=CODFOR+1
MNOMEFOR=SPACE(20)
MFORNECEDOR=SPACE(40)
MVENDEDOR=SPACE(20)
MCELVEN=SPACE(10)
MTELFOR=SPACE(09)
MDDDFOR=SPACE(02)
MCNPJFOR=SPACE(18)
MENDFOR=SPACE(40)
MIEFOR=SPACE(15)
MBAIRROFOR=SPACE(20)
MESTFOR=SPACE(2)
RETURN

************************/FUN€AO PUBLICA VARIVEIS FORNECEDOR******************

PROCEDURE PUVARFOR
PUBLIC MCODFOR,MNOMEFOR,MVENDEDOR,MCELVEN,MTELFOR,MCNPJFOR,MENDFOR,MIEFOR
PUBLIC MBAIRROFOR,MESTFOR,MDDDFOR,MFORNECEDOR
RETURN

*************************/FUN€AO PUBLICA VARIVEIS CHEQUE******************

PROCEDURE PUVARCHE
PUBLIC MCLIENTE,MNOME,MCPF,MDATA_R,MDATA_D,MVALOR,MOBS
RETURN
                                                       
*************************/FUN€AO MOSTRATEXTO FORNECEDORES*********************

PROCEDURE MOSTEFOR
@ 05,13 SAY "Nome Fantasia..:"  GET MNOMEFOR    PICT "@!" VALID MNOMEFOR # " "
@ 07,13 SAY "Fornecedor.....:"  GET MFORNECEDOR PICT "@!" VALID MNOMEFOR # " "
@ 09,13 SAY "Cnpj...........:"  GET MCNPJFOR    PICT "99.999.999/9999-99" 
@ 11,13 SAY "I.E Fornecedor.:"  GET MIEFOR      PICT "999.999.999.999"
@ 13,13 SAY "Endereco fornec:"  GET MENDFOR     PICT "@!"
@ 15,13 SAY "Bairro.........:"  GET MBAIRROFOR  PICT "@!"
@ 15,51 SAY "Estado...:"        GET MESTFOR     PICT "@!"
@ 17,13 SAY "Vendedor.......:"  GET MVENDEDOR   PICT "@!"
@ 19,13 SAY "Tele fornecedor:"                  
@ 19,30 GET MDDDFOR  PICT "@!"
@ 19,35 GET MTELFOR  PICT "9999-9999"
@ 21,13 SAY "Cel.vendedor...:"  GET MCELVEN     PICT "99999-9999"
RETURN

*************************/FUN€AO REPA€A VARIVEIS CHEQUE*****************

FUNCTION REPLCHE
BLOQUEIO()
REPLACE CLIENTE  WITH MCLIENTE
REPLACE NOME     WITH MNOME
REPLACE CPF      WITH MCPF
REPLACE DATA_R   WITH MDATA_R
REPLACE OBS      WITH MOBS
REPLACE DATA_D   WITH MDATA_D
REPLACE VALOR    WITH MVALOR
DBCOMMIT()
UNLOCK
RETURN

*************************/FUN€AO REPA€A VARIVEIS FORNECEDORES*****************

FUNCTION REPLFOR
BLOQUEIO()
REPLACE CODFOR     WITH MCODFOR
REPLACE NOMEFOR    WITH MNOMEFOR
REPLACE FORNECEDOR WITH MFORNECEDOR
REPLACE TELFOR     WITH MTELFOR
REPLACE VENDEDOR   WITH MVENDEDOR
REPLACE CELVEN     WITH MCELVEN
REPLACE CNPJFOR    WITH MCNPJFOR
REPLACE ENDFOR     WITH MENDFOR
REPLACE IEFOR      WITH MIEFOR
REPLACE BAIRROFOR  WITH MBAIRROFOR
REPLACE ESTFOR     WITH MESTFOR
REPLACE DDDFOR     WITH MDDDFOR
DBCOMMIT()
UNLOCK
RETURN

*************************/FUN€AO INICIA VARIAVEIS PECAS*************************

PROCEDURE INIVARPE
MCODBARRA=SPACE(20)
MCODBARRA1=SPACE(20)
MCODBARRA2=SPACE(20)
MCODBARRA3=SPACE(20)
MCODBARRA4=SPACE(20)
MCODPECA=SPACE(05)
MDIGITO=SPACE(02)
MLOCAL=SPACE(07)
MLACRE=SPACE(1)
MNOMEPECA=SPACE(45)
MNOMEPECA2=SPACE(68)
MNOMEPECA3=SPACE(68)
MNOMEPECA4=SPACE(68)
MNOMEPECA7=SPACE(68)
MDISTRIB=SPACE(20)
MDATA1=DATE()
MDATA2=DATE()
MDATA3=DATE()
MDATA4=DATE()
MDISTRIB2=SPACE(20)
MDISTRIB3=SPACE(20)
MDISTRIB4=SPACE(20)
MPRECO=0
MUNIDADE=SPACE(02)
MTEMPUNI=SPACE(01)
MP_CUSTO=0
MP_CUSTO2=0
MP_CUSTO3=0
MP_CUSTO4=0
MQTD=0
MCUSTO1=0
MCUSTO2=0
MCUSTO3=0
MCUSTO4=0
MCUSTO5=0
MTEMPPED=0
MMULTIPLO=0
MTEMP=0
MEQTD1=0
MEQTD2=0
MEQTD3=0
MEQTD4=0
MQTD2=0
MQTD3=0
MQTD4=0
MQTD5=0
MQTD6=0
MCQTD2=0
MCQTD3=0
MCQTD4=0
MCQTD5=0
MCQTD6=0
MNCM=SPACE(08)
MCEST=SPACE(06)
MORIGINAL=SPACE(12)
MCFOP=SPACE(04)
MQTDMIN=0
MQTDMAX=0
MQTDMAX1=0
MQTDMAX2=0
MQTDMAX3=0
MFABRIC=SPACE(10)
MNFABRIC=SPACE(12)
MFABRIC2=SPACE(10)
MNFABRIC2=SPACE(12)
MFABRIC3=SPACE(10)
MNFABRIC3=SPACE(12)
MFABRIC4=SPACE(10)
MNFABRIC4=SPACE(12)
MFABRIC5=SPACE(10)
MNFABRIC5=SPACE(12)
MDATAENTR=DATE()
MLOCAL_E=SPACE(10)
MQTD_E=0
MQTD_P=0
MQTD_C=0
RETURN

*************************/FUN€AO INICIA VARIAVEIS DADOS\************************

PROCEDURE INIVARDA
MRSOCIAL=SPACE(30)
MNOMEABR=SPACE(10)
MENDEMPR=SPACE(30)
MBAIRRO=SPACE(20)
MCIDADE=SPACE(15)
MCEP=SPACE(09)
MESTADO=SPACE(02)
MCGCEMPR=SPACE(18)
MINSCEST=SPACE(15)
MTELE=SPACE(09)
MFAX=SPACE(09)
MMENS1=SPACE(35)
MMENS2=SPACE(35)
MQTDFIS=0
MFISAPK=0
mtaxas=0
mtaxat=0
MCONTSAIDA=0
MMSG1=SPACE(30)
MMSG2=SPACE(30)
MMSG3=SPACE(30)
MMSG4=SPACE(30)
MMSG5=SPACE(30)
MMSG6=SPACE(30)
RETURN

*************************/FUN€AO INICIA VARIAVEIS CHEQUE\***********************

PROCEDURE INIVACHE
MNOME=SPACE(35)
MCLIENTE=SPACE(35)
MCPF=SPACE(18)
MDATA_D=DATE()
MDATA_R=DATE()
MOBS=SPACE(20)
MVALOR=0
RETURN
        
*************************/FUN€AO MOSTRATEXTO CHEQUE****************************

FUNCTION MOSTEXCHE        
SET CURSOR ON
SETCOLOR("W+/BG,N/W")
@ 05,09 CLEAR TO 20,69
@ 05,09 TO 20,69 DOUBLE
PUVARCHE()
IGUAVARCHE()
SET CENT ON
@ 05,27 SAY "³    CADASTRO DE CHEQUE   ³"
@ 07,13 SAY "CLIENTE....:" GET MCLIENTE PICT "@!"
@ 09,13 SAY "CPF/CNPJ...:" GET MCPF PICT "999999999999999999"
@ 11,13 SAY "NOME.......:" GET MNOME   PICT "@!"
@ 13,13 SAY "DATA DEPOS.:" GET MDATA_D PICT "99/99/9999"
@ 15,13 SAY "DATA RECEB.:" GET MDATA_R PICT "99/99/9999"
@ 17,13 SAY "VALOR......:" GET MVALOR  PICT "99999.99"
@ 19,13 SAY "OBSERVACAO.:" GET MOBS    PICT "@!"
RETURN

*************************/FUN€AO MOSTRATEXTO PECAS****************************

PROCEDURE MOSTEXPE  

CLEAR GETS

@ 01,20 SAY "LOCAL:"GET MLOCAL PICT "@!"
@ 01,38 SAY "UN:"GET MUNIDADE PICT "@!"
@ 01,46 SAY "SIT:"GET MTEMPUNI PICT "@!"
@ 01,53 SAY "L:" GET MLACRE PICT "@!"
@ 03,04 SAY "Aplica‡„o:" GET MNOMEPECA PICT "@!"
@ 03,61 SAY "DT:" 
@ 03,65 SAY MDATAENTR PICT "@D"
@ 05,04 SAY "Preco.:" GET MPRECO PICT "9999.99"
@ 05,34 SAY "Multiplo:" GET MMULTIPLO PICT "999"
@ 05,48 SAY "Estoque Max:" GET MQTDMIN PICT "999"
IF MTEMP<>0
        @ 05,66 GET MTEMP PICT "999"
ENDIF
DIA1=DAY(DATE())
DIA2=DAY(DATE()-DIA1)
DIA3=DAY(DATE()-DIA1-DIA2)
@ 07,09 SAY CMONTH(DATE())
@ 07,25 SAY CMONTH(DATE()-DIA1)
@ 07,41 SAY CMONTH(DATE()-DIA1-DIA2)
@ 07,57 SAY CMONTH(DATE()-DIA1-DIA2-DIA3)
@ 07,19 SAY MQTDMAX PICT "9999"
@ 07,35 SAY MQTDMAX1 PICT "9999"
@ 07,51 SAY MQTDMAX2 PICT "9999"
@ 07,67 SAY MQTDMAX3 PICT "9999"

@ 08,03 to 08,75
SETCOLOR("W+/R,N/W")
@ 08,04 say "Cod. Barra"
@ 08,26 say "Fabricante"
@ 08,38 say "N§ Fabricante"
@ 08,52 SAY "Custo" 
@ 08,66 say "Qtd"
@ 08,70 say "TEMP"
@ 15,03 SAY "*-MARCA SEM QUALIDADE"
@ 15,28 SAY "**-MARCA COM PRECO CARO"
@ 15,55 SAY "***-MARCA SEM SAIDA"

SETCOLOR("W+/BG,N/W")
@ 10,04 GET MCODBARRA PICT "@!"
@ 10,26 GET MFABRIC PICT "@!"
@ 10,38 GET MNFABRIC PICT "@!"
@ 10,66 GET MQTD2 PICT "999"


@ 16,03 to 16,75
@ 17,60 TO 22,60
@ 16,04 say "Fornecedor"
@ 16,25 say "N§ Nota"
@ 16,34 say "Data"
@ 16,44 say "P_Custo"
@ 16,53 say "Qtd"
@ 16,63 say "Tributos"
@ 17,63 SAY "NCM/SH" 
@ 18,63 GET MNCM PICT "99999999"
@ 19,63 SAY "CFOP" 
@ 20,63 GET MCFOP PICT "9999" 
@ 21,63 SAY "ORIGINAL" 
@ 22,63 GET MORIGINAL PICT "@!" 

IF MCAD#1
      @ 10,70 GET MCQTD2 PICT "999"
      @ 11,04 GET MCODBARRA1 PICT "@!"
      @ 11,26 GET MFABRIC2 PICT "@!"
      @ 11,38 GET MNFABRIC2 PICT "@!"
      @ 11,66 GET MQTD3 PICT "999"
      @ 11,70 GET MCQTD3 PICT "999"
      @ 12,04 GET MCODBARRA2 PICT "@!"
      @ 12,26 GET MFABRIC3 PICT "@!"
      @ 12,38 GET MNFABRIC3 PICT "@!"
      @ 12,66 GET MQTD4 PICT "999"
      @ 12,70 GET MCQTD4 PICT "999"
      @ 13,04 GET MCODBARRA3 PICT "@!"
      @ 13,26 GET MFABRIC4 PICT "@!"
      @ 13,38 GET MNFABRIC4 PICT "@!"
      @ 13,66 GET MQTD5 PICT "999"
      @ 13,70 GET MCQTD5 PICT "999"
      @ 14,04 GET MCODBARRA4 PICT "@!"
      @ 14,26 GET MFABRIC5 PICT "@!"
      @ 14,38 GET MNFABRIC5 PICT "@!"
      @ 14,66 GET MQTD6 PICT "999"
      @ 14,70 GET MCQTD6 PICT "999"
ENDIF
@ 17,04 GET MDISTRIB PICT "@!"
@ 18,04 GET MDISTRIB2 PICT "@!"
@ 19,04 GET MDISTRIB3 PICT "@!"
@ 20,04 GET MDISTRIB4 PICT "@!"
@ 17,25 SAY NOTA1
@ 17,35 SAY MDATA1
@ 18,25 SAY NOTA2
@ 18,35 SAY MDATA2
@ 19,25 SAY NOTA3
@ 19,35 SAY MDATA3
@ 20,25 SAY NOTA4
@ 20,35 SAY MDATA4
@ 21,04 SAY NOTA
@ 21,15 SAY NOTA10
@ 21,26 SAY NOTA11
@ 22,04 SAY "LOCAL_EST:"  GET MLOCAL_E PICT "@!"
@ 22,27 SAY "QTD_E:"GET MQTD_E PICT "9999"
@ 22,38 SAY "QTD_P:"GET MQTD_P PICT "9999"
@ 22,49 SAY "QTD_C:"GET MQTD_C PICT "9999"
IF ACESSO=1
      DIV=0
      MEDIA=0
      SET CENT OFF
      @ 17,52 GET MEQTD1 PICT "9999"
      @ 17,56 SAY XQTD1 PICT "9999"
      @ 17,44 GET MP_CUSTO PICT "9999.99"
      IF MEQTD1>0 .AND. P_CUSTO>0
              DIV=MEQTD1+DIV
              MEDIA=(P_CUSTO*MEQTD1)+MEDIA
      ENDIF      
      @ 18,52 GET MEQTD2 PICT "9999"
      @ 18,56 SAY XQTD2 PICT "9999"
      @ 18,44 GET MP_CUSTO2 PICT "9999.99"
      IF MEQTD2>0 .AND. P_CUSTO2>0
              DIV=MEQTD2+DIV
              MEDIA=(P_CUSTO2*MEQTD2)+MEDIA
      ENDIF
      @ 19,52 GET MEQTD3 PICT "9999"
      @ 19,56 SAY XQTD3 PICT "9999"
      @ 19,44 GET MP_CUSTO3 PICT "9999.99"
      IF MEQTD3>0 .AND. P_CUSTO3>0
              DIV=MEQTD3+DIV
              MEDIA=(P_CUSTO3*MEQTD3)+MEDIA
      ENDIF    
      @ 20,52 GET MEQTD4 PICT "9999"
      @ 20,56 SAY XQTD4 PICT "9999"
      @ 20,44 GET MP_CUSTO4 PICT "9999.99"
      IF MEQTD4>0 .AND. P_CUSTO4>0
              DIV=MEQTD4+DIV
              MEDIA=(P_CUSTO4*MEQTD4)+MEDIA
      ENDIF
      MEDIA=MEDIA/DIV
      @ 01,59 SAY "P_MEDIO:"
      @ 01,67 SAY MEDIA PICT "9,9999.99"      
      @ 10,52 SAY CUSTO1 PICT "9,999.99"
      @ 11,52 SAY CUSTO2 PICT "9,999.99"
      @ 12,52 SAY CUSTO3 PICT "9,999.99"
      @ 13,52 SAY CUSTO4 PICT "9,999.99"
      @ 14,52 SAY CUSTO5 PICT "9,999.99"
ENDIF        
RETURN



*************************/FUN€AO MOSTRATEXTO PECAS****************************

PROCEDURE TEXPECA

@ 03,09 SAY "Aplica‡„o.....:"  GET MNOMEPECA PICT "@!"
@ 05,09 SAY "Estoque.......:"  GET MQTD PICT "999"
IF MTEMP>0
        @ 05,30 GET MTEMP PICT "999"
ENDIF
@ 07,09 SAY "Estoque Max...:" GET MQTDMIN PICT "999"
DIA1=DAY(DATE())
DIA2=DAY(DATE()-DIA1)
DIA3=DAY(DATE()-DIA1-DIA2)
@ 09,09 SAY CMONTH(DATE())
@ 09,25 SAY CMONTH(DATE()-DIA1)
@ 09,41 SAY CMONTH(DATE()-DIA1-DIA2)
@ 09,57 SAY CMONTH(DATE()-DIA1-DIA2-DIA3)
@ 09,19 GET MQTDMAX PICT "999"
@ 09,35 GET MQTDMAX1 PICT "999"
@ 09,51 GET MQTDMAX2 PICT "999"
@ 09,67 GET MQTDMAX3 PICT "999"
@ 05,37 SAY "Fabricante.....:" GET MFABRIC PICT "@!"
@ 07,37 SAY "N§ original....:" GET MNFABRIC PICT "@!"
SET CENT OFF
@ 11,09 SAY "Distr:"GET MDISTRIB PICT "@!"
@ 11,37 SAY MDATA1
@ 11,46 SAY "QTD" GET MQTD2 PICT "999"
IF ACESSO=1
        @ 11,55 SAY "P_custo1:" GET MP_CUSTO PICT "9999.99"
ENDIF
@ 13,09 SAY "Distr:"GET MDISTRIB2 PICT "@!"
@ 13,37 SAY MDATA2
@ 13,46 SAY "QTD" GET MQTD3 PICT "999"
IF ACESSO=1
        @ 13,55 SAY "P_custo2:" GET MP_CUSTO2 PICT "9999.99"
ENDIF
@ 15,09 SAY "Distr:"GET MDISTRIB3 PICT "@!"
@ 15,37 SAY MDATA3
@ 15,46 SAY "QTD" GET MQTD4 PICT "999"
IF ACESSO=1
        @ 15,55 SAY "P_custo3:" GET MP_CUSTO3 PICT "9999.99"
ENDIF

@ 17,09 SAY "Distr:"GET MDISTRIB4 PICT "@!"
@ 17,37 SAY MDATA4
@ 17,46 SAY "QTD" GET MQTD5 PICT "999"
IF ACESSO=1
        @ 17,55 SAY "P_custo4:" GET MP_CUSTO4 PICT "9999.99"
ENDIF

@ 19,09 SAY "Fabricante2.....:" GET MFABRIC2 PICT "@!"
@ 19,40 SAY "N§ original2....:" GET MNFABRIC2 PICT "@!"
@ 21,09 SAY "Fabricante3.....:" GET MFABRIC3 PICT "@!"
@ 21,40 SAY "N§ original3....:" GET MNFABRIC3 PICT "@!"
RETURN

*************************/FUN€AO PUBLICA VARIVEIS PECAS************************

PROCEDURE PUVARPE
PUBLIC MCODBARRA,MCODBARRA1,MCODPECA,MDIGITO,MNOMEPECA,MNOMEPECA2,MPRECO,MP_CUSTO,MP_CUSTO2,MQTD2,MQTD5,MMULTIPLO
PUBLIC MFABRIC,MNFABRIC,MCODBARRA2,MLOCAL,MDATAENTR,MTEMP,MTEMPPED,MQTD,MQTDMIN,MQTDMAX,MDISTRIB,MDISTRIB2
PUBLIC MTEMPUNI,MUNIDADE,MP_CUSTO4,MFABRIC2,MNFABRIC2,MP_CUSTO3,MFABRIC3,MNFABRIC3,MDISTRIB3,MDISTRIB4
PUBLIC MNOMEPECA4,MQTDMAX1,MQTDMAX2,MQTDMAX3,MDATA1,MDATA2,MDATA3,MDATA4,MNOMEPECA7,MCODBARRA3,MCQTD2,MCODBARRA4
PUBLIC MFABRIC5,MNFABRIC5,MQTD6,MCQTD6,MFABRIC4,MNFABRIC4,MQTD4,MCQTD4,MCQTD3,MQTD3,MNOMEPECA3,MCQTD5,MNCM
PUBLIC MCUSTO1,MCUSTO2,MCUSTO3,MCUSTO4,MCUSTO5,MEQTD1,MEQTD2,MEQTD3,MEQTD4,MLACRE,MCFOP
PUBLIC MCEST,MLOCAL_E,MQTD_E,MQTD_P,MQTD_C,MORIGINAL
RETURN

*************************/FUN€AO REPA€A VARIVEIS PECAS************************

FUNCTION REPLPEC
BLOQUEIO()
REPLACE CODPECA    WITH MCODPECA
REPLACE DIGITO     WITH MDIGITO
REPLACE LOCAL      WITH MLOCAL
REPLACE LACRE      WITH MLACRE
REPLACE CODBARRA   WITH MCODBARRA
REPLACE CODBARRA1  WITH MCODBARRA1
REPLACE CODBARRA2  WITH MCODBARRA2
REPLACE CODBARRA3  WITH MCODBARRA3
REPLACE CODBARRA4  WITH MCODBARRA4
REPLACE NOMEPECA   WITH MNOMEPECA
REPLACE NOMEPECA2  WITH MNOMEPECA2
REPLACE NOMEPECA3  WITH MNOMEPECA3
REPLACE NOMEPECA4  WITH MNOMEPECA4
REPLACE NOMEPECA7  WITH MNOMEPECA7
REPLACE PRECO      WITH MPRECO
REPLACE UNIDADE    WITH MUNIDADE
REPLACE TEMP       WITH MTEMP
REPLACE TEMPUNI    WITH MTEMPUNI
REPLACE TEMPPED    WITH MTEMPPED
REPLACE MULTIPLO   WITH MMULTIPLO
REPLACE DISTRIB    WITH MDISTRIB
REPLACE DISTRIB2   WITH MDISTRIB2
REPLACE DISTRIB3   WITH MDISTRIB3
REPLACE DISTRIB4   WITH MDISTRIB4
REPLACE QTD        WITH MQTD
REPLACE QTD2       WITH MQTD2
REPLACE QTD3       WITH MQTD3
REPLACE QTD4       WITH MQTD4
REPLACE QTD5       WITH MQTD5
REPLACE QTD6       WITH MQTD6
REPLACE CQTD2      WITH MCQTD2
REPLACE CQTD3      WITH MCQTD3
REPLACE CQTD4      WITH MCQTD4
REPLACE CQTD5      WITH MCQTD5
REPLACE CQTD6      WITH MCQTD6
REPLACE NCM        WITH MNCM
REPLACE CEST       WITH MCEST
REPLACE ORIGINAL   WITH MORIGINAL
REPLACE CFOP       WITH MCFOP
REPLACE QTDMIN     WITH MQTDMIN
REPLACE FABRIC     WITH MFABRIC
REPLACE NFABRIC    WITH MNFABRIC
REPLACE FABRIC2    WITH MFABRIC2
REPLACE NFABRIC2   WITH MNFABRIC2
REPLACE FABRIC3    WITH MFABRIC3
REPLACE NFABRIC3   WITH MNFABRIC3
REPLACE FABRIC4    WITH MFABRIC4
REPLACE NFABRIC4   WITH MNFABRIC4
REPLACE FABRIC5    WITH MFABRIC5
REPLACE NFABRIC5   WITH MNFABRIC5
REPLACE P_CUSTO    WITH MP_CUSTO
REPLACE P_CUSTO2   WITH MP_CUSTO2
REPLACE P_CUSTO3   WITH MP_CUSTO3
REPLACE P_CUSTO4   WITH MP_CUSTO4
REPLACE DATAENTR   WITH DATE()
REPLACE EQTD1      WITH MEQTD1 
REPLACE EQTD2      WITH MEQTD2
REPLACE EQTD3      WITH MEQTD3 
REPLACE EQTD4      WITH MEQTD4
REPLACE LOCAL_E    WITH MLOCAL_E
REPLACE QTD_E      WITH MQTD_E
REPLACE QTD_P      WITH MQTD_P
REPLACE QTD_C      WITH MQTD_C
REPLACE ATUALIZADO WITH "S"
DBCOMMIT()
UNLOCK
RETURN

*************************/FUN€AO REPA€A VARIVEIS DADOS************************

FUNCTION REPLDA
BLOQUEIO()
REPLACE RSOCIAL WITH MRSOCIAL
REPLACE NOMEABR WITH MNOMEABR
REPLACE ENDEMPR WITH MENDEMPR
REPLACE BAIRRO  WITH MBAIRRO
REPLACE CIDADE  WITH MCIDADE
REPLACE CEP     WITH MCEP
REPLACE ESTADO  WITH MESTADO
REPLACE CGCEMPR WITH MCGCEMPR
REPLACE INSCEST WITH MINSCEST
REPLACE TELE    WITH MTELE
REPLACE FAX     WITH MFAX
REPLACE MENS1   WITH MMENS1
REPLACE MENS2   WITH MMENS2
REPLACE QTDFIS  WITH MQTDFIS
REPLACE FISAPK  WITH MFISAPK
REPLACE TAXAS   WITH MTAXAS
REPLACE TAXAT   WITH MTAXAT
REPLACE MSG1    WITH MMSG1
REPLACE MSG2    WITH MMSG2
REPLACE MSG3    WITH MMSG3
REPLACE MSG4    WITH MMSG4
REPLACE MSG5    WITH MMSG5
REPLACE MSG6    WITH MMSG6
REPLACE CONTSAIDA WITH MCONTSAIDA
DBCOMMIT()
UNLOCK
RETURN
   
***********************************/FUN€AO VENDA******************************

FUNCTION VENDA
DO WHILE .T.

    CLEAR GETS
    PUVARPED()
    INIVAPED()
    SETCOLOR("W+/BG,N/W")
    CLS
    HOJE=DATE()
    @ 00,00 TO 02,79 DOUBLE 
    @ 00,02 SAY " MICRO - PE€AS INFORMATICA 5.2 "
    @ 01,27 SAY "³  CUPOM  DE  PEDIDO  ³"
    @ 01,53 SAY "DATA......:"
    @ 01,65 SAY DATE()
    @ 07,01 TO 21,78 DOUBLE
    @ 22,49 SAY "TOTAL GERAL..:"
    @ 22,02 SAY "CODIGO...:"
    @ 22,25 SAY "QTD...:" 
 *   @ 23,01 SAY PADC ("  -  CONVENIO    F4  -  CANCELA PEDIDO",78)     
    MD_NOT=DATE()
    CUPOM()
    CLOSE INDEXES
    GOTO BOTTOM
    MCODNOT=CODNOT+1
    @ 01,02 SAY "N§ CUPOM:"
    @ 01,12 SAY  MCODNOT PICT "999999999"
    @ 03,02 SAY "CLIENTE...:"
    @ 03,52 SAY "FUNCIONARIO:"
    @ 04,02 SAY "ENDERECO..:"
    @ 04,52 SAY "TEL........:"
    @ 05,00 SAY REPL ("ÍÍ",79)
    @ 03,65 GET MCNOTFUNC PICT "99"
    FUNCI()
    READ
    IF LASTKEY()=27
         SET KEY -8 TO OTARIOS() // F9
         EXIT
    ENDIF
    ORDSETFOCUS("CODFUNC")
    
    SEEK MCNOTFUNC
    IF ! FOUND()
         LOOP
    ENDIF
    MNOTFUNC=NOMEFUNC
    SETCOLOR("R/BG,N/W")
    @ 03,65 SAY MNOTFUNC
    CLIENTES()    
    SET KEY -40 TO CONCLI1() // F11                                
    @ 03,13 GET MCNOTCLI PICT "9999"
    READ
    IF LASTKEY()=27
        RETURN(.T.)
    ENDIF
    ORDSETFOCUS("CODCLI")
    SEEK MCNOTCLI    
    IF ! FOUND() .AND. MCNOTCLI <> 0
         OL_Yield()
         ALERT ('CLIENTE NAO CADASTRADO !!!')
         LOOP
       ELSE
        MNOTCLI=NOMECLI
        MENDCLI=ENDCLI
        IF CEL <> "     -    " .OR. ! EMPTY(CEL)
                MTEL=CEL
              ELSE
                MTEL=TEL
        ENDIF
        MBLOQUEIO=BLOQUEIO
        MCODCLI=CODCLI
    ENDIF
    IF MCNOTCLI=1
            MNOTPAG="CREDITO"
         ELSE
            MNOTPAG="CONVENIO"
    ENDIF
    IF MCNOTCLI=0
        MNOTCLI=SPACE(35)
        MENDCLI=SPACE(35)
        MTEL=SPACE(10)
        @ 03,13 GET MNOTCLI PICT "@!" VALID ! EMPTY(MNOTCLI)
        @ 04,13 GET MENDCLI PICT "@!"
        @ 04,65 GET MTEL PICT "99999-9999"
        READ
        IF LASTKEY()=27
                RETURN(.T.)
        ENDIF
    ENDIF
    IF MBLOQUEIO="S" .AND. MCNOTCLI#1 .OR. MCNOTCLI=0
            FORMAPAG()
    ENDIF
    SET KEY -40 TO OTARIOS() // F11
    SETCOLOR("R/BG,N/W")
    @ 03,13 SAY MNOTCLI
    @ 04,13 SAY MENDCLI
    @ 04,65 SAY MTEL
    KEYBOARD CHR(13)
    REIM=0
    CONPEC=0
    PEDIDO()
ENDDO

*************************/FUN€AO REPA€A VARIVEIS PEDIDO***********************

PROCEDURE REPLVANOT
CUPOM()
BLOQUEIO()
CLOSE INDEXES
SET DELE OFF
GOTO BOTTOM
MCODNOT=CODNOT+1
SET DELE ON
DO WHILE MCODNOT=1
       OL_Yield()
       ALERT('CODIGO INICIO; CHAME O MARCELO; DELETE O PEDCUP.CDX E CUPOM.CDX')
       GOTO BOTTOM
       BLOQUEIO()
       DELETE
       UNLOCK
       REPLVANOT()
ENDDO        
ORDSETFOCUS("CODNOT")
DO WHILE .T.
        SEEK MCODNOT
        IF ! FOUND()
                EXIT
        ENDIF
        MCODNOT++
ENDDO
APPEND BLANK
REPLACE ATUALIZADO WITH "S"
REPLACE CODNOT  WITH MCODNOT
REPLACE NOTCLI  WITH MNOTCLI
REPLACE NOTFUNC WITH MNOTFUNC
REPLACE NOTPAG  WITH MNOTPAG
IF DESC1="N"
        REPLACE NOTTOTG WITH MPTOTG
     ELSE
        REPLACE NOTTOTG  WITH TOTDESC
        REPLACE DESCONTO WITH TOTDESC-MPTOTG
ENDIF
IF CRED1="S"
        *INKEY(0)
        REPLACE DESCONTO WITH ((MPTOTG+MABATIMENTO)-TOTDESC)*-1
        REPLACE NOTTOTG  WITH MPTOTG+DESCONTO
        REPLACE ABATIMENTO WITH MABATIMENTO
        REPLACE CODIGO   WITH MCODCRE
ENDIF
REPLACE D_NOT      WITH MD_NOT
REPLACE HORANOT    WITH TIME()
REPLACE P_CUSTO    WITH MCUSTO
UNLOCK
DBCOMMIT()
CUPOM()
RETURN

*************************/FUN€AO IMPRIME ARQUIVO PEDIDO************************

PROCEDURE IMPARQPED
@ PROW(),00 SAY CHR(27)+CHR(51)
@ PROW(),00 SAY CHR(27)+CHR(83)
@ PROW(),00 SAY CHR(27)+CHR(33)
@ PROW(),00 SAY CHR(27)+"!"+CHR(9)
INDEX ON LOCAL TO LOCAL 
TOT=0
DO WHILE .NOT. EOF()
     IF CONPEC=1 .AND. REIM=0      
           IF SEPARA=1
                L_DUPLA()
           ENDIF
           @ LIN,00 SAY LOCAL
           @ PROW(),00 SAY CHR(27)+CHR(51)
           @ PROW(),00 SAY CHR(27)+CHR(83)
           @ PROW(),00 SAY CHR(27)+CHR(33)
           @ PROW(),00 SAY CHR(27)+"!"+CHR(9)
           @ LIN,00 SAY LEFT(PNOMPEC,38)
           IF SEPARA=1
                L_DUPLA()
           ENDIF
           @ LIN,00 SAY PQTDPEC PICT "99"
           @ PROW(),00 SAY CHR(27)+CHR(51)
           @ PROW(),00 SAY CHR(27)+CHR(83)
           @ PROW(),00 SAY CHR(27)+CHR(33)
           @ PROW(),00 SAY CHR(27)+"!"+CHR(9)           
           LIN++
           @ LIN,00 SAY PCODPEC
           IF SEPARA=1
                   @ LIN,15 SAY PFABRIC
           ENDIF
           @ LIN,28 SAY PPREPEC PICT "9999.99"
           @ LIN,43 SAY PPRETOT PICT "99999.99"  
        ELSE
           @ LIN,00 SAY PCODPEC
           @ LIN,10 SAY LEFT(PNOMPEC,38)
           @ LIN,50 SAY PQTDPEC PICT "99"
           LIN++
           *@ LIN,00 SAY PFABRIC
           *@ LIN,15 SAY PNFABRIC
           @ LIN,28 SAY PPREPEC PICT "9999.99"
           @ LIN,43 SAY PPRETOT PICT "99999.99"
     ENDIF
     LIN++
     SKIP
     TOT++
ENDDO
@ LIN,54 SAY " "
@ PROW(),00 SAY CHR(27)+CHR(64)
RETURN

*************************/FUN€AO IGUALA VARIVEIS CLIENTES************************

PROCEDURE IGUAVACLI
MCODCLI=CODCLI
MNOMECLI=NOMECLI
MRESPCLI=RESPCLI
MENDCLI=ENDCLI
MESTADO=ESTADO
MCIDADE=CIDADE
MTAXA=TAXA
MTAXA_DUPLA=TAXA_DUPLA
MMANDANOTA=MANDANOTA
MDT_FECHA=DT_FECHA
MBLOQUEIO=BLOQUEIO
MT_MOTO=T_MOTO
MTEL=TEL
MCGC=CGC
MINSCR=INSCR
MP1=P1
MP2=P2
MP3=P3
MP4=P4
MCEL=CEL
MKM=KM
RETURN

*************************/FUN€AO IGUALA VARIVEIS PEDIDO************************

PROCEDURE IGUAVANOT
MCODNOT=CODNOT
MNOTCLI=NOTCLI
MNOTFUNC=NOTFUNC
MD_NOT=D_NOT
MNOTPAG=NOTPAG
MNOTTOTG=NOTTOTG
MHORANOT=HORANOT
RETURN  2

*************************/FUN€AO IGUALA VARIVEIS ENVIADAS*******************

PROCEDURE IGUAVAENV

MCODNOT=CODNOT
MNOTCLI=NOTCLI
MNOTFUNC=NOTFUNC
MD_NOT=D_NOT
MNOTPAG=NOTPAG
MNOTTOTG=NOTTOTG
MTROCO=TROCO
MNOTDESC=NOTDESC
MMOTOCA=MOTOCA
RETURN  2       

*************************/FUN€AO PUBLICA VARIVEIS ENVIADOS******************

PROCEDURE PUVARENV
PUBLIC MCODNOT,MNOTCLI,MNOTFUNC,MD_NOT,MNOTPAG,MNOTTOTG,MTROCO,MNOTDESC,MMOTOCA
RETURN

*************************/FUN€AO PUBLICA VARIVEIS PEDIDO************************

PROCEDURE PUVARNOT
PUBLIC MCODNOT,MNOTCLI,MNOTFUNC,MD_NOT,MHORANOT,MNOTPAG,MNOTTOTG
RETURN

*************************/FUN€AO MOSTRA TEXTO PEDIDO**************************

PROCEDURE MOSTENOT
@ 07,12 SAY "FUNCIONARIO.:" GET MNOTFUNC  PICT "@!"
@ 09,12 SAY "CLIENTE.....:" GET MNOTCLI     PICT "@!"
@ 11,12 SAY "DATA........:" GET MD_NOT      PICT "99/99/9999"
@ 13,12 SAY "TOTAL PEDIDO:" GET MNOTTOTG    PICT "9999999.99"
@ 15,12 SAY "TIPO PAG....:" GET MNOTPAG     PICT "@!" 
@ 17,12 SAY "HORA CUPOM..:" GET MHORANOT    PICT "99:99"
RETURN

*************************/FUN€AO MOSTRA TEXTO ENVIADAS**********************

PROCEDURE MOSTEENV
@ 06,12 SAY "FUNCIONARIO.:" GET MNOTFUNC  PICT "@!"
@ 07,12 SAY "CLIENTE.....:" GET MNOTCLI     PICT "@!"
@ 08,12 SAY "DATA........:" GET MD_NOT      PICT "99/99/9999"
@ 09,12 SAY "TOTAL PEDIDO:" GET MNOTTOTG    PICT "9999999.99"
@ 10,12 SAY "COM DESCONTO:" GET MNOTDESC    PICT "9999999.99"
@ 11,12 SAY "TIPO PAG....:" GET MNOTPAG     PICT "@!" 
@ 12,12 SAY "TROCO.......:" GET MTROCO      PICT "999.99"
@ 13,12 SAY "MOTOCA......:" GET MMOTOCA     PICT "@!"
RETURN

*************************/FUN€AO REPA€A VARIVEIS CUPOM************************

PROCEDURE REPLNOT
BLOQUEIO()
REPLACE CODNOT  WITH MCODNOT
REPLACE NOTCLI  WITH MNOTCLI
REPLACE NOTFUNC WITH MNOTFUNC
REPLACE NOTPAG  WITH MNOTPAG
REPLACE NOTTOTG WITH MNOTTOTG
REPLACE D_NOT   WITH MD_NOT
REPLACE HORANOT WITH MHORANOT
DBCOMMIT()
UNLOCK
RETURN

*************************/FUN€AO REPA€A VARIVEIS ENVIADOS******************

PROCEDURE REPLENV
BLOQUEIO()
REPLACE CODNOT  WITH MCODNOT
REPLACE NOTCLI  WITH MNOTCLI
REPLACE NOTFUNC WITH MNOTFUNC
REPLACE NOTPAG  WITH MNOTPAG
REPLACE NOTTOTG WITH MNOTTOTG
REPLACE D_NOT   WITH MD_NOT
REPLACE TROCO   WITH MTROCO
REPLACE MOTOCA  WITH MMOTOCA
REPLACE NOTDESC WITH MNOTDESC
DBCOMMIT()
UNLOCK
RETURN

*************************/FUN€AO IGUALA VARIVEIS FORNECEDORES*****************

PROCEDURE IGUAVAFOR
MCODFOR=CODFOR
MNOMEFOR=NOMEFOR
MFORNECEDOR=FORNECEDOR
MVENDEDOR=VENDEDOR
MCELVEN=CELVEN
MTELFOR=TELFOR
MCNPJFOR=CNPJFOR
MENDFOR=ENDFOR
MIEFOR=IEFOR
MBAIRROFOR=BAIRROFOR
MESTFOR=ESTFOR
MDDDFOR=DDDFOR
RETURN

******************************/FUN€AO REINDEX ********************************

FUNCTION REINDEX

SET COLOR TO W+/R*
@ 23,15 SAY "   REORGANIZA€AO EM ANDAMENTO AGUARDE !!!  "
REINPECA()
REINFORN()
REINCLIE()
REINCHE()
REINGARA()
REINFUNC()
REINORCA()
REINORPE()
REINENVIA()
REINCUPO()
REINPEDC()
REINENTR()
REINRELE()
RENTRCLI()
REINMOTO()
REINDEVOL()
REINROTA()
REINPAGA()
REINIBPT()
REINCEST()
REINDECRE()
@ 23,15 SAY " ARQUIVOS ORGANIZADOS COM SUCESSO PRESSIONE ALGO !!! "
RETURN(.T.)

FUNCTION REINPECA
RUN DEL D:\KARVAN\PECAS.CDX
PECASEX()
INDEX ON NFABRIC   TAG NFABRIC TO D:\KARVAN\PECAS
INDEX ON CODPECA   TAG CODPECA TO D:\KARVAN\PECAS 
INDEX ON NOMEPECA  TAG NOMEPECA TO D:\KARVAN\PECAS
INDEX ON FABRIC    TAG FABRIC TO D:\KARVAN\PECAS
INDEX ON DISTRIB   TAG DISTRIPE TO D:\KARVAN\PECAS 
INDEX ON CODBARRA  TAG CODBARRA TO D:\KARVAN\PECAS 
INDEX ON CODBARRA1 TAG CODBARRA1 TO D:\KARVAN\PECAS 
INDEX ON CODBARRA2 TAG CODBARRA2 TO D:\KARVAN\PECAS
INDEX ON CODBARRA3 TAG CODBARRA3 TO D:\KARVAN\PECAS 
INDEX ON CODBARRA4 TAG CODBARRA4 TO D:\KARVAN\PECAS 
INDEX ON DISTRIB   TAG DISTRIB TO D:\KARVAN\PECAS
INDEX ON DISTRIB2  TAG DISTRIB2 TO D:\KARVAN\PECAS
INDEX ON DISTRIB3  TAG DISTRIB3 TO D:\KARVAN\PECAS
INDEX ON DISTRIB4  TAG DISTRIB4 TO D:\KARVAN\PECAS
INDEX ON NFABRIC2  TAG NFABRIC2 TO D:\KARVAN\PECAS
INDEX ON NFABRIC3  TAG NFABRIC3 TO D:\KARVAN\PECAS
INDEX ON NFABRIC4  TAG NFABRIC4 TO D:\KARVAN\PECAS
INDEX ON NFABRIC5  TAG NFABRIC5 TO D:\KARVAN\PECAS
INDEX ON ORIGINAL  TAG ORIGINAL TO D:\KARVAN\PECAS
INDEX ON LOCAL     TAG LOCAL    TO D:\KARVAN\PECAS
INDEX ON LOCAL_E   TAG LOCAL_E  TO D:\KARVAN\PECAS
INDEX ON DATA1     TAG DATA1    TO D:\KARVAN\PECAS DESCENDING

INDEX ON NFABRIC  TAG PNFABRIC  TO D:\KARVAN\PECAS FOR QTDMIN-(QTD+TEMP+TEMPPED)> MULTIPLO .OR. QTDMIN=0 
INDEX ON CODPECA  TAG PCODPECA  TO D:\KARVAN\PECAS FOR QTDMIN-(QTD+TEMP+TEMPPED)> MULTIPLO .OR. QTDMIN=0
INDEX ON NOMEPECA TAG PNOMEPECA TO D:\KARVAN\PECAS FOR QTDMIN-(QTD+TEMP+TEMPPED)> MULTIPLO .OR. QTDMIN=0
INDEX ON FABRIC   TAG PFABRIC   TO D:\KARVAN\PECAS FOR QTDMIN-(QTD+TEMP+TEMPPED)> MULTIPLO .OR. QTDMIN=0
INDEX ON NFABRIC2 TAG PNFABRIC2 TO D:\KARVAN\PECAS FOR QTDMIN-(QTD+TEMP+TEMPPED)> MULTIPLO .OR. QTDMIN=0
INDEX ON NFABRIC3 TAG PNFABRIC3 TO D:\KARVAN\PECAS FOR QTDMIN-(QTD+TEMP+TEMPPED)> MULTIPLO .OR. QTDMIN=0
INDEX ON NFABRIC4 TAG PNFABRIC4 TO D:\KARVAN\PECAS FOR QTDMIN-(QTD+TEMP+TEMPPED)> MULTIPLO .OR. QTDMIN=0
INDEX ON NFABRIC5 TAG PNFABRIC5 TO D:\KARVAN\PECAS FOR QTDMIN-(QTD+TEMP+TEMPPED)> MULTIPLO .OR. QTDMIN=0

RETURN  

FUNCTION REINFORN
RUN DEL d:\karvan\FORNEC.CDX
FORNECEX()
INDEX ON CODFOR     TAG CODFODES   TO d:\karvan\FORNEC DESCENDING
INDEX ON CODFOR     TAG CODFOR     TO d:\karvan\FORNEC
INDEX ON NOMEFOR    TAG NOMEFOR    TO d:\karvan\FORNEC
INDEX ON FORNECEDOR TAG FORNECEDOR TO d:\karvan\FORNEC
INDEX ON VENDEDOR   TAG VENDEDOR   TO d:\karvan\FORNEC
INDEX ON CNPJFOR    TAG CNPJFOR    TO d:\karvan\FORNEC
RETURN

FUNCTION REINIBPT
RUN DEL d:\karvan\IBPT.CDX
IBPT()
SET UNIQUE ON
INDEX ON NCM TAG NCM TO d:\karvan\IBPT
SET UNIQUE OFF
RETURN

FUNCTION REINCEST
RUN DEL d:\karvan\CEST.CDX
CEST()
SET UNIQUE ON
INDEX ON NCM TAG NCM TO d:\karvan\CEST
SET UNIQUE OFF
RETURN

FUNCTION REINENDE
RUN DEL d:\karvan\ENDERECO.CDX
ENDERECO()
INDEX ON CODIGO   TAG CODIGO   TO d:\karvan\ENDERECO
INDEX ON ENDERECO TAG ENDERECO TO d:\karvan\ENDERECO
RETURN

FUNCTION REINNOTA
RUN DEL d:\karvan\NOTAS.CDX
NOTAS()
INDEX ON NOTA    TAG NOTA    TO d:\karvan\NOTAS
INDEX ON RECIBO  TAG RECIBO  TO d:\karvan\NOTAS
INDEX ON DISTRIB TAG DISTRIB TO d:\karvan\NOTAS
INDEX ON DATA    TAG DATA    TO d:\karvan\NOTAS
RETURN

FUNCTION REINPAGA
RUN DEL d:\karvan\PAGAMENTO.CDX
PAGAMENTO()
INDEX ON CLIENTE  TAG CLIENTE  TO d:\karvan\PAGAMENTO
INDEX ON NOMEFUNC TAG NOMEFUNC TO d:\karvan\PAGAMENTO
INDEX ON TIPO     TAG TIPO     TO d:\karvan\PAGAMENTO
INDEX ON FORMA    TAG FORMA    TO d:\karvan\PAGAMENTO
INDEX ON DATA     TAG DATA     TO d:\karvan\PAGAMENTO 
INDEX ON BAIXA    TAG BAIXA    TO d:\karvan\PAGAMENTO
INDEX ON CODIGO   TAG CODIGO   TO d:\karvan\PAGAMENTO
INDEX ON BAIXA    TAG BAIXAN   TO d:\karvan\PAGAMENTO FOR EMPTY(BAIXA) 
RETURN

FUNCTION REINDECRE
RUN DEL d:\karvan\DEVOLCRE.CDX
DEVOLCRE()
INDEX ON NOMECLI TAG NOMECLI  TO d:\karvan\DEVOLCRE
INDEX ON CODNOT  TAG CODNOT   TO d:\karvan\DEVOLCRE
INDEX ON DATA    TAG DATA     TO d:\karvan\DEVOLCRE
INDEX ON CREDITO TAG CREDITO  TO d:\karvan\DEVOLCRE
INDEX ON DATA    TAG DATAB    TO D:\KARVAN\DEVOLCRE FOR EMPTY(BAIXA)
RETURN


FUNCTION REINDEVOL
RUN DEL d:\karvan\DEVOLUCAO.CDX
DEVOLU()
INDEX ON DCODNOT  TAG DCODNOT  TO d:\karvan\DEVOLUCAO
INDEX ON DNOMECLI TAG DNOMECLI TO d:\karvan\DEVOLUCAO
INDEX ON DCODPECA TAG DCODPECA TO d:\karvan\DEVOLUCAO
INDEX ON BAIXA    TAG BAIXA    TO D:\KARVAN\DEVOLUCAO FOR EMPTY(BAIXA)
RETURN

FUNCTION REINENTR
RUN DEL d:\karvan\ENTREGA.CDX
ENTREGA()
INDEX ON PONTO+ENTREGAS TAG PONTOCLI TO d:\karvan\ENTREGA
INDEX ON PONTO    TAG PONTO    TO d:\karvan\ENTREGA
INDEX ON KM       TAG KM       TO d:\karvan\ENTREGA
INDEX ON P_EXC    TAG P_EXC    TO d:\karvan\ENTREGA
INDEX ON CODIGO   TAG CODIGO   TO d:\karvan\ENTREGA
INDEX ON ENTREGAS TAG ENTREGAS TO d:\karvan\ENTREGA
INDEX ON ENDERECO TAG ENDERECO TO d:\karvan\ENTREGA 
RETURN

FUNCTION REINENTRADA
RUN DEL d:\karvan\ENTRADA.CDX
ENTRADA()
INDEX ON ECODPECA TAG ECODPECA TO d:\karvan\ENTRADA
INDEX ON EDISTRIB TAG EDISTRIB TO d:\karvan\ENTRADA
INDEX ON ENUMNOTA TAG ENUMNOTA TO d:\karvan\ENTRADA
INDEX ON EXML     TAG EXML     TO d:\karvan\ENTRADA

RETURN


FUNCTION REINROTA
RUN DEL d:\karvan\ROTA.CDX
ROTA()
INDEX ON ENDERECO TAG ENDERECO TO d:\karvan\ROTA
RETURN

FUNCTION REINMOTO
RUN DEL d:\karvan\MOTOBOY.CDX
MOTOBOY()
INDEX ON MOTOCA  TAG MOTOCA  TO d:\karvan\MOTOBOY
INDEX ON CHEGADA TAG CHEGADA TO d:\karvan\MOTOBOY FOR ! EMPTY(CHEGADA)
INDEX ON CHEGADA TAG CHEGA   TO d:\karvan\MOTOBOY FOR EMPTY(CHEGADA)
RETURN

FUNCTION REINCHE
RUN DEL d:\karvan\CHEQUE.CDX
CHEQUE()
INDEX ON CLIENTE TAG CLIENTE TO d:\karvan\CHEQUE
INDEX ON NOME    TAG NOME    TO d:\karvan\CHEQUE
INDEX ON CPF     TAG CPF     TO d:\karvan\CHEQUE
INDEX ON DATA_D  TAG DATA_D  TO d:\karvan\CHEQUE
INDEX ON DATA_R  TAG DATA_R  TO d:\karvan\CHEQUE
INDEX ON VALOR   TAG VALOR   TO d:\karvan\CHEQUE
INDEX ON OBS     TAG OBS     TO d:\karvan\CHEQUE
RETURN

FUNCTION RENTRCLI
RUN DEL d:\karvan\ENTR_CLI.CDX
ENTREX()
INDEX ON ENTREGA  TAG ENTREGA  TO d:\karvan\ENTR_CLI
INDEX ON CODIGO   TAG CODIGO   TO d:\karvan\ENTR_CLI
INDEX ON CLIENTE  TAG CLIENTE  TO D:\KARVAN\ENTR_CLI
INDEX ON ENDERECO TAG ENDERECO TO D:\KARVAN\ENTR_CLI 
INDEX ON TELEFONE TAG TELEFONE TO D:\KARVAN\ENTR_CLI 
RETURN

FUNCTION REINRELE
RUN DEL d:\karvan\REL_ENTR.CDX
RELEX()
INDEX ON MOTOBOY  TAG MOTOBOY  TO d:\karvan\REL_ENTR
INDEX ON CODENTR  TAG CODENTR  TO d:\karvan\REL_ENTR
INDEX ON SACOLA   TAG SACOLA   TO d:\karvan\REL_ENTR
INDEX ON MAQUINA  TAG MAQUINA  TO d:\karvan\REL_ENTR
INDEX ON DATA     TAG DATA     TO D:\KARVAN\REL_ENTR       
RETURN

FUNCTION REINCLIE
RUN DEL d:\karvan\CLIENTES.CDX
CLIENTEX()
INDEX ON CODCLI TAG CODCLI TO d:\karvan\CLIENTES
INDEX ON NOMECLI TAG NOMECLI TO d:\karvan\CLIENTES
INDEX ON CODCLI TAG CODMEDES TO d:\karvan\CLIENTES DESCENDING
INDEX ON ENDCLI TAG ENDCLI   TO d:\karvan\CLIENTES
RETURN

FUNCTION REINGARA
RUN DEL d:\karvan\GARANTIA.CDX
GARANTIA()
INDEX ON GARCLI    TAG GARCLI   TO d:\karvan\GARANTIA 
INDEX ON GARCOD    TAG GARCOD   TO d:\karvan\GARANTIA 
INDEX ON GARDISTR  TAG GARDISTR TO d:\karvan\GARANTIA 
INDEX ON GARPROTO  TAG GARPROTO TO d:\karvan\GARANTIA 
INDEX ON GARBAIXA  TAG GARBAIXA TO d:\karvan\GARANTIA 
INDEX ON GARDATA   TAG GARDATA  TO d:\karvan\GARANTIA 
INDEX ON GARNFAB   TAG GARNFAB  TO d:\karvan\GARANTIA 
INDEX ON GARFABR   TAG GARNFABR TO d:\karvan\GARANTIA 
INDEX ON DATAENVIO TAG DATAENVIO TO D:\KARVAN\GARANTIA 
INDEX ON GARCLI    TAG GARCLI_B    TO d:\karvan\GARANTIA FOR EMPTY(GARBAIXA)
INDEX ON GARCOD    TAG GARCOD_B    TO d:\karvan\GARANTIA FOR EMPTY(GARBAIXA)
INDEX ON GARDISTR  TAG GARDISTR_B  TO d:\karvan\GARANTIA FOR EMPTY(GARBAIXA)
INDEX ON GARPROTO  TAG GARPROTO_B  TO d:\karvan\GARANTIA FOR EMPTY(GARBAIXA)
INDEX ON GARBAIXA  TAG GARBAIXA_B  TO d:\karvan\GARANTIA FOR EMPTY(GARBAIXA)
INDEX ON GARDATA   TAG GARDATA_B   TO d:\karvan\GARANTIA FOR EMPTY(GARBAIXA)
INDEX ON GARNFAB   TAG GARNFAB_B   TO d:\karvan\GARANTIA FOR EMPTY(GARBAIXA)
INDEX ON GARFABR  TAG GARFABR_B  TO d:\karvan\GARANTIA FOR EMPTY(GARBAIXA)
INDEX ON DATAENVIO TAG DATAENVIO_B TO D:\KARVAN\GARANTIA FOR EMPTY(GARBAIXA)
RETURN       

FUNCTION REINFUNC
RUN DEL d:\karvan\FUNC.CDX
FUNCEX()
INDEX ON CODFUNC  TAG CODFUNC TO d:\karvan\FUNC
INDEX ON NOMEFUNC TAG NOMEFUNC TO d:\karvan\FUNC
RETURN


FUNCTION REINORCA
RUN DEL d:\karvan\ORCA.CDX
ORCA()
INDEX ON CODNOT TAG CODNODES TO d:\karvan\ORCA DESCENDING 
INDEX ON CODNOT TAG CODNOT TO d:\karvan\ORCA 
INDEX ON NOTFUNC TAG NOTFUNC TO d:\karvan\ORCA 
INDEX ON NOTCLI TAG NOTCLI TO d:\karvan\ORCA
INDEX ON D_NOT TAG D_NOT TO d:\karvan\ORCA
RETURN

FUNCTION REINCUPO
RUN DEL d:\karvan\CUPOM.CDX
CUPOMEX()
INDEX ON CODNOT  TAG CODNODES TO d:\karvan\CUPOM DESCENDING 
INDEX ON CODNOT  TAG CODNOT   TO d:\karvan\CUPOM 
INDEX ON NOTFUNC TAG NOTFUNC  TO d:\karvan\CUPOM 
INDEX ON NOTCLI  TAG NOTCLI   TO d:\karvan\CUPOM
INDEX ON CNPJCLI TAG CNPJCLI  TO d:\karvan\CUPOM
INDEX ON CODIGO  TAG CODIGO   TO d:\karvan\CUPOM
INDEX ON D_NOT   TAG D_NOT    TO d:\karvan\CUPOM
INDEX ON NOTPAG  TAG NOTPAG   TO d:\karvan\CUPOM DESCENDING
INDEX ON NOTPAG  TAG ABERTOS  TO d:\karvan\CUPOM FOR NOTPAG="CONVENIO" .OR. NOTPAG="ASSINAR"

SET UNIQUE ON
INDEX ON NOTCLI  TAG NOTCLIUNI TO d:\karvan\CUPOM
SET UNIQUE OFF
RETURN

FUNCTION REINENVIA
RUN DEL d:\karvan\ENVIADOS.CDX
ENVIAEX()
INDEX ON CODNOT  TAG CODNOT   TO d:\karvan\ENVIADOS
INDEX ON NOTFUNC TAG NOTFUNC  TO d:\karvan\ENVIADOS 
INDEX ON NOTCLI  TAG NOTCLI   TO d:\karvan\ENVIADOS
INDEX ON MOTOCA  TAG MOTOCA   TO d:\karvan\ENVIADOS
RETURN
                           
FUNCTION REINPEDC
RUN DEL d:\karvan\PEDCUP.CDX
PEDCUPEX()
INDEX ON PEDNUM TAG PEDNUM TO d:\karvan\PEDCUP 
INDEX ON PEDCOD TAG PEDCOD TO d:\karvan\PEDCUP
RETURN

FUNCTION REINORPE
RUN DEL d:\karvan\ORCAPED.CDX
ORCAPED()
INDEX ON PEDNUM TAG PEDNUM TO d:\karvan\ORCAPED
INDEX ON PEDCOD TAG PEDCOD TO d:\karvan\ORCAPED
RETURN


************************FUN€AO DEVOLU€AO**************************************

FUNCTION DEVOLUCAO

IF ACESSO#1
     OL_Yield()  
     ALERT('ACESSO NAO AUTORIZADO')
     RETURN(.T.)
ENDIF

DCODNOT=0
CLEAR GETS
SETCOLOR("W+/N,R/W")
@ 10,20 CLEAR TO 14,54
@ 10,20 TO 14,54 DOUBLE
@ 12,21 SAY "DIGITE O N§ DO CUPOM.:" GET DCODNOT PICT "999999999"
READ
IF LASTKEY()=27
   RETURN(.T.)
ENDIF

CUPOM()
ORDSETFOCUS("CODNOT")
SEEK DCODNOT

IF FOUND()
    MNOTCLI=NOTCLI
    MNOTFUNC=NOTFUNC
    @ 10,20 CLEAR TO 16,65
    @ 10,20 TO 16,65 DOUBLE
    @ 11,21 SAY "N§ DO CUPOM.:"
    @ 11,36 SAY DCODNOT
    @ 13,21 SAY "CLIENTE:"
    @ 13,30 SAY NOTCLI
    @ 15,21 SAY "DATA :"
    @ 15,28 SAY D_NOT
    @ 15,44 SAY "TOTAL :"
    @ 15,50 SAY NOTTOTG
  ELSE
    MNOTCLI="ERRO"
    DTOC=DATE()
    OL_Yield()
    ALERT('CUPOM NAO ENCONTRADO')
ENDIF

SETCOLOR("W+/R*,N/W")
IF CONFIRMA ("CONFIRMA A EXCLUSAO DESTE CUPOM ?")=1

        DO WHILE .T.
                HANDLE := FOPEN("d:\karvan\DEVOLUCA.TXT", 2)
                IF FERROR() # 0
                       SETCOLOR("W+/R,N/W")
                       @ 10,18 CLEAR TO 12,48
                       @ 10,18 TO 12,48 DOUBLE
                       SETCOLOR("W+*/R,N/W")
                       @ 11,19 SAY "TENTANDO ACESSO, AGUARDE !!!"
                       INKEY(0.1)
                       SETCOLOR("W+/BG,N/W")
                       @ 10,18 CLEAR TO 12,48
                       LOOP
                    ELSE
                       EXIT
                ENDIF
        ENDDO
        BUFFER=SPACE(1024)
        BLOCO=1024
        DO WHILE FREAD(HANDLE,@BUFFER,BLOCO) # 0
                FREAD(HANDLE,@BUFFER,BLOCO)
        ENDDO
        FWRITE(HANDLE,+CHR(13)+CHR(10))
        FWRITE(HANDLE,ALLTRIM(STR(DCODNOT)))
        FWRITE(HANDLE,SPACE(4))
        FWRITE(HANDLE,MNOTCLI+CHR(13)+CHR(10))
        FWRITE(HANDLE,MNOTFUNC)
        FWRITE(HANDLE,SPACE(1))
        FWRITE(HANDLE,FUNCIONARIO)
        FWRITE(HANDLE,SPACE(1))
        FWRITE(HANDLE,DTOC(DATE()))
        FWRITE(HANDLE,SPACE(1))
        FWRITE(HANDLE,TIME())
        FWRITE(HANDLE,+CHR(13)+CHR(10))
        @ 20,33 SAY "AGUARDE !!!"
        TRAVAPED()
        MTRAVA=TRAVAPED
        DO WHILE ! EMPTY(MTRAVA)
                OL_Yield()
                ALERT('AGUARDE A LIBERACAO E PRESSIONE ENTER')
                *SELE 5
                MTRAVA=TRAVAPED
        ENDDO        
        BLOQUEIO()
        REPLACE TRAVAPED WITH "S"
        UNLOCK
        DBCOMMIT()

        DO WHILE .T.

           PEDCUP()
           ORDSETFOCUS("PEDNUM")
           SEEK DCODNOT
           IF FOUND()
                   DPEDCOD=PEDCOD
                   DQTDPED=PEDQTD
                   MVERIFIC=VERIFIC
                   BLOQUEIO()
                   DELETE 
                   UNLOCK
        
                   FWRITE(HANDLE,DPEDCOD+CHR(13)+CHR(10))
                   CUPOM()
                   ORDSETFOCUS("CODNOT")
                   SEEK DCODNOT
                   MD_NOT=D_NOT
                   PECAS()
                   ORDSETFOCUS("CODPECA")
                   SEEK DPEDCOD
                   BLOQUEIO()
                   DISTRIBQTD=DQTDPED
                   DQTDPED=DQTDPED+QTD
                   REPLACE QTD WITH DQTDPED
                   IF QTD_C>0
                        XMQTD=DISTRIBQTD
                        DO WHILE QTD_P<QTD_C .AND. XMQTD>0
                                REPLACE QTD_P WITH QTD_P+1
                                XMQTD--
                        ENDDO                
                        IF XMQTD>0
                                REPLACE QTD_E WITH QTD_E+XMQTD
                        ENDIF        
                   ENDIF
                   REPLACE ATUALIZADO WITH "S"
                   IF MVERIFIC<=1
                                REPLACE QTD2 WITH QTD2+DISTRIBQTD
                   ENDIF     
                   IF MVERIFIC=2
                                      REPLACE QTD3 WITH QTD3+DISTRIBQTD
                   ENDIF     
                   IF MVERIFIC=3
                                      REPLACE QTD4 WITH QTD4+DISTRIBQTD
                   ENDIF     
                   IF MVERIFIC=4
                                      REPLACE QTD5 WITH QTD5+DISTRIBQTD
                   ENDIF     
                   IF MVERIFIC=5
                                      REPLACE QTD6 WITH QTD6+DISTRIBQTD
                   ENDIF                                          
                   DIA1=DAY(DATE())
                   DIA2=DAY(DATE()-DIA1)
                   DIA3=DAY(DATE()-DIA1-DIA2)
                   IF CMONTH(MD_NOT)=CMONTH(DATE())
                            REPLACE QTDMAX WITH QTDMAX-DISTRIBQTD
                       ELSEIF CMONTH(MD_NOT)=CMONTH(DATE()-DIA1)
                            REPLACE QTDMAX1 WITH QTDMAX1-DISTRIBQTD
                       ELSEIF CMONTH(MD_NOT)=CMONTH(DATE()-DIA1-DIA2)
                            REPLACE QTDMAX2 WITH QTDMAX2-DISTRIBQTD
                       ELSEIF CMONTH(MD_NOT)=CMONTH(DATE()-DIA1-DIA2-DIA3)
                            REPLACE QTDMAX3 WITH QTDMAX3-DISTRIBQTD
                   ENDIF
                   ENTRADISTRIB()
               ELSE
                   EXIT
           ENDIF
        ENDDO
        DBCOMMIT()
        UNLOCK
        FCLOSE(HANDLE)        
        SETCOLOR("W+/R,N/W")
        CUPOM()
        ORDSETFOCUS("CODNOT")
        SEEK DCODNOT
        IF FOUND()
              BLOQUEIO()
              DELETE
              UNLOCK 
           ELSE
              @ 12,21 SAY "CUPOM NAO ENCONTRADO !!!!"
              INKEY(0)
              RETURN(.T.)
        ENDIF        
        ORDSETFOCUS("CODNODES")
        ENTREGA()
        ORDSETFOCUS("CODIGO")
        SEEK DCODNOT
        IF FOUND()
              BLOQUEIO()
              DELETE
              UNLOCK 
        ENDIF
        ENVIADOS()
        ORDSETFOCUS("CODNOT")
        SEEK DCODNOT
        IF FOUND()
              BLOQUEIO()
              DELETE
              UNLOCK 
        ENDIF
        TRAVAPED()
        BLOQUEIO()
        REPLACE TRAVAPED WITH " "
        DBCOMMIT()
        UNLOCK        
        OL_Yield()
        ALERT('TAREFA CONCLUIDA !!! PRESSIONE <ENTER> !!!')
    ELSE
        RETURN(.T.)
ENDIF
RETURN(.T.)

*************************/FUN€AO DELETA ARQUIVOS DEFINITIVA********************

FUNCTION DEL
CLEAR GETS
IF ACESSO#1 .OR. ALLTRIM(FUNCIONARIO) # "MARCELO"
     OL_Yield()
     ALERT('ACESSO NAO AUTORIZADO')
     RETURN(.T.)
ENDIF
IF CONFIRMA ("CONFIRMA A EXCLUSAO DEFINITIVA")=1
    PECASEX()
    PACK
    CLIENTEX()
    PACK
    PEDCUPEX()
    PACK
    FORNECEX()
    PACK
    CUPOMEX()
    PACK
    FUNCEX()
    PACK
    GARANTEX()
    PACK
    ENTREX()
    PACK
    RELEX()
    PACK
    ENVIAEX()
    PACK
    @ 23,10 SAY "TAREFA CONCLUIDA !!! PRESSIONE <ENTER> !!!"
ENDIF
RETURN(.T.)

************************FUN€AO RECUPERA ARQUIVOS DELETADOS**************************************

FUNCTION REC
CLEAR GETS
IF ACESSO#1 .OR. ALLTRIM(FUNCIONARIO) # "MARCELO"
     OL_Yield()
     ALERT('ACESSO NAO AUTORIZADO')
     RETURN(.T.)
ENDIF
IF CONFIRMA ("CONFIRMA A RECUPERA€AO ?")=1
      CLIENTES()
      NUMREG=1
      RESTORE SCREEN FROM FTELA
      DO WHILE NUMREG <= LASTREC()
         GOTO NUMREG
	 IF DELETED()
            SETCOLOR("W+/BG,N/W")
            @ 05,11 CLEAR TO 19,66
            @ 05,11 TO 19,66 DOUBLE
            @ 05,14 SAY "³  RECUPERA€AO DE CLIENTES  ³"
            PUVARCLI()
            IGUAVACLI()
            CLEAR GETS
            @ 06,14 SAY "Codigo........:"  GET MCODCLI PICT "@!"
            MOSTECLI()
            IF CONFIRMA ("CONFIRMA A RECUPERA€AO DESTE REGISTRO ?")=1
                 BLOQUEIO()
                 RECALL
                 UNLOCK
            ENDIF
         ENDIF
         NUMREG++
      ENDDO
      PECAS()
      NUMREG=1
      CLEAR GETS
      XCODPECA=SPACE(05)
      @ 01,01 SAY "DIGITE O CODIGO" GET XCODPECA PICT "@!"
      READ
      DO WHILE NUMREG <= LASTREC()
         GOTO NUMREG
         IF DELETED()
            SETCOLOR("W+/BG,N/W")
            @ 00,02 CLEAR TO 23,76
            @ 00,02 TO 23,76 DOUBLE
            @ 00,12 SAY "RECUPERA PECAS"
            PUVARPE()
            IGUAVARPE()
            CLEAR GETS
            @ 01,04 SAY "Codigo:" GET MCODPECA PICT "@!"
            MOSTEXPE()
            IF EMPTY(XCODPECA)
                    IF CONFIRMA ("CONFIRMA A RECUPERA€AO DESTE REGISTRO ?")=1
                         BLOQUEIO()
                         RECALL
                         UNLOCK
                    ENDIF
                ELSE
                    IF XCODPECA=CODPECA
                        IF CONFIRMA ("CONFIRMA A RECUPERA€AO DESTE REGISTRO ?")=1
                                BLOQUEIO()
                                RECALL
                                UNLOCK
                        ENDIF
                    ENDIF
            ENDIF
         ENDIF
         NUMREG++
      ENDDO
      FORNEC()
      NUMREG=1
      RESTORE SCREEN FROM FTELA
      DO WHILE NUMREG <= LASTREC()
         GOTO NUMREG
	 IF DELETED()
            SETCOLOR("W+/BG,N/W")
            @ 05,09 CLEAR TO 18,69
            @ 05,09 TO 18,69 DOUBLE
            @ 05,24 SAY "³  RECUPERA€AO DE FORNECEDORES  ³"
            PUVARFOR()
            IGUAVAFOR()
            CLEAR GETS
            @ 07,13 SAY "Codigo........:"  GET MCODFOR PICT "@!"
            MOSTEFOR()
            IF CONFIRMA ("CONFIRMA A RECUPERA€AO DESTE REGISTRO ?")=1
                 BLOQUEIO()
                 RECALL
                 UNLOCK
            ENDIF
	 ENDIF
         NUMREG++
      ENDDO
    ELSE
    RETURN
ENDIF
OL_Yield()
ALERT('TAREFA CONCLUIDA !!! PRESSIONE <ENTER> !!!')
RETURN(.T.)

**************************FUNCAO INICIA VARIAVEIS GARANTIA***********************
        
PROCEDURE INIVARGA
MGCUSTO=0
MGNUMNOTA=SPACE(09)
MGARCOD=SPACE(05)
MGARVEN=SPACE(10)
MGARCLI=SPACE(35)
MGARPECA=SPACE(45)
MGARNFAB=SPACE(12)
MGARFABR=SPACE(10)
MGARQTD=0
MGARDATA=DATE()
MGARDEF1=SPACE(40)
MGARDEF2=SPACE(40)
MGARDISTR=SPACE(20)
MGARPROTO=SPACE(20)
MDATAENVIO=DATAENVIO
MGARBAIXA=SPACE(01)
MHORAGAR=HORAGAR
RETURN
**************************FUNCAO PUBLICA VARIAVEIS GARANTIA***********************
PROCEDURE PUVARGA
PUBLIC MGARCLI,MGARPECA,MGARNFAB,MGARFABR,MGARQTD,MGARDATA,MGARVEN,MGARCOD,MGNUMNOTA
PUBLIC MGARDEF1,MGARDEF2,MGARDISTR,MGARPROTO,MGARBAIXA,MDATAENVIO,MGCUSTO,MHORAGAR
RETURN

*************************/FUN€AO REPA€A VARIVEIS GARANTIA************************
FUNCTION REPLGAR
BLOQUEIO()
REPLACE GARCOD   WITH MGARCOD 
REPLACE GARVEN   WITH MGARVEN 
REPLACE GARCLI   WITH MGARCLI 
REPLACE GARPECA  WITH MGARPECA
REPLACE GARFABR  WITH MGARFABR
REPLACE GARNFAB  WITH MGARNFAB
REPLACE GARQTD   WITH MGARQTD
REPLACE GARDATA  WITH MGARDATA
REPLACE GARDEF1  WITH MGARDEF1
REPLACE GARDEF2  WITH MGARDEF2
REPLACE GARDISTR WITH MGARDISTR
REPLACE GARPROTO WITH MGARPROTO
REPLACE DATAENVIO WITH MDATAENVIO
REPLACE GARBAIXA WITH MGARBAIXA
REPLACE HORAGAR  WITH MHORAGAR
REPLACE GCUSTO WITH MGCUSTO
REPLACE GNUMNOTA WITH MGNUMNOTA
DBCOMMIT()
UNLOCK
RETURN

*************************/FUN€AO IGUALA VARIVEIS GARANTIA**********************

PROCEDURE IGUAVARGA
MGNUMNOTA=GNUMNOTA
MGCUSTO=GCUSTO
MGARCOD=GARCOD
MGARVEN=GARVEN
MGARCLI=GARCLI
MGARPECA=GARPECA
MGARFABR=GARFABR
MGARNFAB=GARNFAB
MGARQTD=GARQTD
MGARDATA=GARDATA
MGARDEF1=GARDEF1
MGARDEF2=GARDEF2
MGARDISTR=GARDISTR
MGARPROTO=GARPROTO
MDATAENVIO=DATAENVIO
MGARBAIXA=GARBAIXA
MHORAGAR=HORAGAR
RETURN

*************************/FUN€AO ACESSO A ALTERA€OES\**************************

FUNCTION ACESSO
ACESSO=0
IF DESC1="N"
    SAVE SCREEN TO FTELA
ENDIF
CLEAR GETS
WSENHA=SPACE(10)
@ 10,10 CLEAR TO 13,33
@ 10,10 TO 13,33 DOUBLE
@ 11,12 SAY "DIGITE SENHA ACESSO:"
WSENHA=ASTERISCO(12,17)
SENHADBF()
LOCATE FOR WSENHA=DECRYPT(SENHA)
IF ! FOUND()
        OL_Yield()
        ALERT('SENHA NAO CADASTRADA')
    ELSE
        ACESSO=DIREITO
        FUNCIONARIO=NOMESENHA
ENDIF
RESTORE SCREEN FROM FTELA
RETURN

*****************************/FUN€AO CONSULTA CLIENTES************************

FUNCTION CONCLI1
SAVE SCREEN TO FTELA

CLIENTES()
SET KEY -40 TO OTARIOS() // F11


SETCOLOR("GR/B+")
PRIVATE V1[2], V2[2], V3[2]

V1[01]="CODCLI"
V1[02]="NOMECLI"

V2[01]="9999"
V2[02]="@!"

V3[01]="CODIGO"
V3[02]="CLIENTE"

@ 00,00 TO 00,79 DOUBLE
@ 22,00 TO 24,79 DOUBLE

DBEDIT(01,00,21,79,v1,"WDBEDIT",v2,v3,chr(205),space(1)+chr(179))


function Wdbedit(modo,coluna)
if modo=1
   return(1)
elseif modo=2
   return(1)
elseif modo=3
    RESTORE SCREEN FROM FTELA
    SETCOLOR("W+/BG,N/W")
    return(0)
elseif modo=4
       if lastkey() == 27
          set softseek off
          RESTORE SCREEN FROM FTELA
          SETCOLOR("W+/BG,N/W")

          SET KEY -40 TO CONCLI1() // F11

          return(0)
    elseif lastkey()== 50 && "2"
          SET CURSOR ON
          CLEAR GETS
          SET SOFTSEEK ON
          SETCOLOR("W+/BG,N/W")
          V_BUSCA:=SPACE(15)
          SET CURSOR ON
          @ 03,20 CLEAR TO 05,52
          @ 03,20 TO 05,52 DOUBLE
          @ 04,22 SAY "NOME CLIENTE:" GET V_BUSCA PICT "@!"
          READ          
          IF EMPTY(V_BUSCA)
                ORDSETFOCUS("NOMECLI")
              ELSE
                INDEX ON NOMECLI TO TEMP FOR RTRIM(V_BUSCA) $ NOMECLI
          ENDIF
          IF EOF()
             SKIP-1
             RETURN(1)
          ENDIF
          RETURN(2)

       ELSEIF LASTKEY() == 13   && "ENTER"
          RESTORE SCREEN FROM FTELA
          SETCOLOR("W+/BG,N/W")
          MCNOTCLI=CODCLI
          MCODCLI=CODCLI
          MNOMECLI=NOMECLI
          SET KEY -40 TO CONCLI1() // F11
          RETURN(0)
      ENDIF
ENDIF
RETURN(1)


*****************************/FUN€AO CONSULTA FORNECEDOR**********************

FUNCTION CONFOR1
SAVE SCREEN TO FTELA

FORNEC()
SET KEY -40 TO OTARIOS() // F11


SETCOLOR("GR/B+")
PRIVATE V1[2], V2[2], V3[2]

V1[01]="CODFOR"
V1[02]="NOMEFOR"

V2[01]="9999"
V2[02]="@!"

V3[01]="CODIGO"
V3[02]="DISTRIBUIDOR"

@ 00,00 TO 00,79 DOUBLE
@ 22,00 TO 24,79 DOUBLE

DBEDIT(01,00,21,79,v1,"TDBEDIT",v2,v3,chr(205),space(1)+chr(179))


function Tdbedit(modo,coluna)
if modo=1
   return(1)
elseif modo=2
   return(1)
elseif modo=3
    RESTORE SCREEN FROM FTELA
    SETCOLOR("W+/BG,N/W")
    return(0)
elseif modo=4
       if lastkey() == 27
          set softseek off
          RESTORE SCREEN FROM FTELA
          SETCOLOR("W+/BG,N/W")

          SET KEY -40 TO CONFOR1() // F11

          return(0)
    elseif lastkey()== 50 && "2"
          SET CURSOR ON
          CLEAR GETS
          SET SOFTSEEK ON
          SETCOLOR("W+/BG,N/W")
          V_BUSCA:=SPACE(15)
          SET CURSOR ON
          @ 03,20 CLEAR TO 05,52
          @ 03,20 TO 05,52 DOUBLE
          @ 04,22 SAY "NOME DISTRIB:" GET V_BUSCA PICT "@!"
          READ          
          IF EMPTY(V_BUSCA)
                ORDSETFOCUS("NOMEFOR")
              ELSE
                INDEX ON NOMEFOR TO TEMP FOR RTRIM(V_BUSCA) $ NOMEFOR
          ENDIF
          IF EOF()
             SKIP-1
             RETURN(1)
          ENDIF
          RETURN(2)

       ELSEIF LASTKEY() == 13   && "ENTER"
          RESTORE SCREEN FROM FTELA
          SETCOLOR("W+/BG,N/W")
          MCODFOR=CODFOR
          MCREDOR=NOMEFOR          
          ORDSETFOCUS("CODFOR")
          *SET KEY -40 TO CONCLI1() // F11
          RETURN(0)
      ENDIF
ENDIF
RETURN(1)


*****************************/FUN€AO IMPRIME FIM CUPOM\************************

PROCEDURE MOSTEXCUPOM

DADOS2()

@ LIN,02 SAY PADC ("------------------------------",40)
@ PROW(),00 SAY CHR(27)+CHR(51)
@ PROW(),00 SAY CHR(27)+CHR(83)
@ PROW(),00 SAY CHR(27)+"!"+CHR(1)
LIN++
@ LIN,03 SAY PADC (MENS1,53) 
LIN++
@ LIN,03 SAY PADC (MENS2,53) 
LIN++
@ LIN,03 SAY PADC (TELE +"/"+ FAX,54)
@ LIN,00 SAY " " 
LIN++
@ PROW(),00 SAY CHR(27)+CHR(64)
@ LIN,03 SAY PADC ("------------------------------",40)
@ LIN,03 SAY PADC ("*** CUPOM SEM VALOR FISCAL ***",40)
RETURN

*****************************/FUN€AO DADOS EMPRESA/***************************

FUNCTION DADOS
IF ACESSO#1
      OL_Yield()
      ALERT('ACESSO NAO AUTORIZADO')
      RETURN(.T.)
ENDIF
DADOS2()

LS=12
LI=14
CE=14
CD=65

PUVARDA()
INIVARDA()
CLEAR GETS
SETCOLOR("W+/BG,N/W")
DO WHILE LS#02
   @ LS,CE CLEAR TO LI,CD
   @ LS,CE TO LI,CD DOUBLE
   LS--
   LI++
   CE--
   CD++
   INKEY(0.01)
ENDDO
SET CURSOR ON
IGUAVARDA()
@ 03,27 SAY "³   ALTERA DADOS EMPRESA   ³"
@ 04,13 SAY "RazÆo Social..:" GET MRSOCIAL PICT "@!"
@ 05,13 SAY "Nome Abreviado:" GET MNOMEABR PICT "@!"
@ 06,13 SAY "Endere‡o......:" GET MENDEMPR PICT "@!"
@ 07,13 SAY "Bairro........:" GET MBAIRRO  PICT "@!"
@ 08,13 SAY "Cidade........:" GET MCIDADE  PICT "@!"
@ 08,44 SAY "Cep:" GET MCEP     PICT "99999-999"
@ 08,59 SAY "Estado:" GET MESTADO  PICT "@!"
@ 09,13 SAY "CGC...........:" GET MCGCEMPR PICT "99.999.999/9999-99"
@ 10,13 SAY "Inscri‡Æo Est.:" GET MINSCEST PICT "999.999.999.999"
@ 11,13 SAY "Fone..........:" GET MTELE    PICT "9999-9999"
@ 12,13 SAY "Mens. 1§linha.:" GET MMENS1   PICT "@!"
@ 13,13 SAY "Mens. 2§linha.:" GET MMENS2   PICT "@!"
@ 14,13 SAY "Valor Taxa S..:" GET Mtaxas   PICT "999.99"
@ 15,13 SAY "Valor Taxa T..:" GET Mtaxat     PICT "999.99"
@ 16,13 SAY "Qtd.Saida Moto:" GET Mcontsaida PICT "99"
@ 17,13 SAY "MENSAGEM 1....:" GET MMSG1 PICT "@!"
@ 18,13 SAY "MENSAGEM 2....:" GET MMSG2 PICT "@!"
@ 19,13 SAY "MENSAGEM 3....:" GET MMSG3 PICT "@!"
@ 20,13 SAY "MENSAGEM 4....:" GET MMSG4 PICT "@!"
@ 21,13 SAY "MENSAGEM 5....:" GET MMSG5 PICT "@!"
@ 22,13 SAY "MENSAGEM 6....:" GET MMSG6 PICT "@!"
READ
IF CONFIRMA ("GRAVA ESSE REGISTRO ?")=1
   REPLDA()
ENDIF
RETURN .T.

***********************/FUN€åES PARA ACESSO AOS BANCOS DE DADOS\**************

FUNCTION DADOS2
USE d:\karvan\DADOS SHARED
IF NETERR()
        OL_Yield()
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')
        DADOS2()
ENDIF    
RETURN

FUNCTION CLIENTES
USE d:\karvan\CLIENTES SHARED 
IF NETERR()
        OL_Yield()
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')   
        CLIENTES()
ENDIF
IF FILE ("d:\karvan\CLIENTES.CDX")
        SET INDEX TO d:\karvan\CLIENTES
ENDIF
RETURN

FUNCTION ORCA
USE d:\karvan\ORCA SHARED 
IF NETERR()
        OL_Yield()  
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')   
        ORCA()
ENDIF
RETURN

FUNCTION CHEQUE
USE d:\karvan\CHEQUE SHARED 
IF NETERR()
        OL_Yield()
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')   
        CHEQUE()
ENDIF
RETURN

FUNCTION ORCAPED
USE d:\karvan\ORCAPED SHARED 
IF NETERR()
        OL_Yield()  
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')
        ORCAPED()
ENDIF
RETURN

FUNCTION PEDIDOEX
USE PEDIDO EXCLUSIVE
DO WHILE NETERR()
        SETCOLOR("W+*/R,N/W")
        OL_Yield()
        ALERT ('EXISTE ARQUIVO(S) ABERTO EM OUTRO TERMINAL VERIFIQUE !!!')
        PEDIDOEX()
ENDDO
RETURN


FUNCTION CLIENTEX
USE d:\karvan\CLIENTES EXCLUSIVE
DO WHILE NETERR()
        SETCOLOR("W+*/R,N/W")
        OL_Yield()
        ALERT ('EXISTE ARQUIVO(S) ABERTO EM OUTRO TERMINAL VERIFIQUE !!!')
        CLIENTEX()
ENDDO
IF FILE ("d:\karvan\CLIENTES.CDX")
        SET INDEX TO d:\karvan\CLIENTES
ENDIF
RETURN

FUNCTION CONFEREX
USE d:\KARVAN\CONFERE\CONFERE EXCLUSIVE
DO WHILE NETERR()
        SETCOLOR("W+*/R,N/W")
        OL_Yield()
        ALERT ('EXISTE ARQUIVO(S) ABERTO EM OUTRO TERMINAL VERIFIQUE !!!')
        CONFEREX()
ENDDO
RETURN

FUNCTION ENTREGEX
USE d:\karvan\ENTREGA EXCLUSIVE
DO WHILE NETERR()
        SETCOLOR("W+/R*,N/W")
        OL_Yield()
        ALERT ('AGUARDE, ARQUIVOS ABERTOS')
        CLOSE ALL
        RETURN
ENDDO   
IF FILE ("d:\karvan\ENTREGA.CDX")
        SET INDEX TO d:\karvan\ENTREGA
ENDIF
PACK
CLOSE ALL
RETURN

FUNCTION RELEX
USE d:\karvan\REL_ENTR EXCLUSIVE
DO WHILE NETERR()
        SETCOLOR("W+*/R,N/W")
        OL_Yield()
        ALERT ('EXISTE ARQUIVO(S) ABERTO EM OUTRO TERMINAL VERIFIQUE !!!')
        RELEX()
ENDDO   
IF FILE ("d:\karvan\REL_ENTR.CDX")
        SET INDEX TO d:\karvan\REL_ENTR
ENDIF
RETURN

FUNCTION ORCAEX
USE d:\karvan\ORCA EXCLUSIVE
DO WHILE NETERR()
        SETCOLOR("W+*/R,N/W")
        OL_Yield()
        ALERT ('EXISTE ARQUIVO(S) ABERTO EM OUTRO TERMINAL VERIFIQUE !!!')
        ORCAEX()
ENDDO   
IF FILE ("d:\karvan\ORCA.CDX")
        SET INDEX TO d:\karvan\ORCA
ENDIF
RETURN

FUNCTION ORCAPEDEX
USE d:\karvan\ORCAPED EXCLUSIVE
DO WHILE NETERR()
        SETCOLOR("W+*/R,N/W")
        OL_Yield()
        ALERT ('EXISTE ARQUIVO(S) ABERTO EM OUTRO TERMINAL VERIFIQUE !!!')
        ORCAPEDEX()
ENDDO   
IF FILE ("d:\karvan\ORCAPED.CDX")
        SET INDEX TO d:\karvan\ORCAPED
ENDIF
RETURN

FUNCTION ENTREX
USE d:\karvan\ENTR_CLI EXCLUSIVE
DO WHILE NETERR()
        SETCOLOR("W+*/R,N/W")
        OL_Yield()
        ALERT ('EXISTE ARQUIVO(S) ABERTO EM OUTRO TERMINAL VERIFIQUE !!!')
        ENTREX()
ENDDO   
IF FILE ("d:\karvan\ENTR_CLI.CDX")
        SET INDEX TO d:\karvan\ENTR_CLI
ENDIF
RETURN


FUNCTION ROTA
USE d:\karvan\ROTA.DBF
IF NETERR()
        OL_Yield()
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')   
        ROTA()
ENDIF
IF FILE ("d:\karvan\ROTA.CDX")
        SET INDEX TO d:\karvan\ROTA
ENDIF

FUNCTION CUPOM
USE d:\karvan\CUPOM SHARED
IF NETERR()
        OL_Yield()
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')   
        CUPOM()
ENDIF
IF FILE ("d:\karvan\CUPOM.CDX")
        SET INDEX TO d:\karvan\CUPOM
ENDIF
RETURN

FUNCTION ENVIADOS
USE d:\karvan\ENVIADOS SHARED
IF NETERR()
        OL_Yield()
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')   
        ENVIADOS()
ENDIF
IF FILE ("d:\karvan\ENVIADOS.CDX")
        SET INDEX TO d:\karvan\ENVIADOS
ENDIF
RETURN                                 

FUNCTION CUPOMEX
USE d:\karvan\CUPOM EXCLUSIVE
DO WHILE NETERR()
        SETCOLOR("W+*/R,N/W")
        OL_Yield()
        ALERT ('EXISTE ARQUIVO(S) ABERTO EM OUTRO TERMINAL VERIFIQUE !!!')
        CUPOMEX()
ENDDO
IF FILE ("d:\karvan\CUPOM.CDX")
        SET INDEX TO d:\karvan\CUPOM
ENDIF
RETURN

FUNCTION ENVIAEX
USE d:\karvan\ENVIADOS EXCLUSIVE
DO WHILE NETERR()
        SETCOLOR("W+*/R,N/W")
        OL_Yield()
        ALERT ('EXISTE ARQUIVO(S) ABERTO EM OUTRO TERMINAL VERIFIQUE !!!')
        ENVIAEX()
ENDDO
IF FILE ("d:\karvan\ENVIADOS.CDX")
        SET INDEX TO d:\karvan\ENVIADOS
ENDIF
RETURN

FUNCTION FECHA
USE d:\karvan\FECHA SHARED 
IF NETERR()
        OL_Yield()
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')
        FECHA()
ENDIF
IF FILE ("d:\karvan\FECHA.CDX")
        SET INDEX TO d:\karvan\FECHA
ENDIF
RETURN

FUNCTION FORNEC
USE d:\karvan\FORNEC SHARED 
IF NETERR()
        OL_Yield()
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')   
        FORNEC()
ENDIF
IF FILE ("d:\karvan\FORNEC.CDX")
        SET INDEX TO d:\karvan\FORNEC
ENDIF
RETURN

FUNCTION FORNECEX
USE d:\karvan\FORNEC EXCLUSIVE
DO WHILE NETERR()
        SETCOLOR("W+*/R,N/W")
        OL_Yield()
        ALERT ('EXISTE ARQUIVO(S) ABERTO EM OUTRO TERMINAL VERIFIQUE !!!')
        FORNECEX()
ENDDO
IF FILE ("d:\karvan\FORNEC.CDX")
        SET INDEX TO d:\karvan\FORNEC
ENDIF
RETURN

FUNCTION FUNCEX
USE d:\karvan\FUNC EXCLUSIVE
DO WHILE NETERR()
        SETCOLOR("W+*/R,N/W")
        OL_Yield()
        ALERT ('EXISTE ARQUIVO(S) ABERTO EM OUTRO TERMINAL VERIFIQUE !!!')
        FUNCEX()
ENDDO
IF FILE ("d:\karvan\FUNC.CDX")
        SET INDEX TO d:\karvan\FUNC
ENDIF
RETURN

FUNCTION FUNCI
USE d:\karvan\FUNC SHARED 
IF NETERR()  
        OL_Yield() 
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')
        FUNCI()
ENDIF
IF FILE ("d:\karvan\FUNC.CDX")
        SET INDEX TO d:\karvan\FUNC
ENDIF
RETURN

FUNCTION GARANTEX
USE d:\karvan\GARANTIA EXCLUSIVE
DO WHILE NETERR()
        SETCOLOR("W+*/R,N/W")
        OL_Yield()
        ALERT ('EXISTE ARQUIVO(S) ABERTO EM OUTRO TERMINAL VERIFIQUE !!!')
        GARANTEX()
ENDDO
IF FILE ("d:\karvan\GARANTIA.CDX")
        SET INDEX TO d:\karvan\GARANTIA
ENDIF
RETURN


FUNCTION GARANTIA
USE d:\karvan\GARANTIA SHARED
CLOSE INDEXES
IF NETERR()  
        OL_Yield() 
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')
        GARANTIA()
ENDIF
IF FILE ("d:\karvan\GARANTIA.CDX")
         SET INDEX TO d:\karvan\GARANTIA
ENDIF
RETURN

FUNCTION PECAS
USE D:\KARVAN\PECAS SHARED  
IF NETERR()
        OL_Yield()
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')   
        PECAS()
ENDIF
IF FILE ("D:\KARVAN\PECAS.CDX")
        SET INDEX TO D:\KARVAN\PECAS
ENDIF
RETURN

FUNCTION ENDERECO
USE D:\KARVAN\ENDERECO SHARED  
IF NETERR()
        OL_Yield()
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')   
        ENDERECO()
ENDIF
RETURN

FUNCTION DEVOLCRE
USE D:\KARVAN\DEVOLCRE SHARED  
IF NETERR()
        OL_Yield()
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')   
        DEVOLCRE()
ENDIF
IF FILE ("D:\KARVAN\DEVOLCRE.CDX")
        SET INDEX TO D:\KARVAN\DEVOLCRE
ENDIF
RETURN

FUNCTION DEVOLCEX
USE D:\KARVAN\DEVOLCRE EXCLUSIVE  
IF NETERR()
        OL_Yield()
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')   
        DEVOLCEX()
ENDIF
IF FILE ("D:\KARVAN\DEVOLCRE.CDX")
        SET INDEX TO D:\KARVAN\DEVOLCRE
ENDIF
RETURN    

FUNCTION ENTRADA
USE D:\KARVAN\ENTRADA SHARED  
IF NETERR()
        OL_Yield()
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')   
        ENTRADA()
ENDIF
IF FILE ("D:\KARVAN\ENTRADA.CDX")
        SET INDEX TO D:\KARVAN\ENTRADA
ENDIF
RETURN


FUNCTION CEST
USE d:\KARVAN\CEST SHARED  
IF NETERR()
        OL_Yield()
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')   
        CEST()
ENDIF
IF FILE ("d:\KARVAN\CEST.CDX")
        SET INDEX TO d:\karvan\CEST
ENDIF
RETURN                             

FUNCTION IBPT
USE d:\KARVAN\IBPT SHARED  
IF NETERR()
        OL_Yield()
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')   
        IBPT()
ENDIF
IF FILE ("d:\KARVAN\IBPT.CDX")
        SET INDEX TO d:\karvan\IBPT
ENDIF
RETURN

FUNCTION PAGAMENTO
USE d:\karvan\PAGAMENTO SHARED  
IF NETERR()
        OL_Yield()
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')   
        PAGAMENTO()
ENDIF
IF FILE ("d:\karvan\PAGAMENTO.CDX")
        SET INDEX TO d:\karvan\PAGAMENTO
ENDIF
RETURN

FUNCTION PAGAMENTEX
USE d:\karvan\PAGAMENTO EXCLUSIVE
IF NETERR()
        OL_Yield()
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')   
        PAGAMENTO()
ENDIF
IF FILE ("d:\karvan\PAGAMENTO.CDX")
        SET INDEX TO d:\karvan\PAGAMENTO
ENDIF
RETURN
         
FUNCTION NOTAS
USE d:\karvan\NOTAS SHARED  
IF NETERR()
        OL_Yield()
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')   
        NOTAS()
ENDIF
IF FILE ("d:\karvan\NOTAS.CDX")
        SET INDEX TO d:\karvan\NOTAS
ENDIF
RETURN

FUNCTION DEVOLU
USE d:\karvan\DEVOLUCAO SHARED  
IF NETERR()  
        OL_Yield() 
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')
        DEVOLU()
ENDIF
IF FILE ("d:\karvan\DEVOLUCAO.CDX")
        SET INDEX TO d:\karvan\DEVOLUCAO
ENDIF
RETURN

FUNCTION DEVOLEX
USE d:\karvan\DEVOLUCAO EXCLUSIVE
IF NETERR()  
        OL_Yield() 
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')
        DEVOLU()
ENDIF
IF FILE ("d:\karvan\DEVOLUCAO.CDX")
        SET INDEX TO d:\karvan\DEVOLUCAO
ENDIF
RETURN


FUNCTION ENTR_CLI
USE d:\karvan\ENTR_CLI SHARED  
IF NETERR()  
        OL_Yield() 
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')
        ENTR_CLI()
ENDIF
IF FILE ("d:\karvan\ENTR_CLI.CDX")
        SET INDEX TO d:\karvan\ENTR_CLI
ENDIF
RETURN

FUNCTION ENTR_CLEX
USE d:\karvan\ENTR_CLI EXCLUSIVE
IF NETERR()  
        OL_Yield() 
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')
        ENTR_CLI()
ENDIF
IF FILE ("d:\karvan\ENTR_CLI.CDX")
        SET INDEX TO d:\karvan\ENTR_CLI
ENDIF
RETURN

FUNCTION TRAVA()
USE d:\karvan\TRAVA SHARED  
IF NETERR()
        OL_Yield()
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')    
        TRAVA()
ENDIF
RETURN

FUNCTION TRAVAPED()
USE d:\karvan\TRAVAPED SHARED  
IF NETERR()
        OL_Yield()
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')    
        TRAVAPED()
ENDIF
RETURN
         
FUNCTION FISCAL()
USE d:\karvan\FISCAL SHARED  
IF NETERR()
        OL_Yield()
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')    
        FISCAL()
ENDIF
RETURN

FUNCTION MOTOBOY
USE d:\karvan\MOTOBOY SHARED  
IF NETERR()
        OL_Yield()
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')   
        MOTOBOY()
ENDIF
IF FILE ("d:\karvan\MOTOBOY.CDX")
        SET INDEX TO d:\karvan\MOTOBOY
ENDIF
RETURN

FUNCTION ENTREGA
USE d:\karvan\ENTREGA SHARED  
IF NETERR()
        OL_Yield()
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')   
        ENTREGA()
ENDIF
IF FILE ("d:\karvan\ENTREGA.CDX")
        SET INDEX TO d:\karvan\ENTREGA
ENDIF
RETURN

FUNCTION REL_ENTR
USE d:\karvan\REL_ENTR SHARED  
IF NETERR()
        OL_Yield()  
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')   
        REL_ENTR()
ENDIF
IF FILE ("d:\karvan\REL_ENTR.CDX")
        SET INDEX TO d:\karvan\REL_ENTR
ENDIF
RETURN

FUNCTION REL_ENTEX
USE d:\karvan\REL_ENTR EXCLUSIVE
IF NETERR()
        OL_Yield()  
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')   
        REL_ENTR()
ENDIF
IF FILE ("d:\karvan\REL_ENTR.CDX")
        SET INDEX TO d:\karvan\REL_ENTR
ENDIF
RETURN


FUNCTION SENHADBF
USE d:\karvan\SENHA SHARED 
IF NETERR()
        OL_Yield()  
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')   
        SENHADBF()
ENDIF
RETURN
         
FUNCTION PECASEX
USE D:\KARVAN\PECAS EXCLUSIVE
DO WHILE NETERR()
        SETCOLOR("W+*/R,N/W")
        OL_Yield()
        ALERT ('EXISTE ARQUIVO(S) ABERTO EM OUTRO TERMINAL VERIFIQUE !!!')
        PECASEX()
ENDDO
IF FILE ("D:\KARVAN\PECAS.CDX")
        SET INDEX TO D:\KARVAN\PECAS
ENDIF
RETURN

FUNCTION PEDCUP
USE d:\karvan\PEDCUP SHARED
IF NETERR()
        OL_Yield()
        ALERT('REDE NAO ENCONTRADA, TENTE NOVAMENTE')
        PEDCUP()
ENDIF
IF FILE ("d:\karvan\PEDCUP.CDX")
        SET INDEX TO d:\karvan\PEDCUP
ENDIF
RETURN

FUNCTION PEDCUPEX
USE d:\karvan\PEDCUP EXCLUSIVE
DO WHILE NETERR()
        SETCOLOR("W+*/R,N/W")
        OL_Yield()
        ALERT('EXISTE ARQUIVO(S) ABERTO EM OUTRO TERMINAL AGUARDE')
        PEDCUPEX()
ENDDO
IF FILE ("d:\karvan\PEDCUP.CDX")
        SET INDEX TO d:\karvan\PEDCUP
ENDIF
RETURN
   
***********************************/FUN€AO REIMPRIME******************************

FUNCTION REIMCUPO()
SET KEY -8 TO OTARIOS() // F9
REIM=1
MABATIMENTO=0
CRED1="N"
DO WHILE .T.
   CLEAR GETS
   SETCOLOR("W+/N,R/W")
   @ 10,20 CLEAR TO 14,54
   @ 10,20 TO 14,54 DOUBLE
   @ 12,21 SAY "DIGITE O N§ DO CUPOM.:" GET MCODNOT PICT "999999999"
   READ
   IF LASTKEY()=27
      RETURN(.T.)
   ENDIF
   CUPOM()
   ORDSETFOCUS("CODNOT")
   SEEK MCODNOT
   IF FOUND()
        MDESCONTO=DESCONTO
        MNOTCLI=NOTCLI
        MD_NOT=D_NOT
        MHORANOT=HORANOT
        MNOTFUNC=NOTFUNC
        MNOTPAG=NOTPAG
        MABATIMENTO=ABATIMENTO
        IF MABATIMENTO<0
                CRED1="S"
        ENDIF
     ELSE
        OL_Yield()
        ALERT('CUPOM NAO ENCONTRADO !!!!')
        RETURN(.T.)
   ENDIF   
   SETCOLOR("W+/BG,N/W")
   CLS
   @ 00,00 CLEAR TO 04,79
   @ 00,00 TO 02,79 DOUBLE 
   @ 00,02 SAY " MICRO - PE€AS INFORMATICA 5.2 "
   @ 01,27 SAY "³  CUPOM  DE  PEDIDO  ³"
   @ 01,53 SAY "DATA......:"
   @ 01,65 SAY MD_NOT
   @ 06,01 TO 21,78 DOUBLE
   @ 22,49 SAY "TOTAL GERAL..:"
   @ 22,02 SAY "CODIGO...:"
   @ 22,25 SAY "QTD...:" 
   @ 23,01 SAY PADC ("  -  CONVENIO    F4  -  CANCELA PEDIDO",78)     
   @ 01,02 SAY "N§ CUPOM:"
   @ 01,12 SAY  MCODNOT  
   @ 03,02 SAY "CLIENTE...:"
   @ 03,52 SAY "FUNCIONARIO:"
   @ 04,00 SAY REPL ("ÍÍ",79)
   SETCOLOR("R*/BG,N/W")
   @ 03,65 SAY MNOTFUNC
   @ 03,15 SAY MNOTCLI
   CLIENTES()
   ORDSETFOCUS("NOMECLI")
   SEEK MNOTCLI
   MCNOTCLI=CODCLI
   IF FOUND()
        MENDCLI=ENDCLI
        IF tel="    -    "
                MTEL=CEL
             ELSE
                MTEL=TEL
        ENDIF
      ELSE
        ENDERECO()
        ORDSETFOCUS("CODIGO")
        SEEK MCODNOT
        IF FOUND()
                MENDCLI=ENDERECO
                MTEL=TELEFONE
             ELSE
                MENDCLI=SPACE(35)
                MTEL=SPACE(09)
        ENDIF
   ENDIF S
   SETCOLOR("W+/BG,N/W")
   PEDIDOEX()
   ZAP
   PEDCUP()
   ORDSETFOCUS("PEDNUM")
   SEEK MCODNOT
   IF FOUND()
         NUMREG=RECNO()
      ELSE
         OL_Yield() 
         ALERT('DELETE A NOTA, NAO TEM PECA CADASTRADA')
         RETURN(.T.)
   ENDIF
   TOT=0
   DO WHILE .T.
                GOTO NUMREG
                IF PEDNUM=MCODNOT 
                        IF DELETED()
                                NUMREG++
                                LOOP
                        ENDIF
                        TOT++
                        MPEDCOD=PEDCOD
                        MPEDQTD=PEDQTD
                        MPRECO=PRECOCUP
                        MVERIFIC=VERIFIC
                        PECAS()
                        ORDSETFOCUS("CODPECA")
                        SEEK MPEDCOD
                        IF FOUND()
                                MNOMEPECA=NOMEPECA
                                MPUNIDAD=UNIDADE
                                MPRETOT=MPRECO*MPEDQTD
                                IF MVERIFIC <=1
                                        MFABRIC=FABRIC
                                        MNFABRIC=NFABRIC
                                ENDIF
                                IF MVERIFIC=2
                                        MFABRIC=FABRIC2
                                        MNFABRIC=NFABRIC2
                                ENDIF
                                IF MVERIFIC=3
                                        MFABRIC=FABRIC3
                                        MNFABRIC=NFABRIC3
                                ENDIF
                                IF MVERIFIC=4
                                        MFABRIC=FABRIC4
                                        MNFABRIC=NFABRIC4
                                ENDIF
                                IF MVERIFIC=5
                                        MFABRIC=FABRIC5
                                        MNFABRIC=NFABRIC5
                                ENDIF
                             ELSE
                                @ 10,10 CLEAR TO 12,18
                                @ 10,10 TO 12,28 DOUBLE
                                @ 11,11 SAY MPEDCOD
                                OL_Yield()
                                ALERT('CODIGO NAO EXISTE, VERIFIQUE O ERRO')
                                RETURN
                        ENDIF
                        PEDIDOEX()
                        APPEND BLANK
                        REPLACE PCODPEC  WITH MPEDCOD
                        REPLACE PQTDPEC  WITH MPEDQTD
                        REPLACE PNOMPEC  WITH MNOMEPECA
                        REPLACE PPREPEC  WITH MPRECO
                        REPLACE PFABRIC  WITH MFABRIC
                        REPLACE PNFABRIC WITH MNFABRIC
                        REPLACE PPRETOT  WITH MPRETOT
                        REPLACE PUNIDAD  WITH MPUNIDAD
                        PEDCUP()
                        NUMREG++
                    ELSE
                       EXIT
                ENDIF
   ENDDO
   EXIT
ENDDO

DESC=0
DESC1="N"
MTROCO=0

PEDIDOEX()

    SETCOLOR("W+/BG,N/W")
    PRIVATE V1[6], V2[6], V3[6]

     V1[01]="PNOMPEC"
     V1[02]="PQTDPEC"
     V1[03]="PUNIDAD"
     V1[04]="PPREPEC"
     V1[05]="PPRETOT"
     V1[06]="PNFABRIC"
   
     V2[01]="@!"
     V2[02]="999"
     V2[03]="@!"
     V2[04]="9999.99"
     V2[05]="99999.99"
     V2[06]="@!"
   
     V3[01]="DESCRI€ŽO"
     V3[02]="QTD"
     V3[03]="UN"
     V3[04]="PRE€O"
     V3[05]="TOTAL"
     V3[06]="N.FABRIC."

SOMATOTAL()

DBEDIT(05,02,20,77,v1,"R2DBEDIT",v2,v3,chr(205),space(1)+chr(179))

function R2Dbedit(modo,coluna)


SET KEY  28 TO ACESSO()  // F1
SET KEY -8 TO DESC1() // F9
PEDIDOEX()
         
SETCURSOR (1)
if modo=1
    return(1)
  elseif modo=2
    return(1)
  elseif modo=3
     KEYBOARD CHR(13)
     KEYBOARD CHR(-2)
  elseif modo=4
     if lastkey() == 27
         set softseek off
          return(1)
       
       ELSEIF LASTKEY()== 13 && "ENTER"
              TELA1=SAVESCREEN(07,02,19,76)
        DO WHILE .T.
              NFABRQTD=0
              TELA=SAVESCREEN(07,02,19,76)
              PEDIDOEX()
              SOMATOTAL()
              SETCOLOR("R/BG,N/W")
              @ 22,37 SAY TOT PICT "99"
              @ 22,40 SAY "PE€AS"
              @ 22,65 SAY MPTOTG PICT "99999.99"
              SETCOLOR("W+/BG,N/W")
              INKEY(0)
              IF LASTKEY()=27

                  SET KEY -41 TO OTARIOS() // F12

                  PEDIDOEX()
                  RESTSCREEN(07,02,19,76,TELA1)
                  IF ! EOF()
                     KEYBOARD CHR(03)
                  ENDIF
                  RETURN(1)
              ENDIF
        ENDDO	
	

        elseif lastkey()== -2   && "F3 VENDA CONVENIO"

                IF MPTOTG=0
                   OL_Yield()
                   ALERT('NENHUMA PE€A INCLUIDA NO PEDIDO')
                   SET KEY -8 TO OTARIOS() // F9
                   SET KEY  28 TO OTARIOS() // F1
                   PEDIDOEX()
                   ZAP
                   RETURN(0)
                ENDIF
                IF MDESCONTO <> 0
                      DESC1()
                ENDIF
                SETCOLOR("W+/BG,N/W")
                SET CENT OFF
                SET DEVICE TO PRINT
                *Printer()
                LIN=0
                IF MNOTCLI#"CONSUMIDOR"
                        @ PROW(),00 SAY CHR(27)+CHR(64)
                        @ PROW(),00 SAY CHR(27)+"!"+CHR(9)
                        @ LIN,00 SAY "CODIGO:"
                        @ LIN,07 SAY MCODNOT PICT "999999999"
                        @ LIN,18 SAY "VALOR:"
                        @ LIN,24 SAY MPTOTG PICT "999999.99"
                        IF DESC1="S"
                                @ LIN,34 SAY "="
                                @ LIN,35 SAY TOTDESC PICT "99999.99"
                                LIN++
                                IF MTROCO > 0
                                        LIN++
                                        @ LIN,03 SAY MTROCO-TOTDESC PICT "9999.99"
                                        @ LIN,10 SAY "DE TROCO / TROCO PARA:"
                                        @ LIN,33 SAY MTROCO PICT "99,999.99"
                                ENDIF
                        ENDIF
                        LIN=LIN+5
                        @ LIN,00 SAY " "
                ENDIF
                *@ PROW(),00 SAY CHR(27)+chr(109)
                @ LIN,01 SAY "CLIENTE.:"
                @ LIN,11 SAY MNOTCLI
                LIN++
                @ LIN,01 SAY "ENDERECO:"
                @ LIN,11 SAY MENDCLI
                LIN++
                @ PROW(),00 SAY CHR(27)+CHR(33)
                @ PROW(),00 SAY CHR(27)+"!"+CHR(9)
                @ LIN,01 SAY "PAGAMENTO:" + MNOTPAG
                @ LIN,22 SAY MTEL 
                LIN++
                @ LIN,54 SAY " "
                @ PROW(),00 SAY CHR(27)+CHR(64)
                @ PROW(),00 SAY CHR(27)+"!"+CHR(1)                
                @ LIN,02 SAY PADC("REIMPRESSAO",40)
                DADOS2()
                LIN++
                @ LIN,02 SAY RSOCIAL
                LIN++
                @ LIN,02 SAY ENDEMPR
                LIN++
                @ LIN,02 SAY "ORCAMENTO:"
                @ LIN,12 SAY MCODNOT PICT "999999999"
                @ LIN,23 SAY "DATA:"
                @ LIN,28 SAY MD_NOT 
                @ LIN,37 SAY "HORA:"
                @ LIN,42 SAY MHORANOT PICT "99:99"
                LIN++
                @ LIN,02 SAY MNOTFUNC
                @ LIN,12 SAY "*** ORCAMENTO ***"
                @ LIN,35 SAY "1 VIA"
                LIN++
                @ LIN,02 SAY PADC("-------------------------------------",40)
                LIN++  
                PEDIDOEX()                
                IMPARQPED()
                @ LIN,33 SAY "----------"
                LIN++
                @ LIN,10 SAY "TOTAL PECAS ========>"
                @ LIN,32 SAY MPTOTG PICT "99,999.99"
                LIN++
                        IF CRED1="S"
                                MV_CREDITO=MABATIMENTO
                                @ LIN,10 SAY "CREDITO...: ========>"
                                IF MV_CREDITO<MPTOTG
                                        @ LIN,32 SAY  MABATIMENTO PICT "99,999.99"
                                     ELSE
                                        @ LIN,32 SAY  MABATIMENTO PICT "99,999.99"
                                ENDIF
                                LIN++
                                @ LIN,10 SAY "TOTAL .....:========>"
                                @ LIN,32 SAY  MPTOTG+MABATIMENTO PICT "99,999.99"
                        ENDIF
                        IF DESC1="S"
                                IF (MPTOTG-TOTDESC)>0
                                        @ LIN,33 SAY  "----------"
                                        LIN++
                                        *@ PROW(),00 SAY CHR(27)+CHR(33)
                                        *@ PROW(),00 SAY CHR(27)+"!"+CHR(8)
                                        @ LIN,10 SAY "TOTAL COM DESC======>"
                                        @ LIN,32 SAY  TOTDESC PICT "99,999.99"
                                        LIN++
                                        *@ LIN,54 SAY " "
                                        *@ PROW(),00 SAY CHR(27)+CHR(64)
                                        *@ PROW(),00 SAY CHR(27)+"!"+CHR(0)
                                ENDIF
                                IF MTROCO > 0
                                        @ LIN,10 SAY "TROCO DE   =========>"
                                        @ LIN,32 SAY MTROCO-TOTDESC PICT "99,999.99"
                                        LIN++
                                        @ LIN,10 SAY "TROCO PARA =========>"
                                        @ LIN,32 SAY MTROCO PICT "99,999.99"
                                        LIN++
                                ENDIF
                        ENDIF              
                        @ LIN,03 SAY TOT PICT "99"
                        @ LIN,07 SAY "PRODUTO(S)"
                        LIN++
                MOSTEXCUPOM()
                LIN++
                LIN++
                LIN++
                @ LIN,01 SAY " "
                @ PROW(),00 SAY CHR(27)+chr(109)
                LIN=0
                SET DEVICE TO SCREEN
                @ 10,28 CLEAR TO 14,55
                @ 10,28 TO 14,55 DOUBLE
                @ 11,29 SAY "(ENTER) P/IMPRIMIR 2§ VIA"
                @ 12,29 SAY "     (ESC) PARA SAIR"     
                INKEY(0)
                if desc1="S"
                        INKEY(0)
                endif
                SET DEVICE TO PRINT

             IF LASTKEY()#27
                        GUILHOTINA()
                        NORMAL()
                        LIN=0
                        SET DEVICE TO SCREEN
                        PRINTER()
                        *IF LASTKEY()#27 .AND. MNOTCLI#"CONSUMIDOR"
                                VIA++
                                IMPCABEC()
                                PEDIDOEX()
                                IMPARQPED()
                                @ LIN,33 SAY "----------"
                                LIN++
                                @ LIN,10 SAY "TOTAL PECAS =========>"
                                @ LIN,32 SAY  MPTOTG PICT "99,999.99"
                                LIN++
                                IF CRED1="S"
                                        @ LIN,10 SAY "CREDITO...: ========>"
                                        IF MV_CREDITO<MPTOTG
                                                @ LIN,32 SAY  MABATIMENTO PICT "99,999.99"
                                             ELSE
                                                @ LIN,32 SAY  MABATIMENTO PICT "99,999.99"
                                        ENDIF
                                        LIN++
                                        @ LIN,10 SAY "TOTAL .....:========>"
                                        @ LIN,32 SAY  MPTOTG+MABATIMENTO PICT "99,999.99"
                                ENDIF
                                LIN++
                                *IF MNOTCLI="CONSUMIDOR"
                                    IF DESC1="S"
                                            IF (MPTOTG-TOTDESC)>0
                                                    @ LIN,33 SAY  "----------"
                                                    LIN++
                                                    *@ PROW(),00 SAY CHR(27)+CHR(33)
                                                    *@ PROW(),00 SAY CHR(27)+"!"+CHR(8)
                                                    @ LIN,10 SAY "TOTAL COM DESC======>"
                                                    @ LIN,32 SAY  TOTDESC PICT "99,999.99"
                                                    LIN++
                                                    *@ PROW(),00 SAY CHR(27)+CHR(64)
                                                    *@ PROW(),00 SAY CHR(27)+"!"+CHR(0)
                                            ENDIF
                                    ENDIF
                                *ENDIF
                                @ LIN,03 SAY TOT PICT "99"
                                @ LIN,07 SAY "PRODUTO(S)"
                                LIN++
                MOSTEXCUPOM()
                LIN++
                LIN++
                LIN++
                @ LIN,01 SAY " "
                @ PROW(),00 SAY CHR(27)+chr(109)
                LIN=0
             ENDIF
             CUPOM()
             ORDSETFOCUS("CODNOT")
             SEEK MCODNOT
             BLOQUEIO()
             IF DESC1="S"
                    REPLACE NOTTOTG WITH MPTOTG-(MPTOTG+MABATIMENTO-TOTDESC)
                    REPLACE DESCONTO WITH (MPTOTG+MABATIMENTO-TOTDESC)*-1
                 ELSE
                    REPLACE NOTTOTG WITH MPTOTG
             ENDIF
             UNLOCK
             ENVIADOS()
             ORDSETFOCUS("CODNOT")
             SEEK MCODNOT
             IF FOUND()
                     CANHOTO()
             ENDIF
             SET DEVICE TO SCREEN
             SET KEY -8 TO OTARIOS() // F9
             SET KEY -7 TO OTARIOS() // F8               
             SET KEY  28 TO OTARIOS()  // F1
             PEDIDOEX()
             ZAP
             RETURN(0)

        elseif lastkey()== -3   && "F4 CANCELA CONVENIO"
                
           IF EOF()
                OL_Yield()
                ALERT('NENHUMA PE€A INCLUIDA NO PEDIDO')
                SET KEY -8 TO OTARIOS() // F9
                SET KEY  28 TO OTARIOS()  // F1
                PEDIDOEX()
                ZAP
                RETURN(0)
           ENDIF
           SET KEY -8 TO OTARIOS() // F9
           SET KEY  28 TO OTARIOS()  // F1
           PEDIDOEX()
           ZAP
           RETURN(0)
     ENDIF

ENDIF                
REIM=0
RETURN(1)
   
**********************/FUN€AO IMPRIME FORMA DE PAGAMENTO**********************

FUNCTION IMPRIME
                        SET DEVICE TO PRINT
                        *Printer()
                        LIN++
                        IMPCABEC()
                        USE C:\TEMP\PEDIDO
                        CONPEC=1
                        IMPARQPED()
                        FORMPAG()
                        LIN=LIN+2
                        MOSTEXCUPOM()
                        LIN=LIN+3
                        @ LIN,00 SAY " "
                        @ PROW(),00 SAY CHR(27)+CHR(109)
                        LIN=0
RETURN(.T.)

******************************************************************************

FUNCTION SOMATOTAL
MPTOTG=0
MPTOTG2=0
NUMREG=1
GOTO NUMREG
VENDATOTAL=0
VENDACUSTO=0
PCUSTO=0
DO WHILE .NOT. EOF()
     MPTOTG=PPRETOT+MPTOTG
     VENDACUSTO=VENDACUSTO+(PCUSTO*PQTDPEC)
     IF CONFERE="S"
             BLOQUEIO()
             *REPLACE PPRETOT WITH PC_PRECO*PQTDPEC
             REPLACE PPRETOT2 WITH PC_PRECO*PQTDPEC2 
             UNLOCK
             MPTOTG2=PPRETOT2+MPTOTG2             
             VENDATOTAL=VENDATOTAL+(PPRECO*PQTDPEC2)
     ENDIF
     NUMREG++
     GOTO NUMREG
ENDDO
RETURN
 
******************************************************************************

FUNCTION BLOQUEIO
DO WHILE .NOT. RLOCK()
     SETCOLOR("W+/R,N/W")
     @ 10,18 CLEAR TO 12,48
     @ 10,18 TO 12,48 DOUBLE
     SETCOLOR("W+*/R,N/W")
     @ 11,19 SAY "TENTANDO ACESSO, AGUARDE !!!"
     INKEY(0.1)
     SETCOLOR("W+/BG,N/W")
     @ 10,18 CLEAR TO 12,48
     RLOCK()
ENDDO
RLOCK()
RETURN 
*-----------------------------------------------------------------------------------------

FUNCTION CALC
SAVE SCREEN TO FTELA
do CALCULA

*******************************************************************************
PROCEDURE CALCULA
   L_SOM=7
   C_SOM="47"
   MOVCAL_X=6
   MOVCAL_Y=0
   
   Cal_cur=Setcursor(0)
   SET CURSOR OFF
   M->CALCU_X=ROW()
   M->CALCU_Y=05
   M->CACU_COR=SETCOLOR()
   L_CALCU=L_SOM
   C_CALCU=C_SOM
   
    SOMBRA_CAL(L_SOM,C_SOM,.T.)
    M->CA_TELA=SAVESCREEN(MOVCAL_X+0,MOVCAL_Y+47,MOVCAL_X+16,MOVCAL_Y+79)
   
        set color to /w
         @ MOVCAL_X+0,MOVCAL_Y+50 clear to MOVCAL_X+15,MOVCAL_Y+78
         SOMBRA_CAL(MOVCAL_X+0,MOVCAL_Y+50,MOVCAL_X+15,MOVCAL_Y+78)
         @ MOVCAL_X+0,MOVCAL_Y+50 to MOVCAL_X+15,MOVCAL_Y+78 DOUBLE
   
   
   set color to /w
   @ 01+MOVCAL_X,53+MOVCAL_Y SAY "       Calculadora      "

   @ 02+MOVCAL_X,52+MOVCAL_Y SAY "ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ"
   @ 03+MOVCAL_X,52+MOVCAL_Y SAY "³"
   @ 04+MOVCAL_X,52+MOVCAL_Y SAY "À"
        set color to w+/w
   @ 02+MOVCAL_X,76+MOVCAL_Y SAY "¿"
   @ 03+MOVCAL_X,54+MOVCAL_Y SAY "                      ³"
   @ 04+MOVCAL_X,53+MOVCAL_Y SAY "ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ"
   
   setcolor("w+/r")
   @ 14+MOVCAL_X,53+MOVCAL_Y SAY "<Ctrl>+Setas Movimenta"
        set color to /w+
        set color to /w+,/w+
   
   BOT_CALC(06+MOVCAL_X,53+MOVCAL_Y," 7 ")
   BOT_CALC(06+MOVCAL_X,58+MOVCAL_Y," 8 ")
   BOT_CALC(06+MOVCAL_X,63+MOVCAL_Y," 9 ")
   BOT_CALC(08+MOVCAL_X,53+MOVCAL_Y," 4 ")
   BOT_CALC(08+MOVCAL_X,58+MOVCAL_Y," 5 ")
   BOT_CALC(08+MOVCAL_X,63+MOVCAL_Y," 6 ")
   BOT_CALC(10+MOVCAL_X,53+MOVCAL_Y," 1 ")
   BOT_CALC(10+MOVCAL_X,58+MOVCAL_Y," 2 ")
   BOT_CALC(10+MOVCAL_X,63+MOVCAL_Y," 3 ")
   BOT_CALC(12+MOVCAL_X,53+MOVCAL_Y,"  0  ")
   BOT_CALC(12+MOVCAL_X,61+MOVCAL_Y,"  .  ")
   BOT_CALC(06+MOVCAL_X,MOVCAL_Y+69," - ")
   BOT_CALC(12+MOVCAL_X,MOVCAL_Y+74," % ")
   BOT_CALC(08+MOVCAL_X,MOVCAL_Y+69," + ")
   BOT_CALC(08+MOVCAL_X,MOVCAL_Y+74," * ")
   BOT_CALC(10+MOVCAL_X,MOVCAL_Y+74," / ")
   BOT_CALC(10+MOVCAL_X,MOVCAL_Y+69," = ")
   BOT_CALC(06+MOVCAL_X,MOVCAL_Y+74," C ")
   M->C_RESULT=0
   M->C_ALGA=SPACE(14)
   M->C_DEC=""
   M->C_DIG=CHR(0)
   M->C_VAR="C_ALGA"
   M->C_VERDAD=.F.
   set color to /w,w
   @ 03+MOVCAL_X,54+MOVCAL_Y SAY " "+STR(M->C_RESULT,19,2)+" "
   M->C_UOPER=""
   M->C_PERC=" "
   DO WHILE M->C_DIG<>CHR(27)
      M->C_DIG=CHR(INKEY(0))
      IF M->C_DIG="7" .OR. M->C_DIG=CHR(1)
         BOT_CALC(06+MOVCAL_X,53+MOVCAL_Y," 7 ",.T.)
      ELSEIF M->C_DIG="8" .OR. M->C_DIG=CHR(5)
         BOT_CALC(06+MOVCAL_X,58+MOVCAL_Y," 8 ",.T.)
      ELSEIF M->C_DIG="9" .OR. M->C_DIG=CHR(18)
         BOT_CALC(06+MOVCAL_X,63+MOVCAL_Y," 9 ",.T.)
      ELSEIF M->C_DIG="4" .OR. M->C_DIG=CHR(19)
         BOT_CALC(08+MOVCAL_X,53+MOVCAL_Y," 4 ",.T.)
      ELSEIF M->C_DIG="5" .OR. M->C_DIG=CHR(76)
         BOT_CALC(08+MOVCAL_X,58+MOVCAL_Y," 5 ",.T.)
      ELSEIF M->C_DIG="6" .OR. M->C_DIG=CHR(4)
         BOT_CALC(08+MOVCAL_X,63+MOVCAL_Y," 6 ",.T.)
      ELSEIF M->C_DIG="1" .OR. M->C_DIG=CHR(6)
         BOT_CALC(10+MOVCAL_X,53+MOVCAL_Y," 1 ",.T.)
      ELSEIF M->C_DIG="2" .OR. M->C_DIG=CHR(24)
         BOT_CALC(10+MOVCAL_X,58+MOVCAL_Y," 2 ",.T.)
      ELSEIF M->C_DIG="3" .OR. M->C_DIG=CHR(3)
         BOT_CALC(10+MOVCAL_X,63+MOVCAL_Y," 3 ",.T.)
      ELSEIF M->C_DIG="0" .OR. M->C_DIG=CHR(22)
         BOT_CALC(12+MOVCAL_X,53+MOVCAL_Y,"  0  ",.T.)
      ELSEIF M->C_DIG="." .OR. M->C_DIG=CHR(7) .OR. M->C_DIG=","
         BOT_CALC(12+MOVCAL_X,61+MOVCAL_Y,"  .  ",.T.)
      ELSEIF M->C_DIG="-"
         BOT_CALC(06+MOVCAL_X,MOVCAL_Y+69," - ",.T.)
      ELSEIF M->C_DIG="%"
         BOT_CALC(12+MOVCAL_X,MOVCAL_Y+74," % ",.T.)
      ELSEIF M->C_DIG="+"
         BOT_CALC(08+MOVCAL_X,MOVCAL_Y+69," + ",.T.)
      ELSEIF M->C_DIG="*"
         BOT_CALC(08+MOVCAL_X,MOVCAL_Y+74," * ",.T.)
      ELSEIF M->C_DIG="/"
         BOT_CALC(10+MOVCAL_X,MOVCAL_Y+74," / ",.T.)
      ELSEIF M->C_DIG="=" .OR. ASC(M->C_DIG)=13
         BOT_CALC(10+MOVCAL_X,MOVCAL_Y+69," = ",.T.)
      ELSEIF AT(M->C_DIG,"cCeE")<>0
         TONE(100,01)
         BOT_CALC(06+MOVCAL_X,MOVCAL_Y+74," C ",.T.)
      ENDIF
      set color to /w+
      IF AT(M->C_DIG,CHR(26)+CHR(2)+CHR(141)+CHR(145))<>0
         M->MOV_TELA=SAVESCREEN(MOVCAL_X+0,MOVCAL_Y+50,MOVCAL_X+15,MOVCAL_Y+78)
            RESTSCREEN(MOVCAL_X+0,MOVCAL_Y+47,MOVCAL_X+16,MOVCAL_Y+79,M->CA_TELA)
             IF M->C_DIG=CHR(26)
            MOVCAL_Y=MOVCAL_Y-1
         ELSEIF M->C_DIG=CHR(2)
            MOVCAL_Y=MOVCAL_Y+1
         ELSEIF M->C_DIG=CHR(141)
            MOVCAL_X=MOVCAL_X-1
         ELSEIF M->C_DIG=CHR(145)
            MOVCAL_X=MOVCAL_X+1
         ENDIF
         IF MOVCAL_X+0<0
            MOVCAL_X=0
         ELSEIF MOVCAL_X+17>24 
            MOVCAL_X=24-17
         ELSEIF MOVCAL_Y+47<0
            MOVCAL_Y=-47
         ELSEIF MOVCAL_Y+79>79
            MOVCAL_Y=0
         ENDIF
         M->CA_TELA=SAVESCREEN(MOVCAL_X+0,MOVCAL_Y+47,MOVCAL_X+16,MOVCAL_Y+79)
         SOMBRA_CAL(MOVCAL_X+0,MOVCAL_Y+50,MOVCAL_X+15,MOVCAL_Y+78)
         RESTSCREEN(MOVCAL_X+0,MOVCAL_Y+50,MOVCAL_X+15,MOVCAL_Y+78,M->MOV_TELA)
      ENDIF
      IF M->C_DIG=CHR(27)
         VALOR=C_RESULT
         EXIT
      ENDIF
      M->C_XX=AT(M->C_DIG,CHR(22)+CHR(7)+CHR(6)+CHR(24)+CHR(3)+CHR(19)+CHR(76)+CHR(4)+CHR(1)+CHR(5)+CHR(18))
      IF M->C_XX<>0
         M->C_DIG=SUBS("0.123456789",M->C_XX,1)
      ENDIF
      M->C_VAR=IIF(M->C_DIG=",","M->C_DEC",M->C_VAR)
      M->C_VAR=IIF(M->C_DIG=".","M->C_DEC",M->C_VAR)
      M->C_ALGA=IIF(M->C_DIG="." .AND. M->C_ALGA=SPACE(14),SPACE(13)+"0",M->C_ALGA)
      IF M->C_DIG="%"
         IF M->C_VERDAD
            M->C_PERC=IIF(M->C_PERC="%"," ","%")
            @ 03+MOVCAL_X,75+MOVCAL_Y SAY M->C_PERC
         ELSE
            @ 03+MOVCAL_X,55+MOVCAL_Y SAY SPACE(13)+"0.00"
         ENDIF
      ELSEIF M->C_DIG $ "0123456789" .AND. LEN(LTRIM(&C_VAR))<>IIF(M->C_VAR="M->C_DEC",2,14)
         &C_VAR=IIF(M->C_VAR="M->C_DEC",&C_VAR+M->C_DIG,SUBS(&C_VAR+M->C_DIG,2))
         @ 03+MOVCAL_X,57+MOVCAL_Y SAY M->C_ALGA+"."+SUBS(M->C_DEC+SUBS("00",LEN(M->C_DEC)+1),1,2)
         M->C_VERDAD=IIF(M->C_VERDAD .AND. M->C_UOPER $ "="+CHR(13),.F.,M->C_VERDAD)
      ELSEIF M->C_DIG $ "+-/*="+CHR(13)
         IF M->C_VERDAD
            IF VAL(M->C_ALGA+"."+M->C_DEC)<>0
               IF M->C_PERC="%"
                  M->OPE_RA=STR(M->C_RESULT,19,2)+M->C_UOPER+"("+STR(M->C_RESULT,19,2)+"*"+M->C_ALGA+"."+SUBS(M->C_DEC+SUBS("00",LEN(M->C_DEC)+1),1,2)+")/100.000"
               ELSE
                  M->OPE_RA=STR(M->C_RESULT,19,2)+M->C_UOPER+M->C_ALGA+"."+SUBS(M->C_DEC+SUBS("00",LEN(M->C_DEC)+1),1,2)
               ENDIF
               M->C_RESULT=&OPE_RA
               IF STR(M->C_RESULT,19,2)=REPL("*",19)
                  setcolor("w+/r")
                  @ 03+MOVCAL_X,55+MOVCAL_Y SAY " ****   Erro  **** "
                  set color to /w,w
                  M->C_RESULT=0
                  @ 03+MOVCAL_X,53+MOVCAL_Y SAY " "
                  @ 03+MOVCAL_X,75+MOVCAL_Y SAY " "
               ELSE
                  @ 03+MOVCAL_X,55+MOVCAL_Y SAY STR(M->C_RESULT,19,2)
               ENDIF
            ENDIF
         ELSEIF M->C_DIG $ "+-/*"
            M->C_VERDAD=.T.
            M->C_RESULT=VAL(M->C_ALGA+"."+M->C_DEC)
         ENDIF
         @ 03+MOVCAL_X,53+MOVCAL_Y SAY IIF(M->C_DIG $ "+-/*",M->C_DIG," ")
         @ 03+MOVCAL_X,75+MOVCAL_Y SAY " "
         M->C_VAR="M->C_ALGA"
         M->C_ALGA=SPACE(14)
         M->C_DEC=""
         M->C_UOPER=M->C_DIG
         M->C_PERC=" "
      ELSEIF M->C_DIG $ "EeCc"
         M->C_VAR="M->C_ALGA"
         M->C_ALGA=SPACE(14)
         M->C_DEC=""
         M->C_PERC=" "
         IF M->C_DIG $ "Cc"
            M->C_VERDAD=.F.
            @ 03+MOVCAL_X,53+MOVCAL_Y SAY " "
            @ 03+MOVCAL_X,75+MOVCAL_Y SAY " "
         ENDIF
         @ 03+MOVCAL_X,55+MOVCAL_Y SAY SPACE(13)+"0.00"
      ENDIF
   ENDDO
   keyboard chr(-1)
   SETCOLOR(M->CACU_COR)
   Setcursor(cal_cur)
   RESTSCREEN(MOVCAL_X+0,MOVCAL_Y+47,MOVCAL_X+16,MOVCAL_Y+79,M->CA_TELA)
    SOMBRA_CAL(L_CALCU,C_CALCU)
   @ M->CALCU_X,M->CALCU_Y SAY ""
   
   FUNCTIO BOT_CALC
   PARA BOT_X,BOT_Y,BOT_N
   IF PCOUNT()=4
      IF BOT_N=" = "
        set color to /w+
         @ BOT_X+0,BOT_Y+2 SAY " "
         @ BOT_X+1,BOT_Y+2 SAY " "
         @ BOT_X+2,BOT_Y+2 SAY " "
         @ BOT_X+3,BOT_Y-1 SAY "   "
         SETCOLOR("w+/B")
         @ BOT_X+0,BOT_Y-1 SAY "   "
         @ BOT_X+1,BOT_Y-1 SAY " = "
         @ BOT_X+2,BOT_Y-1 SAY "   "
      ELSE
        set color to /w+
         @ BOT_X,BOT_Y+LEN(BOT_N)-1 SAY " "
         @ BOT_X+1,BOT_Y-1 SAY REPL(" ",LEN(BOT_N))
         SETCOLOR("w+/B")
         @ BOT_X,BOT_Y-1 SAY BOT_N
      ENDIF
      INKEY(0.1)
     set color to /w+
      IF BOT_N=" = "
         @ BOT_X+0,BOT_Y-1 SAY "Ü"
         @ BOT_X+1,BOT_Y-1 SAY "Û"
         @ BOT_X+2,BOT_Y-1 SAY "Û"
         @ BOT_X+3,BOT_Y-1 SAY "ßßß"
      ELSE
         @ BOT_X,BOT_Y-1 SAY "Ü"
         @ BOT_X+1,BOT_Y-1 SAY REPL("ß",LEN(BOT_N))
      ENDIF
   ENDIF
      SETCOLOR("w+/B")

   IF BOT_N=" = "
      @ BOT_X+0,BOT_Y SAY "   "
      @ BOT_X+1,BOT_Y SAY " = "
      @ BOT_X+2,BOT_Y SAY "   "
   ELSE
      @ BOT_X,BOT_Y SAY BOT_N
   ENDIF
    set color to /w+
   IF BOT_N=" = "
      @ BOT_X+0,BOT_Y-1 SAY "Ü"
      @ BOT_X+1,BOT_Y-1 SAY "Û"
      @ BOT_X+2,BOT_Y-1 SAY "Û"
      @ BOT_X+3,BOT_Y-1 SAY "ßßß"
   ELSE
      @ BOT_X,BOT_Y-1 SAY "Ü"
      @ BOT_X+1,BOT_Y-1 SAY REPL("ß",LEN(BOT_N))
   ENDIF
   RETURN .T.
   
   
   FUNCTION SOMBRA_CAL
   PARA LIN_SUP,COL_SUP,LIN_INF,COL_INF
   IF PCOUNT()=2 .OR. PCOUNT()=3
      C_SOM=COL_SUP
      L_SOM=LIN_SUP
      LIN_SUP=VAL(SUBS(C_SOM,1,2))
      COL_SUP=VAL(SUBS(C_SOM,3,2))
      LIN_INF=VAL(SUBS(C_SOM,5,2))
      COL_INF=VAL(SUBS(C_SOM,7,2))
      COL_SOM=SUBS(C_SOM,9)
      LIN_SOM=L_SOM
   ENDIF
   IF COL_SUP<2 .OR. LIN_INF>22
      C_SOM=""
      L_SOM=""
      RETURN .F.
   ENDIF
   IF PCOUNT()=3
      RESTSCREEN(LIN_SUP+1,COL_SUP-2,LIN_INF+1,COL_SUP-1,COL_SOM)
      RESTSCREEN(LIN_INF+1,COL_SUP-2,LIN_INF+2,COL_INF-2,LIN_SOM)
      RETURN .F.
   ENDIF
   IF PCOUNT()<>2
      COL_SOM=SAVESCREEN(LIN_SUP+1,COL_SUP-2,LIN_INF+1,COL_SUP-1)
      LIN_SOM=SAVESCREEN(LIN_INF+1,COL_SUP-2,LIN_INF+2,COL_INF-2)
   ENDIF
   IF SUBS(COL_SOM,2,1)<>CHR(8)
      C_SOM=STR(LIN_SUP,2)+STR(COL_SUP,2)+STR(LIN_INF,2)+STR(COL_INF,2)+COL_SOM
      L_SOM=LIN_SOM
   ENDIF
   FOR I=2 TO LEN(COL_SOM) STEP 2
      COL_SOM=STUFF(COL_SOM,I,1,CHR(8))
   NEXT
   FOR I=2 TO LEN(LIN_SOM)/2 STEP 2
      LIN_SOM=STUFF(LIN_SOM,I,1,CHR(8))
   NEXT
   RESTSCREEN(LIN_SUP+1,COL_SUP-2,LIN_INF+1,COL_SUP-1,COL_SOM)
   RESTSCREEN(LIN_INF+1,COL_SUP-2,LIN_INF+2,COL_INF-2,LIN_SOM)
   RETURN .T.
RESTORE SCREEN FROM FTELA
RETURN

******************************************************************************

FUNCTION OTARIOS
RETURN(0)
   
***********************************/FUN€AO C_PECAS****************************

FUNCTION C_PECAS
PECAS()
MCODPECA=SPACE(05)
MCODBARRA=SPACE(20)
MCODCLI=0
CLEAR GETS
SETCOLOR("W+/R,GR/W")
SAVE SCREEN TO FTELA
@ 10,20 CLEAR TO 14,65
@ 10,20 TO 14,65 DOUBLE
@ 11,21 SAY "DIGITE O COD.BARRA....:" GET MCODBARRA PICT "@!"
READ
TESTACOD(MCODBARRA)
MCODPECA=SPACE(05)
IF TECLA="S"
          MCODBARRA=SPACE(20)
          MCODPECA=ALLTRIM(VARIA)
ENDIF
ORDSETFOCUS("CODBARRA")
SEEK MCODBARRA
BARRA=1
   IF ! FOUND() .AND. MCODBARRA # SPACE(20)
                    ORDSETFOCUS("CODBARRA1")
                    SEEK MCODBARRA
                    BARRA=2
                    IF ! FOUND() 
                         ORDSETFOCUS("CODBARRA2")
                         SEEK MCODBARRA
                         BARRA=3
                         IF ! FOUND()
                             ORDSETFOCUS("CODBARRA3")
                             SEEK MCODBARRA
                             BARRA=4
                             IF ! FOUND()
                                 ORDSETFOCUS("CODBARRA4")
                                 SEEK MCODBARRA
                                 BARRA=5
                                 IF ! FOUND()
                                      TONE(200,26)
                                      OL_Yield()
                                      ALERT ('CODIGO NÇO EXISTE VERIFIQUE O ERRO ; E TENTE NOVAMENTE')
                                      NFABRQTD=1
                                  ENDIF
                             ENDIF     
                          ENDIF    
                    ENDIF
   ENDIF
IF FOUND() .AND. TECLA="N" .AND. ! EMPTY(MCODBARRA)
          MCODPECA=CODPECA
ENDIF
IF EMPTY(MCODBARRA) .OR. EMPTY(MCODPECA)
        *MCODPECA=SPACE(05)
        @ 11,21 CLEAR TO 11,64
        @ 11,21 SAY "DIGITE O N§ DA PE€A...:" GET MCODPECA PICT "@!"
        IF TECLA="S"
                  CLEAR GETS
        ENDIF
        @ 13,21 SAY "DIGITE O N§ DO CLIENTE:" GET MCODCLI PICT "9999"
        READ
        PECAS()
        ORDSETFOCUS("CODPECA") 
        SEEK MCODPECA
        IF ! FOUND()
                OL_Yield()
                ALERT('CODIGO NAO CADASTRADO !!!')
                RETURN(0)
        ENDIF
  ELSE
        @ 13,21 SAY "DIGITE O N§ DO CLIENTE:" GET MCODCLI PICT "9999"
        READ
ENDIF                          

CLIENTES()
ORDSETFOCUS("CODCLI")          

SEEK MCODCLI
IF ! FOUND() .AND. MCODCLI # 0
        @ 14,21 SAY "CLIENTE NAO CADASTRADO !!!"
        INKEY(0)
        RETURN(0)
ENDIF
MNOMECLI=NOMECLI
SELE 3
PECAS()
ORDSETFOCUS("CODPECA")
SELE 1
CUPOM()
ORDSETFOCUS("CODNOT")

SELE 2
PEDCUP()  
ORDSETFOCUS("PEDCOD")
@ 02,01 CLEAR TO 22,78
@ 02,01 TO 22,78
LIN1=05
@ 03,05 SAY "PECA"
@ 03,17 SAY "COD.NOTA"
@ 03,30 SAY "CLIENTE"
@ 03,68 SAY "DATA"
NUMREG=LASTREC()
MDATA=DATE()+30
IF MCODCLI # 0
        DO WHILE ! EOF()
            IF LASTKEY()=27
                   RETURN(.T.)
            ENDIF
            SELE 2             
            GOTO NUMREG 
            MDATACUP=DATACUP
            IF MDATACUP>MDATA
                    MDATA=DATACUP+30
                    INKEY(0.2)
                    IF LASTKEY()=27
                           RETURN(.T.)
                    ENDIF
            ENDIF                
            @ LIN1,68 SAY MDATACUP
            MDATA=MDATACUP
            IF PEDCOD = MCODPECA
                IF ! DELETED()
                    MPEDCOD=PEDCOD
                    MPEDNUM=PEDNUM
                    MPEDQTD=PEDQTD
                    MVERIFIC=VERIFIC
                    SELE 3 
                    ORDSETFOCUS("CODPECA") 
                    SEEK MPEDCOD                         
                    IF MVERIFIC=0
                          MVERIFIC=1
                    ENDIF           
                    IF MVERIFIC<=1
                           MPFABRIC=FABRIC
                           MPNFABRIC=NFABRIC
                    ENDIF
                    IF MVERIFIC=2
                          MPFABRIC=FABRIC2
                          MPNFABRIC=NFABRIC2
                    ENDIF
                    IF MVERIFIC=3
                          MPFABRIC=FABRIC3
                          MPNFABRIC=NFABRIC3
                    ENDIF
                    IF MVERIFIC=4
                          MPFABRIC=FABRIC4
                          MPNFABRIC=NFABRIC4
                    ENDIF
                    IF MVERIFIC=5
                          MPFABRIC=FABRIC5
                          MPNFABRIC=NFABRIC5
                    ENDIF
                    SELE 1
                    ORDSETFOCUS("CODNOT")
                    SEEK MPEDNUM 
                    IF NOTCLI=MNOMECLI 
                         @ LIN1,03 SAY MPEDCOD
                         @ LIN1,08 SAY "-"
                         @ LIN1,09 SAY MVERIFIC
                         @ LIN1,12 SAY MPEDQTD
                         @ LIN1,15 SAY MPEDNUM
                         @ LIN1,30 SAY NOTCLI
                         @ LIN1,68 SAY D_NOT
                         LIN1++
                         @ LIN1,03 SAY MPFABRIC
                         @ LIN1,15 SAY MPNFABRIC
                         LIN1++
                    ENDIF
                  ENDIF
                 ELSE
                    NUMREG--
                    LOOP
            ENDIF
            NUMREG--
            IF LIN1>=20
                SETCOLOR("W+/R*,GR/W")
                @ 21,15 SAY "FIM DE PAGINA PRESIONE ENTER PARA CONTINUAR ..."
                CLOSE ALL
                *CLOSE
                INKEY(0)
                SELE 1
                CUPOM()
                ORDSETFOCUS("CODNOT")                   
                SELE 2
                PEDCUP()                    
                ORDSETFOCUS("PEDCOD")
                SELE 3 
                PECAS()
                ORDSETFOCUS("CODPECA")
                IF LASTKEY()=27
                        RETURN(.T.)
                ENDIF
                SETCOLOR("W+/R,GR/W")
                LIN1=5
                @ 05,03 CLEAR TO 21,77
            ENDIF
        ENDDO
    ELSE
        DO WHILE ! EOF()
            IF LASTKEY()=27
                   RETURN(.T.)
            ENDIF
            SELE 2
            GOTO NUMREG
            MDATACUP=DATACUP
            @ LIN1,68 SAY MDATACUP
            MPEDNUM=PEDNUM
            IF PEDCOD = MCODPECA
               IF ! DELETED()
                    MPEDCOD=PEDCOD
                    MPEDNUM=PEDNUM
                    MPEDQTD=PEDQTD
                    MVERIFIC=VERIFIC
                    SELE 3 
                    ORDSETFOCUS("CODPECA") 
                    SEEK MPEDCOD                         
                    IF MVERIFIC=0
                          MVERIFIC=1
                    ENDIF           
                    IF MVERIFIC<=1
                           MPFABRIC=FABRIC
                           MPNFABRIC=NFABRIC
                    ENDIF
                    IF MVERIFIC=2
                          MPFABRIC=FABRIC2
                          MPNFABRIC=NFABRIC2
                    ENDIF
                    IF MVERIFIC=3
                          MPFABRIC=FABRIC3
                          MPNFABRIC=NFABRIC3
                    ENDIF
                    IF MVERIFIC=4
                          MPFABRIC=FABRIC4
                          MPNFABRIC=NFABRIC4
                    ENDIF
                    IF MVERIFIC=5
                          MPFABRIC=FABRIC5
                          MPNFABRIC=NFABRIC5
                    ENDIF
                    SELE 1
                    ORDSETFOCUS("CODNOT")
                    SEEK MPEDNUM
                    @ LIN1,03 SAY MPEDCOD
                    @ LIN1,08 SAY "-"
                    @ LIN1,09 SAY MVERIFIC
                    @ LIN1,12 SAY MPEDQTD
                    @ LIN1,15 SAY MPEDNUM
                    @ LIN1,30 SAY NOTCLI
                    @ LIN1,68 SAY D_NOT
                    LIN1++                        
                    @ LIN1,03 SAY MPFABRIC
                    @ LIN1,15 SAY MPNFABRIC
                    LIN1++
               ENDIF
            ENDIF
            NUMREG--
            IF LIN1>=20
                SETCOLOR("W+/R*,GR/W")
                @ 21,15 SAY "FIM DE PAGINA PRESIONE ENTER PARA CONTINUAR ..."
                CLOSE ALL
                *CLOSE
                INKEY(0)
                SELE 1
                CUPOM()
                ORDSETFOCUS("CODNOT")
                SELE 2
                PEDCUP()   
                ORDSETFOCUS("PEDCOD")
                SELE 3 
                PECAS()
                ORDSETFOCUS("CODPECA")
                
                IF LASTKEY()=27
                        RETURN(.T.)
                ENDIF
                SETCOLOR("W+/R,GR/W")
                LIN1=5
                @ 05,03 CLEAR TO 21,77
            ENDIF
        ENDDO
ENDIF
SETCOLOR("W+/R*,GR/W")
@ 21,15 SAY "FIM DE ARQUIVO PRESIONE ENTER PARA CONTINUAR ..."
SETCOLOR("W+/R,GR/W")
INKEY(0)
RETURN    
   
**********************************/FUN€AO IMPRIME CABE€ALHO*******************

FUNCTION IMPCABEC
SET CENT OFF
                        SET DEVICE TO PRINT
                        *Printer()
                        NORMAL()
                        @ LIN,00 SAY MNOTCLI
                        IF MNOTCLI="CONSUMIDOR"
                                LIN++
                                @ LIN,00 SAY "DOC:"
                                @ LIN,05 SAY CNPJ
                        ENDIF
                        LIN++
                        LIN++
                        @ LIN,00 SAY MENDCLI
                        LIN++
                        IF MNOTPAG#"CONVENIO"
                                 L_DUPLA()
                        ENDIF
                        @ LIN,00 SAY "PAGAMENTO:" + MNOTPAG
                        @ LIN,22 SAY MTEL 
                        NORMAL()
                        LIN++
                        DADOS2()
                        @ LIN,00 SAY RSOCIAL
                        LIN++
                        @ LIN,00 SAY ENDEMPR
                        LIN++
                        @ LIN,02 SAY " "                                
                        @ LIN,00 SAY "N:"
                        L_DUPLA()
                        @ LIN,02 SAY MCODNOT PICT "999999999"
                        PEQUENO()
                        @ LIN,10 SAY "DATA:"
                        SET CENT OFF
                        @ LIN,16 SAY DATE() 
                        @ LIN,25 SAY "HORA"
                        @ LIN,30 SAY TIME() PICT "99:99"
                        LIN++
                        @ LIN,00 SAY MNOTFUNC
                        @ LIN,12 SAY "*** ORCAMENTO ***"
                        @ LIN,30 SAY "VIA" + STR(VIA,2)
                        IF ENTREGA="S"
                                @ LIN,52 SAY MPONTO
                        ENDIF
                        LIN++   
                        @ LIN,00 SAY PADC("---------------------------------------",40)
                        LIN++
                        






SET CENT ON
RETURN

DADOS2()
@ LIN,00 SAY RSOCIAL
LIN++
@ LIN,00 SAY ENDEMPR
LIN++
@ LIN,02 SAY " "
NORMAL()
@ LIN,00 SAY "N:"
@ LIN,02 SAY MCODNOT PICT "999999999"
PEQUENO()
@ LIN,13 SAY "DATA"
@ LIN,18 SAY DATE() 
@ LIN,27 SAY "HORA"
@ LIN,32 SAY TIME() PICT "99:99"
LIN++  
@ LIN,00 SAY MNOTFUNC
@ LIN,12 SAY "*** ORCAMENTO ***"
@ LIN,35 SAY "1 VIA"
IF ENTREGA="S"
        @ LIN,42 SAY MPONTO
ENDIF
LIN++   
@ LIN,00 SAY PADC("-------------------------------------------",40)
LIN++  


**********************************/FUN€AO DESC1\******************************

FUNCTION DESC1
IF MCNOTCLI=1 .AND. CRED1="N"
        PEDIDOEX()
        KEYBOARD CHR(13)
        RETURN
ENDIF        
SET KEY -8 TO OTARIOS() // F9
SAVE SCREEN TO TELADESC
IF MNOTPAG="CREDITO" .AND. CRED1="N" .OR. MNOTPAG="CONVENIO" .AND. CRED1="N"
        OL_Yield()  
        ALERT('IMPOSSIVEL APLICAR O DESCONTO')
        SET KEY -8 TO DESC1() // F9
        RESTORE SCREEN FROM TELADESC
        RETURN
ENDIF                 
DESC1="S"
MTROCO=0
V_DESC1=0.90
V_DESC=0.90
TOTDESC=0
SETCOLOR("W+/BG,N/W")
@ 03,06 CLEAR TO 12,45
@ 03,06 TO 12,45 DOUBLE
@ 03,11 SAY "DESCONTO"
IF REIM=1
        XPTOTG=MPTOTG
      ELSE
        XPTOTG=(MPTOTG+MABATIMENTO)
ENDIF
@ 05,13 SAY "Valor Total....:" GET XPTOTG PICT "99999.99"
CLEAR GETS
IF MNOTPAG="DEBITO" .or. MNOTPAG="DINHEIRO" .or. MNOTPAG="ASSINAR" .or. MNOTPAG="DEPOSITO" .OR. DESC1="S"
        TOTDESC=(MPTOTG+MABATIMENTO) * V_DESC1                                                          
        IF (MPTOTG+MABATIMENTO)<=50
                TOTDESC=(MPTOTG+MABATIMENTO)
        ENDIF
ENDIF
IF (MPTOTG+MABATIMENTO)>=150 .AND. MNOTPAG="CREDITO" .or. MNOTPAG="TROCA"
        TOTDESC=(MPTOTG+MABATIMENTO) * 0.9999
     ELSEIF (MPTOTG+MABATIMENTO)< 150 .AND. MNOTPAG="CREDITO"
        TOTDESC=(MPTOTG+MABATIMENTO)
ENDIF
IF REIM=1
   TOTDESC=XPTOTG+MDESCONTO
ENDIF
@ 07,13 SAY "Valor c/desc...:" GET TOTDESC PICT "99999.99"
IF REIM=1 .AND. ACESSO#1
        CLEAR GETS
ENDIF
@ 09,13 SAY "Valor c/ 10%...:"
IF REIM=1
        @ 09,30 say (MPTOTG) * V_DESC PICT "99999.99"
     ELSE
        @ 09,30 say (MPTOTG+MABATIMENTO) * V_DESC PICT "99999.99"
ENDIF
@ 11,13 SAY "Troco..........:" GET MTROCO   PICT "99999.99"
READ
IF LASTKEY()=27
        DESC1()
ENDIF
IF REIM=0
        IF TOTDESC>(MPTOTG+MABATIMENTO)
                OL_Yield()
                ALERT('DESCONTO MAIOR QUE A VENDA!!!')
                RESTORE SCREEN FROM TELADESC
                DESC1()
        ENDIF
ENDIF
IF (MPTOTG+MABATIMENTO) < 50 .AND. TOTDESC < (MPTOTG+MABATIMENTO) * 0.99
                ACESSO()
                IF ACESSO=0 .OR. ACESSO=4 .OR. LASTKEY()=27
                         RESTORE SCREEN FROM TELADESC
                         DESC1()
                ENDIF
ENDIF
IF MNOTPAG="DINHEIRO" .OR. MNOTPAG="DEBITO" .or. MNOTPAG="ASSINAR" .or. MNOTPAG="DEPOSITO"
                IF TOTDESC < (MPTOTG+MABATIMENTO) * (V_DESC-0.005) 
                        ACESSO()
                        IF ACESSO=0 .OR. ACESSO=4 .OR. LASTKEY()=27 
                                 RESTORE SCREEN FROM TELADESC
                                 DESC1()
                        ENDIF
                ENDIF
ENDIF

IF MNOTPAG="DEBITO" 
          IF TOTDESC <= (MPTOTG+MABATIMENTO) * (V_DESC1)-0.01
                  ACESSO()
                  IF ACESSO=0 .OR. ACESSO=4 .OR. LASTKEY()=27 
                           RESTORE SCREEN FROM TELADESC
                           DESC1()
                  ENDIF
          ENDIF
ENDIF


IF MNOTPAG="CREDITO" .or. MNOTPAG="TROCA"
        IF TOTDESC < (MPTOTG+MABATIMENTO) * 0.99 
                ACESSO()
                IF ACESSO=0 .OR. ACESSO=4 .OR. LASTKEY()=27
                         RESTORE SCREEN FROM TELADESC
                         DESC1()
                ENDIF
        ENDIF
ENDIF
IF MTROCO <= TOTDESC .AND. MTROCO # 0
        OL_Yield()
        ALERT('TROCO  MENOR QUE O VALOR')
        RESTORE SCREEN FROM TELADESC
        DESC1()
ENDIF
CLEAR GETS
IF LASTKEY()=27
    IF REIM=0
         DESC1="N"
         RESTORE SCREEN FROM TELADESC
         SET KEY -8 TO DESC1() // F9
    ENDIF
    PEDIDOEX()
    RESTORE SCREEN FROM TELADESC
    RETURN
ENDIF
SET KEY -8 TO DESC1() // F9
RESTORE SCREEN FROM TELADESC
@ 24,65 SAY TOTDESC PICT "99999.99"
PEDIDOEX()
KEYBOARD CHR(13)
RETURN


******************************************************************************

FUNCTION INDEXAR
IF NTX=1
      ORDSETFOCUS("CODPECA")
      SEEK MCODPECA
   ELSEIF NTX=2 .and. conpec=1
          IF EMPTY(V_DESCR) .AND. EMPTY(V_APLIC)                        

              ELSEIF EMPTY(V_DESCR)
                INDEX ON NOMEPECA TO TEMP FOR RTRIM(V_APLIC) $ NOMEPECA .OR. RTRIM(V_APLIC) $ NOMEPECA2;
                .OR. RTRIM(V_APLIC) $ NOMEPECA3 .OR. RTRIM(V_DESCR) $ NOMEPECA4 .OR. RTRIM(V_DESCR) $ NOMEPECA7
              ELSEIF EMPTY(V_APLIC)
                INDEX ON NOMEPECA TO TEMP FOR RTRIM(V_DESCR) $ NOMEPECA .OR. RTRIM(V_DESCR) $ NOMEPECA2;
                .OR. RTRIM(V_DESCR) $ NOMEPECA3 .OR. RTRIM(V_DESCR) $ NOMEPECA4 .OR. RTRIM(V_DESCR) $ NOMEPECA7
              ELSE
                INDEX ON NOMEPECA TO TEMP FOR RTRIM(V_DESCR) $ NOMEPECA .AND. RTRIM(V_APLIC) $ NOMEPECA;
                .OR. RTRIM(V_DESCR) $ NOMEPECA .AND. RTRIM(V_APLIC) $ NOMEPECA2;
                .OR. RTRIM(V_DESCR) $ NOMEPECA .AND. RTRIM(V_APLIC) $ NOMEPECA3;
                .OR. RTRIM(V_DESCR) $ NOMEPECA .AND. RTRIM(V_APLIC) $ NOMEPECA4;
                .OR. RTRIM(V_DESCR) $ NOMEPECA .AND. RTRIM(V_APLIC) $ NOMEPECA7
          ENDIF          
          elseif conpec=0
                  SET INDEX TO TEMP
   ELSEIF NTX=3
      ORDSETFOCUS("FABRIC")
      SEEK MFABRIC
   ELSEIF NTX=4
      ORDSETFOCUS("NFABRIC")
      SEEK MNFABRIC
ENDIF
RETURN   

******************************************************************************

*FUNCTION BUSCANUMERO
*PUBLIC N1
*GOTO TOP
*N1=VAL(CODPECA)
*DO WHILE .T.
*        IF N1 # VAL(CODPECA)
*                IF VAL(CODPECA)<N1
*                        SKIP
*                        LOOP
*                ENDIF
*                Mdigito=calcdig(STRZERO(N1))
*                MDIGITO=ALLTRIM(STR(MDIGITO))
*                RETURN
*        ENDIF           
*        N1++
*        SKIP
*ENDDO        

FUNCTION BUSCANUMERO
PUBLIC N1
N1=1
sele 1
SET DELETED OFF
ORDSETFOCUS("CODPECA")
DO WHILE .T.
        OL_Yield()
        @01,12 SAY STRZERO(N1,5)
        SEEK STRZERO(N1,5)
        IF ! FOUND()
                Mdigito=calcdig(STRZERO(N1))
                MDIGITO=ALLTRIM(STR(MDIGITO))
                SET DELETED ON
                RETURN
        ENDIF           
        N1++
ENDDO



******************************************************************************

Function ASTERISCO(Lin,Col)
Local  wSenha      := "",;
       wTamanho   := 10 ,;
       wDigito    := "",;
       wNroDigitos:= 0

Do While .T.
        If wNroDigitos=wTamanho
                Exit
        EndIf       
        @ Lin,Col Say ""
        wDigito=Inkey(0)

        Do Case
            Case wDigito=13
            Exit

            Case wDigito=27
            Exit

            Case wDigito=8
            wNroDigitos=wNroDigitos-1
            If wNroDigitos<0
                wNroDigitos=0
                Loop
            EndIf
            Col=Col-1
            @ Lin,Col Say " "
            wSenha=Subs(wSenha,1,Len(wSenha)-1)
            Loop
        EndCase

        wNroDigitos = wNroDigitos+1
        wsenha      = wSenha+Chr(wDigito)
        @ Lin,Col Say Chr(42)
        Col=Col+1
EndDo
wSenha=Wsenha+Space(wTamanho-Len(wSenha))
Return(Uppe(wSenha))

*****************************/FUN€AO CADASTRA SENHAS**************************

FUNCTION SENHA
DCODFUNC=0
WSENHA=SPACE(10)
MDIREITO=4
@ 10,20 CLEAR TO 16,58
@ 10,20 TO 16,58 DOUBLE
@ 11,21 SAY "DIGITE N§ DO FUNCIONARIO:" GET DCODFUNC PICT "99"
IF ACESSO=1 .AND. ALLTRIM(FUNCIONARIO) = "MARCELO"
        @ 12,21 SAY "DIGITE N§ DO ACESSO.....:" GET MDIREITO PICT "99"
ENDIF
READ
IF LASTKEY()=27
        RETURN(.T.)
ENDIF
FUNCI()
ORDSETFOCUS("CODFUNC")
SEEK DCODFUNC
IF FOUND() 
        MNOMEFUNC=NOMEFUNC
        @ 11,47 SAY MNOMEFUNC
    ELSE
       OL_Yield() 
       ALERT('FUNCIONARIO NAO LIBERADO')
       RETURN(.T.)
ENDIF
SENHADBF()
LOCATE FOR NOMESENHA = MNOMEFUNC
IF ! FOUND()
        OL_Yield()
        ALERT('CADASTRANDO NOVO FUNCIONARIO')
        APPEND BLANK
        BLOQUEIO()
        REPLACE NOMESENHA WITH MNOMEFUNC
        REPLACE SENHA     WITH ENCRYPT(WSENHA)
        REPLACE DIREITO   WITH MDIREITO 
        DBCOMMIT()
        UNLOCK      
        LOCATE FOR NOMESENHA = MNOMEFUNC
ENDIF
@ 13,21 SAY "DIGITE SENHA ANTERIOR...:"
WSenha = ASTERISCO(13,47)
IF WSENHA==DECRYPT(SENHA)
        WSENHA=SPACE(10)
        @ 15,21 SAY "DIGITE SENHA NOVA.......:"
        WSenha = ASTERISCO(15,47)
        READ
        IF CONFIRMA("CONFIRMA A ALTERACAO DA SENHA")=1
                BLOQUEIO()
                REPLACE SENHA WITH ENCRYPT(WSENHA)
                REPLACE DIREITO WITH MDIREITO
                DBCOMMIT()
                UNLOCK
        ENDI
    ELSE
        OL_Yield()
        ALERT('SENHA ANTERIOR INCORRETA')
        RETURN(.T.)
ENDIF
RETURN(.T.)
                                                  

Function ENCRYPT(Arg1, Arg2, Arg3) /// Cryptografa texto 

Local Local1, Local2 
Local1:= "" 
Arg3:= IIf(ValType(Arg3) == ValType(120) .AND. Arg3 != Nil, Arg3, ; 
120) 
Arg2:= IIf(ValType(Arg2) == ValType(.F.) .AND. Arg2 != Nil, Arg2, ; 
.F.) 
If (ValType(Arg1) = "C") 
If (Arg2) 
For Local2:= Len(Arg1) To 1 Step -1 
Local1:= Local1 + Chr(Asc(SubStr(Arg1, Local2, 1)) + Arg3) 
Next 
Else 
For Local2:= 1 To Len(Arg1) 
Local1:= Local1 + Chr(Asc(SubStr(Arg1, Local2, 1)) + Arg3) 
Next 
EndIf 
EndIf 
Return Local1 

Function DECRYPT(Arg1, Arg2, Arg3) /// Descriptografa texto 

Local Local1, Local2, Local3 
Local1:= "" 
Local2:= 0 
Arg3:= IIf(ValType(Arg3) == ValType(120) .AND. Arg3 != Nil, Arg3, ; 
120) 
Arg2:= IIf(ValType(Arg2) == ValType(.F.) .AND. Arg2 != Nil, Arg2, ; 
.F.) 
Arg3:= IIf(Arg3 > 128, Arg3 % 128, Arg3) 
If (ValType(Arg1) = "C") 
If (Arg2) 
For Local3:= Len(Arg1) To 1 Step -1 
Local1:= Local1 + Chr(Asc(SubStr(Arg1, Local3, 1)) - Arg3) 
Next 
Else 
For Local3:= 1 To Len(Arg1) 
Local1:= Local1 + Chr(Asc(SubStr(Arg1, Local3, 1)) - Arg3) 
Next 
EndIf 
EndIf 
Return Local1

*****************************/FUN€AO CONSULTA COMISSAO************************

FUNCTION COMISSAO

SET CENT ON
IF ACESSO#1 .AND. ACESSO#4
     OL_Yield()  
     ALERT('ACESSO NAO AUTORIZADO')
     RETURN(.T.)
ENDIF
        
@ 04,15 CLEAR TO 10,62
@ 04,15 TO 10,62 DOUBLE

@ 07,16 SAY "DATA INICIAL:" GET DINICIO PICT "@D" VALID DINICIO <=DATE()
@ 08,16 SAY "DATA FINAL..:" GET DFINAL  PICT "@D" VALID DFINAL >=DINICIO
READ

CUPOM()
INDEX ON DTOS(D_NOT)+NOTFUNC TO D_NOT FOR D_NOT>=DINICIO .AND. D_NOT<=DFINAL

ENTRADA()
INDEX ON DTOS(EDATA)+ENOMEFUNC TO EDATA FOR EDATA>=DINICIO .AND. EDATA<=DFINAL


RESTORE SCREEN FROM FTELA


@ 00,04 CLEAR TO 24,55
@ 00,04 TO 24,55 DOUBLE
L=01
VENDA=0
VALOR=0
MCUSTO=0
FUNCI()
NUMREG=1
MNOMECLI=SPACE(35)
goto NUMREG
do while ! EOF()
        ENTRA=0
        FUNCI()
        GOTO NUMREG
        MNOMEFUNC=NOMEFUNC
        IF ACESSO=4 .OR. ALLTRIM(FUNCIONARIO) # "MARCELO"
                IF FUNCIONARIO#MNOMEFUNC
                        NUMREG++
                        LOOP
                 ENDIF
        ENDIF
        CUPOM()
        SET INDEX TO D_NOT
        DO WHILE .NOT. EOF()
                IF NOTFUNC=MNOMEFUNC
                        VALOR=NOTTOTG+VALOR
                        MCUSTO=MCUSTO+P_CUSTO                       
                        IF MNOMECLI#NOTCLI .OR. ALLTRIM(NOTCLI)="CONSUMIDOR"
                                VENDA++
                                MNOMECLI=NOTCLI
                        ENDIF
                ENDIF
                SKIP
        ENDDO
        ENTRADA()
        SET INDEX TO EDATA
        DO WHILE .NOT. EOF()
                IF ENOMEFUNC=MNOMEFUNC
                        ENTRA++
                ENDIF   
                SKIP
        ENDDO
        VALOR=VALOR * 0.90
        IF VALOR >200 .OR. ENTRA>0
                @ L,05 SAY MNOMEFUNC
                IF ALLTRIM(FUNCIONARIO) = "MARCELO" .OR. ALLTRIM(NETNAME())="CPU-10"
                        @ L,15 SAY VALOR PICT "9,999,999.99"
                        @ L,30 SAY ((VALOR/MCUSTO)*100)-100 PICT "999.99%"
                        @ L,47 SAY ENTRA PICT "999999"
                ENDIF
                @ L,38 SAY VENDA PICT "999999"
                COMISSAO=1
                IF VALOR>=100000 .AND. VALOR<=199999
                        COMISSAO=1.003
                ENDIF
                IF VALOR>=200000 .AND. VALOR<= 249999
                        COMISSAO=1.005
                ENDIF
                IF VALOR>=250000 .AND. VALOR<=299999
                        COMISSAO=1.0075
                ENDIF
                IF VALOR>=300000
                        COMISSAO=1.01
                ENDIF
                SAVE SCREEN TO TELA
                IF CONFIRMA("DESEJA IMPRIMIR?")=1 .AND. ALLTRIM(NETNAME())="CPU-10"
                        SET DEVICE TO PRINT
                        Printer()
                        Lin++
                        Lin++
                        @ lin,16 SAY "FECHAMENTO"
                        Lin++
                        Lin++
                        @ LIN,16 SAY DINICIO PICT "@D"
                        Lin++
                        @ LIN,02 SAY PADC ("------------------------------",40)
                        Lin++
                        @ lin,16 SAY DFINAL PICT "@D"
                        Lin++
                        Lin++
                        Lin++
                        Lin++                 
                        @ Lin,05 SAY MNOMEFUNC
                        lin++
                        *@ LIN,05 SAY "VALOR VENDIDO...:"
                        *LIN++
                        *@ Lin,05 SAY VALOR PICT "9,999,999.99"
                        lin++
                        LIN++
                        @ LIN,05 SAY "VALOR COMISSAO:"
                        LIN++                  
                        @ Lin,05 SAY ((VALOR * COMISSAO)-valor) PICT "99,999.99"
                        Lin++
                        Lin++
                        Lin++
                        Lin++
                        Lin++
                        Lin++
                        @ lin,01 SAY " "
                        @ PROW(),00 SAY CHR(27)+chr(109)
                        LIN=0
                        SET DEVICE TO SCREEN
                Endif
                L++
        restore screen from tela
        ENDIF
        NUMREG++
        VALOR=0
        VENDA=0
        MCUSTO=0
        FUNCI()
        GOTO NUMREG
enddo
INKEY(0)
ACESSO=0
RETURN(.T.)

FUNCTION DELNOTAS
IF ACESSO#1 .OR. ALLTRIM(FUNCIONARIO) # "MARCELO"
     OL_Yield()  
     ALERT('ACESSO NAO AUTORIZADO')
     RETURN
ENDIF
IF CONFIRMA("CONFIRMA A LIMPEZA DOS CUPONS!!!")=1
           ACESSO()
           IF ACESSO#1 .OR. ALLTRIM(FUNCIONARIO)#"MARCELO"
                     ALERT('ACESSO NAO AUTORIZADO')
                     RETURN(.T.)
           ENDIF
ENDIF
set deleted on
CLS
sele 1
PAGAMENTEX()
SELE 2
DEVOLEX()
SELE 3
GARANTEX()
SELE 4
REL_ENTEX()
SELE 5
ENTR_CLEX()
SELE 6
CUPOMEX()
SELE 7
PEDCUPEX()
SELE 8
DEVOLCEX()

MD_NOT=date()-730
SET CENT ON
@ 10,10 SAY "DIGITE A DATA FINAL..:" GET MD_NOT
READ
IF LASTKEY()=27
        RETURN
ENDIF

SELE 4
ordsetfocus("DATA")
NUMREG=1
GOTO NUMREG
DO WHILE ! eof()
        goto numreg
        @ 01,01 say DATA
        @ 02,01 say md_not
        if DATA < md_not 
                MCODENTR=CODENTR
                RLOCK()
                DELETE 
                SELE 5
                ordsetfocus("ENTREGA")
                for n=0 to 10000 step 1
                        seek MCODENTR
                        if found()
                                rlock()
                                delete
                            else
                                n=10000
                        endif
                next                 
           else
                exit
        endif
        SELE 4
	NUMREG++
ENDDO
@ 01,01 clear to 01,10
@ 02,01 clear to 02,10

SELE 1
NUMREG=1
GOTO NUMREG
DO WHILE ! eof()
        goto numreg
        @ 01,01 say DATA
        @ 02,01 say md_not
        if DATA < md_not 
                RLOCK()
                DELETE 
           else
                exit
        endif
	NUMREG++
ENDDO
@ 01,01 clear to 01,10
@ 02,01 clear to 02,10

SELE 8
NUMREG=1
GOTO NUMREG
DO WHILE ! eof()
        goto numreg
        @ 01,01 say DATA
        @ 02,01 say md_not
        if DATA < md_not 
                RLOCK()
                DELETE 
           else
                exit
        endif
	NUMREG++
ENDDO
@ 01,01 clear to 01,10
@ 02,01 clear to 02,10

SELE 2
NUMREG=1
GOTO NUMREG
DO WHILE ! eof()
        goto numreg
        @ 01,01 say DDATA
        @ 02,01 say md_not
        if DDATA < md_not 
                RLOCK()
                DELETE 
           else
                exit
        endif
	NUMREG++
ENDDO
@ 01,01 clear to 01,10
@ 02,01 clear to 02,10

SELE 3
NUMREG=1
GOTO NUMREG
DO WHILE ! eof()
        GOTO NUMREG
        @ 01,01 say GARDATA
        @ 02,01 say md_not
        if GARDATA < md_not 
                RLOCK()
                DELETE 
        endif
        NUMREG++
ENDDO
@ 01,01 clear to 01,10
@ 02,01 clear to 02,10

SELE 6
NUMREG=1
GOTO NUMREG
DO WHILE ! eof()
        goto numreg
        @ 01,01 say D_NOT
        @ 02,01 say md_not
        if D_NOT < md_not 
                RLOCK()
                DELETE 
           else
                exit
        endif
	NUMREG++
ENDDO
@ 01,01 clear to 01,10
@ 02,01 clear to 02,10

SELE 7
NUMREG=1
GOTO NUMREG
DO WHILE ! eof()
        goto numreg
        @ 01,01 say DATACUP
        @ 02,01 say md_not
        if DATACUP < md_not 
                RLOCK()
                DELETE 
           else
                exit
        endif
	NUMREG++
ENDDO
@ 01,01 clear to 01,10
@ 02,01 clear to 02,10

@ 10,10 SAY "SELE 1"
SELE 1
PACK
@ 10,10 SAY "SELE 2"
SELE 2
PACK
@ 10,10 SAY "SELE 3"
SELE 3
PACK  
@ 10,10 SAY "SELE 4"
SELE 4
pack
@ 10,10 SAY "SELE 5"
SELE 5
PACK
@ 10,10 SAY "SELE 6"
SELE 6
PACK
@ 10,10 SAY "SELE 7"
SELE 7
PACK
@ 10,10 SAY "SELE 8"
SELE 8
PACK              
UNLOCK
RETURN

set deleted on
CLS
sele 1
CUPOMEX()
SELE 2
PEDCUPEX()
MD_NOT=date()-730
SELE 1
ordsetfocus("d_not")
SET CENT ON
@ 10,10 SAY "DIGITE A DATA FINAL..:" GET MD_NOT
READ
IF LASTKEY()=27
        RETURN
ENDIF
NUMREG=1
GOTO NUMREG
DO WHILE ! eof()
        goto numreg
        @ 01,01 say d_not
        @ 02,01 say md_not
        if d_not < md_not 
                mcodnot=codnot
                RLOCK()
                DELETE 
                SELE 2
                ordsetfocus("pednum")
                for n=0 to 10000 step 1
                        seek mcodnot
                        if found()
                                rlock()
                                delete
                            else
                                n=10000
                        endif
                next

           else
                exit
        endif
        SELE 1
	NUMREG++

ENDDO
@ 01,01 clear to 01,10
@ 02,01 clear to 02,10

SELE 1
pack
SELE 2
PACK

UNLOCK
RETURN

******************************************************************************

function calcdig(kmatricula)
soma=0
for i=1 to len(kmatricula)
    soma+=(val(substr(kmatricula,i,1)))
next
for i=1 to len(kmatricula)
    IF val(substr(kmatricula,i,1))>0
            soma=SOMA*(val(substr(kmatricula,i,1)))
            soma=SOMA+(val(substr(kmatricula,i,1)))
    ENDIF
next
subdigito=val(substr(str(soma,lennum(soma)),1))
DO WHILE SUBDIGITO>10
        SUBDIGITO=int(SUBDIGITO)/5.2
ENDDO
if subdigito=0
   subdigito=10
endif

private digitos[10]
digitos[10]=1
digitos[1]=2
digitos[4]=3
digitos[8]=4
digitos[2]=5
digitos[6]=6
digitos[9]=7
digitos[5]=8
digitos[7]=9
digitos[3]=0

Mdigito=digitos[int(subdigito)]
Return(Mdigito)

******************************************************************************


******************************************************************************

FUNCTION REIMORCA

DO WHILE .T.
   RUNORCA=1
   SAVE SCREEN TO FTELA
   RUN COPY D:\karvan\PECAS.DBF C:\TEMP
   RESTORE SCREEN FROM FTELA
   MPNOMPEC=SPACE(45)
   MPCODPEC=SPACE(05)
   NTX=1
   CLEAR GETS
   
   SETCOLOR("W+/N,R/W")
   @ 10,20 CLEAR TO 14,54
   @ 10,20 TO 14,54 DOUBLE
   @ 12,21 SAY "DIGITE O N§ DO CUPOM.:" GET MCODNOT PICT "999999999"
   READ
   IF LASTKEY()=27
      RETURN(.T.)
   ENDIF

   ORCA()
   ORDSETFOCUS("CODNOT")
   SEEK MCODNOT
   IF FOUND()
        MNOTCLI=NOTCLI
        MD_NOT=D_NOT
        MHORANOT=HORANOT
        MNOTFUNC=NOTFUNC
        MNOTPAG=NOTPAG
     ELSE
        OL_Yield()
        ALERT('CUPOM NAO ENCONTRADO !!!!')
        RETURN(.T.)
   ENDIF   
   SETCOLOR("W+/BG,N/W")
   CLS
   @ 00,00 CLEAR TO 04,79
   @ 00,00 TO 02,79 DOUBLE 
   @ 00,02 SAY " MICRO - PE€AS INFORMATICA 5.2 "
   SETCOLOR("R*/BG,N/W")
   @ 01,27 SAY "³     ORCAMENTO      ³"
   @ 23,27 SAY "      ORCAMENTO       "
   SETCOLOR("W+/BG,N/W")
   @ 01,53 SAY "DATA......:"
   @ 01,65 SAY MD_NOT
   @ 06,01 TO 21,78 DOUBLE
   @ 22,49 SAY "TOTAL GERAL..:"
   @ 22,02 SAY "CODIGO...:"
   @ 22,25 SAY "QTD...:" 
   @ 01,02 SAY "N§ CUPOM:"
   @ 01,12 SAY  MCODNOT  
   @ 03,02 SAY "CLIENTE...:"
   @ 03,52 SAY "FUNCIONARIO:"
   @ 04,00 SAY REPL ("ÍÍ",79)
   SETCOLOR("R*/BG,N/W")
   @ 03,65 SAY MNOTFUNC
   @ 03,15 SAY MNOTCLI
   CLIENTES()
   ORDSETFOCUS("NOMECLI")
   SEEK MNOTCLI
   MCNOTCLI=CODCLI
   MENDCLI=ENDCLI
   IF MCNOTCLI=1
          V_DESC=0.90
      ELSE
          V_DESC=0.90
   ENDIF           
   SETCOLOR("W+/BG,N/W")
   USE C:\TEMP\PEDIDO
   ZAP
   ORCAPED()
   ORDSETFOCUS("PEDNUM")
   SEEK MCODNOT
   IF FOUND()
        NUMREG=RECNO()
      ELSE
        NUMREG=LASTREC()
   ENDIF
   TOT=0
   DO WHILE .T.
                GOTO NUMREG
                IF PEDNUM=MCODNOT 
                        IF DELETED()
                                NUMREG++
                                LOOP
                        ENDIF
                        TOT++
                        MPEDCOD=PEDCOD
                        MPEDQTD=PEDQTD
                        MPRECO=PRECOCUP
                        BLOQUEIO()
                        DELETE
                        UNLOCK
                        PECAS()
                        ORDSETFOCUS("CODPECA")
                        SEEK MPEDCOD
                        IF FOUND()
                                MNOMEPECA=NOMEPECA
                                MFABRIC=FABRIC                                
                                MNFABRIC=NFABRIC
                                MLOCAL=LOCAL
                                MPRETOT=MPRECO*MPEDQTD
                             ELSE
                                @ 10,10 CLEAR TO 12,18
                                @ 10,10 TO 12,28 DOUBLE
                                @ 11,11 SAY MPEDCOD
                                OL_Yield()
                                ALERT('CODIGO NAO EXISTE, VERIFIQUE O ERRO')
                                RETURN
                        ENDIF
                        USE C:\TEMP\PEDIDO
                        APPEND BLANK
                        REPLACE PCODPEC  WITH MPEDCOD
                        REPLACE PNOMPEC  WITH MNOMEPECA
                        REPLACE PQTDPEC  WITH MPEDQTD
                        REPLACE PPREPEC  WITH MPRECO
                        REPLACE PPRETOT  WITH MPRETOT
                        REPLACE PFABRIC  WITH MFABRIC
                        REPLACE LOCAL    WITH MLOCAL
                        REPLACE PNFABRIC WITH MNFABRIC
                        ORCAPED()
                        NUMREG++
                    ELSE
                       EXIT
                ENDIF
   ENDDO
   EXIT
ENDDO


USE C:\TEMP\PEDIDO

    SETCOLOR("W+/BG,N/W")
    PRIVATE V1[7], V2[7], V3[7]

     V1[01]="PNOMPEC"
     V1[02]="PQTDPEC"
     V1[03]="PUNIDAD"
     V1[04]="PPREPEC"
     V1[05]="PPRETOT"
     V1[06]="PNFABRIC"
     V1[07]="LOCAL"
   
     V2[01]="@!"
     V2[02]="999"
     V2[03]="@!"
     V2[04]="9999.99"
     V2[05]="99999.99"
     V2[06]="@!"
     V2[07]="@!"
   
     V3[01]="DESCRI€ŽO"
     V3[02]="QTD"
     V3[03]="UN"
     V3[04]="PRE€O"
     V3[05]="TOTAL"
     V3[06]="N.FABRIC."
     V3[07]="LOCAL"

SOMATOTAL()

DBEDIT(05,02,20,77,v1,"IDBEDIT",v2,v3,chr(205),space(1)+chr(179))

function IDbedit(modo,coluna)


SETCURSOR (1)
if modo=1
    return(1)
  elseif modo=2
    return(1)
  elseif modo=3
     KEYBOARD CHR(13)
  elseif modo=4
     if lastkey() == 27
         set softseek off
          return(1)

       ELSEIF LASTKEY()== 13 && "ENTER"
              TELA1=SAVESCREEN(07,02,19,76)
        DO WHILE .T.
              MPQTDPEC=0
              MPCODPEC=SPACE(05)
              DO CONPEC
              TELA=SAVESCREEN(07,02,19,76)
              USE C:\TEMP\PEDIDO
              SOMATOTAL()
              SETCOLOR("R/BG,N/W")
              @ 22,37 SAY TOT PICT "99"
              @ 22,40 SAY "PE€AS"
              @ 22,65 SAY MPTOTG PICT "99999.99"
              SETCOLOR("W+/BG,N/W")
              @ 22,00 CLEAR TO 22,24
              PECAS()
              IF LASTKEY()=27

                  *SET KEY -41 TO OTARIOS() // F12

                  USE C:\TEMP\PEDIDO
                  RESTSCREEN(07,02,19,76,TELA1)
                  IF ! EOF()
                     KEYBOARD CHR(03)
                  ENDIF
                  RETURN(1)
              ENDIF
              @ 22,00 CLEAR TO 24,23
              @ 22,02 SAY "CODIGO...:"
              ORDSETFOCUS("CODPECA")
              *SET INDEX TO CODPECA
              SEEK MPCODPEC
              IF ! FOUND() 
                   TONE(200,26)
                   OL_Yield()
                   ALERT ('CODIGO NÇO EXISTE VERIFIQUE O ERRO ; E TENTE NOVAMENTE')
                   LOOP
              ENDIF
              @ 22,25 SAY "QTD...:" GET MPQTDPEC PICT "999" VALID MPQTDPEC > 0
              READ
              IF LASTKEY()=27
                  LOOP
              ENDIF
              MLOCAL=LOCAL
              MUNIDADE=UNIDADE
              MPCODPEC=CODPECA
              MPNOMPEC=NOMEPECA
              MPPREPEC=PRECO
              MPFABRIC=FABRIC
              MPNFABRIC=NFABRIC
              MPPRETOT=MPPREPEC*MPQTDPEC
              MQTD=QTD+TEMP
              USE C:\TEMP\PEDIDO
              INDEX ON PCODPEC TO PCODPEC
              SEEK MPCODPEC
              IF FOUND()
                 MPPREPEC=PPREPEC
                 MPQTDPEC=PQTDPEC+MPQTDPEC
                 IF (MQTD-MPQTDPEC)<0
                        OL_Yield()
                        ALERT('QUANTIDADE SUPERIOR AO ESTOQUE')
                 ENDIF
                 REPLACE PQTDPEC WITH MPQTDPEC
                 MPPRETOT=MPPREPEC*MPQTDPEC
                 REPLACE PPRETOT WITH MPPRETOT
                 TOT--
                ELSE
                 IF (MQTD-MPQTDPEC)<0
                 OL_Yield()
                        ALERT('QUANTIDADE SUPERIOR AO ESTOQUE')
                 ENDIF
                 APPEND BLANK
                 REPLACE PCODPEC WITH MPCODPEC
                 REPLACE PNOMPEC WITH MPNOMPEC
                 REPLACE PQTDPEC WITH MPQTDPEC
                 REPLACE PPREPEC WITH MPPREPEC
                 REPLACE PPRETOT WITH MPPRETOT
                 REPLACE PFABRIC WITH MPFABRIC
                 REPLACE LOCAL   WITH MLOCAL
                 REPLACE PNFABRIC WITH MPNFABRIC
                 DBCOMMIT()
              ENDIF
              USE C:\TEMP\PEDIDO
              SOMATOTAL()
              @ 07,04 SAY MPNOMPEC
              @ 07,52 SAY MPQTDPEC PICT "99"
              @ 07,56 SAY MUNIDADE PICT "@!"
              @ 07,60 SAY MPPREPEC PICT "9999.99"
              @ 07,68 SAY MPPRETOT PICT "99999.99"
              TOT++
              IF MPPREPEC=0
              OL_Yield()
                 ALERT ('CODIGO DIGITADO ESTµ COM VALOR INCORRETO,VERIFIQUE')
                 LOOP
              ENDIF
              RESTSCREEN(08,02,20,76,TELA)
        ENDDO


       ELSEIF LASTKEY()== 07 && "DELETE"

               MPPRETOT=PPRETOT
               MPCODPEC=PCODPEC
               MPQTDPEC=PQTDPEC
               DELETE
               PACK
               MPTOTG=MPTOTG-MPPRETOT
               KEYBOARD+CHR(13)
               TOT--
               USE C:\TEMP\PEDIDO
               OL_Yield()
               ALERT('PECA EXCLUIDA COM EXITO')
               USE C:\TEMP\PEDIDO
               SOMATOTAL()
               @ 22,65 SAY MPTOTG PICT "99999.99"


       elseif lastkey()== 65 .OR. lastkey() == 97   && "A"

                       MPCODPEC=PCODPEC
                       TELA=SAVESCREEN(07,02,19,76)
                       SAVE SCREEN TO FTELA
                       SETCOLOR("W+/BG,N/W")
                       @07,16 CLEAR TO 09,40
                       @07,16 TO 09,40 DOUBLE
                       MPQTDPEC=PQTDPEC
                       MPPREPEC=PPREPEC
                       MPCODPEC=PCODPEC
                       PECAS()
                       ORDSETFOCUS("CODPECA")
                       SEEK MPCODPEC
                       MQTD=QTD+TEMP
                       USE C:\TEMP\PEDIDO
                       INDEX ON PCODPEC TO PCODPEC 
                       SEEK MPCODPEC
                       @ 08,17 SAY "QTD.:"GET MPQTDPEC  PICT "99" VALID MPQTDPEC >0
                       @ 08,26 SAY "PRE€O:"GET MPPREPEC PICT "9999.99"
                       READ

                       IF (MQTD-MPQTDPEC)<0
                        OL_Yield()
                                ALERT('QUANTIDADE SUPERIOR AO ESTOQUE')
                       ENDIF

                       RESTSCREEN(07,02,19,76,TELA)
                       MPPRETOT=MPQTDPEC*MPPREPEC
                       REPLACE PPRETOT WITH MPPRETOT
                       REPLACE PQTDPEC WITH MPQTDPEC
                       REPLACE PPREPEC WITH MPPREPEC
                       DBCOMMIT()
                       RESTORE SCREEN FROM FTELA
                       USE C:\TEMP\PEDIDO
                       SOMATOTAL()
                       @ 22,65 SAY MPTOTG PICT "99999.99"
                       LOCATE FOR PCODPEC=MPCODPEC


        elseif lastkey()== -2 .OR. LASTKEY()== -1 .OR. LASTKEY()== 28 && "F2/F3"

                IF MNOTCLI="CONSUMIDOR"
                        TECLA="F2"
                     ELSE
                        TECLA="F3"
                ENDIF
            
                IF MPTOTG=0
                OL_Yield()
                    ALERT('NENHUMA PE€A INCLUIDA NO PEDIDO')
                    SET KEY -8 TO OTARIOS() // F9
                    RUNORCA=0
                    RETURN(0)
                ENDIF
                SETCOLOR("W+/BG,N/W")
                ORCA()
                ORDSETFOCUS("CODNOT")
                SEEK MCODNOT
                BLOQUEIO()
                REPLACE NOTTOTG WITH MPTOTG
                REPLACE D_NOT   WITH MD_NOT
                REPLACE HORANOT WITH TIME()
                DBCOMMIT()
                UNLOCK    

                USE C:\TEMP\PEDIDO
                NUMREG=1
                GOTO NUMREG
                DO WHILE .NOT. EOF()
                     MPEDCOD=PCODPEC
                     MPEDQTD=PQTDPEC
                     MPPREPEC=PPREPEC
                     ORCAPED()
                     BLOQUEIO()
                     APPEND BLANK
                     REPLACE PEDCOD   WITH MPEDCOD
                     REPLACE PEDNUM   WITH MCODNOT
                     REPLACE PEDQTD   WITH MPEDQTD
                     REPLACE PRECOCUP WITH MPPREPEC
                     REPLACE DATACUP  WITH MD_NOT
                     USE C:\TEMP\PEDIDO
                     NUMREG++
                     GOTO NUMREG
                ENDDO
                UNLOCK
                IMPRI_ORCA()
                SET DEVICE TO SCREEN
                SET KEY -8 TO OTARIOS() // F9
                SET KEY -7 TO OTARIOS() // F8
                RUNORCA=0
                RETURN(0)
     ENDIF

ENDIF                

RETURN(1)

PROC ERRORSYS()
        errorBlock( {|e| DefError(e)} )
RETURN


Procedure TESTA_CNPJ
c=1
CONT=0
MCNPJ=SPACE(18)
FOR I=1 TO LEN(CNPJ)
          IF SUBSTR(CNPJ,I,1)="." .OR. SUBSTR(CNPJ,I,1)="/" .OR. SUBSTR(CNPJ,I,1)="-"
                   I++
           ENDIF
           MCNPJ+=SUBSTR(CNPJ,I,1)
NEXT
MCNPJ=ALLTRIM(MCNPJ)
IF EMPTY(MCNPJ)
        OK=.f.
        RETURN
ENDIF
do while c <= 12
   d=iif(c<10,'0'+str(c,1),str(c,2))
   d1&d=val(subs(mCNPJ,c,1))
   c=c+1
enddo
df1=5*d101+4*d102+3*d103+2*d104+9*d105+8*d106+7*d107+6*d108+5*d109;
    +4*d110+3*d111+2*d112
df2=df1/11
df3=int(df2)*11
r1=df1-df3
if r1=0 .or. r1=1
   pd=0
else
   pd=11-r1
endif

c=1
do while c <= 12
   d=iif(c<10,'0'+str(c,1),str(c,2))
   d2&d=val(subs(mCNPJ,c,1))
   c=c+1
enddo
df4=6*d101+5*d102+4*d103+3*d104+2*d105+9*d106+8*d107+7*d108+6*d109;
    +5*d110+4*d111+3*d112+2*pd
df5=df4/11
df6=int(df5)*11
r2=df4-df6
if r2=0 .or. r2=1
   sd=0
else
   sd=11-r2
endif
if pd#val(subs(mCNPJ,13,1)).or.sd#val(subs(mCNPJ,14,1))
   ok=.f.
else
   ok=.t.
endif
return

Procedure TESTA_CPF
CONT=0
MCNPJ=SPACE(18)
FOR I=1 TO LEN(CNPJ)
          IF SUBSTR(CNPJ,I,1)="." .OR. SUBSTR(CNPJ,I,1)="-" .OR. SUBSTR(CNPJ,I,1)=" "
                 CONT++
                 I++
           ENDIF
           MCNPJ+=SUBSTR(CNPJ,I,1)
NEXT
IF CONT>5
        OK=.f.
        RETURN
ENDIF
MCNPJ=ALLTRIM(MCNPJ)
IF EMPTY(MCNPJ)
        OK=.f.
        RETURN
ENDIF
c=1
do while c <= 9
   d='0'+str(c,1)
   d2&d=val(subs(MCNPJ,c,1))
   c=c+1
enddo
df4=10*d201+9*d202+8*d203+7*d204+6*d205+5*d206+4*d207+3*d208+2*d209
df5=df4/11
df6=int(df5)*11
r1=df4-df6
if r1=0 .or. r1=1
   pd=0
else
   pd=11-r1
endif

c=1
do while c <= 9
   d='0'+str(c,1)
   d2&d=val(subs(MCNPJ,c,1))
   c=c+1
enddo
df4=11*d201+10*d202+9*d203+8*d204+7*d205+6*d206+5*d207+4*d208+3*d209+2*pd
df5=df4/11
df6=int(df5)*11
r1=df4-df6
if r1=0 .or. r1=1
   sd=0
else
   sd=11-r1
endif
pd=str(pd,1)
sd=str(sd,1)
if pd#subs(MCNPJ,10,1).or.sd#subs(MCNPJ,11,1)
   ok=.f.
else
   ok=.t.
endif
return


***************************************************************************

*************************/FUN€AO CONSULTA ENTREGAS**************************
FUNCTION ENTRE
CLEAR GETS
KEYOTARIOS()
SAVE SCREEN TO FTELA
DO ENTREGAS
KEYNORMAL()
RETURN

******************************************************************************

*****************************/FUN€AO RELATORIO ENTREGAS***********************
FUNCTION RENTR
CLEAR GETS
KEYOTARIOS()
SAVE SCREEN TO FTELA
RELENTR()
KEYNORMAL()
RETURN

******************************************************************************

*****************************/FUN€AO RELATORIO ENTREGAS***********************
FUNCTION ENTRCLI
CLEAR GETS
KEYOTARIOS()
SAVE SCREEN TO FTELA
ENTREG()
KEYNORMAL()
RETURN


***************************************************************************

*****************************/FUN€AO SAIDA MOTOBOY*************************

FUNCTION SAIDA
CLEAR GETS
SAVE SCREEN TO FTELA
TRAVA()
MTROCO=0
MTERMINA=TERMINAL
IF EMPTY(TRAVA)
       BLOQUEIO()
       REPLACE TRAVA WITH "S"
       MTERMINA=ALLTRIM(NETNAME())
       REPLACE TERMINAL WITH MTERMINA
       DBCOMMIT()
       UNLOCK
    ELSE
    OL_Yield()
        ALERT('FUN€AO ATIVA NO &MTERMINA  !!!!')
        RETURN(1)
ENDIF          
KEYOTARIOS()
MOTOBOY()
ORDSETFOCUS("CHEGADA")
DBGOTOP()
IF ! EOF()
        MMOTOBOY=MOTOCA
   ELSE
   OL_Yield()
        ALERT('NENHUM MOTOBOY DISPONIVEL')
        REST SCREEN FROM FTELA
        KEYNORMAL()
        TRAVA()
        BLOQUEIO()
        REPLACE TRAVA WITH " "
        REPLACE TERMINAL WITH SPACE(12)
        DBCOMMIT()
        UNLOCK
        RETURN(1)
ENDIF    
MALMOCO=ALMOCO
MEMBORA=EMBORA
REL_ENTR()
CLOSE INDEXES
GOTO BOTTOM
MENTREGA=CODENTR+1
ENTREGA()
CLOSE INDEXES
DBGOTOP()
MPONTO=PONTO
*CTEMPO="00:03:00"
*SomaH:=SEC2TIME( TIME2SEC(TIME())-TIME2SEC(HORA))
*        IF SOMAH < CTEMPO
*                ORDSETFOCUS("CODIGO")
*                GOTO TOP
*                MPONTO=PONTO
*        ENDIF
IF EMPTY(MPONTO)
        OL_Yield()
        ALERT('NAO TEM ENTREGAS NO MOMENTO')
        REST SCREEN FROM FTELA
        KEYNORMAL()
        TRAVA()
        BLOQUEIO()
        REPLACE TRAVA WITH " "
        REPLACE TERMINAL WITH SPACE(12)
        DBCOMMIT()
        UNLOCK
        RETURN(1)
ENDIF

OP=1
OL_Yield()
ALERT('MOTOBOY: &MMOTOBOY')
SAVE SCREEN TO TELA
IF CONFIRMA('DESEJA LIBERAR ENTREGAS?')=1
        TESTATIME="00:01:00"
        REST SCREEN FROM TELA
     ELSE
        REST SCREEN FROM FTELA
        KEYNORMAL()
        TRAVA()
        BLOQUEIO()
        REPLACE TRAVA WITH " "
        REPLACE TERMINAL WITH SPACE(12)
        DBCOMMIT()
        UNLOCK
        RETURN(1)
ENDIF
msacola=-1
mmaquina=0
IF LASTKEY()=27
        REST SCREEN FROM FTELA
        KEYNORMAL()
        TRAVA()
        BLOQUEIO()
        REPLACE TRAVA WITH " "
        REPLACE TERMINAL WITH SPACE(12)
        DBCOMMIT()
        UNLOCK
        RETURN(1)
ENDIF
ENTREGA()
CONT=0
NUMREG=1
MENDERECO=SPACE(20)
DO WHILE .T.
        ENTREGA()
        GOTO NUMREG        
        IF EOF()
                EXIT
        ENDIF
        IF CONT>=MCONTSAIDA
                EXIT
        ENDIF
        IF ! DELETED()
                IF PONTO=MPONTO .AND. EMPTY(SAIDA)
                        CONT++
                        BLOQUEIO()
                        REPLACE SAIDA WITH "S"
                        UNLOCK
                        MENDERECO=ENDERECO
                ENDIF
                ENTREGA()
                DBGOTOP()
                DO WHILE ! EOF()
                           IF EMPTY(SAIDA) .AND. MENDERECO=ENDERECO
                                  BLOQUEIO()
                                  REPLACE SAIDA WITH "S"
                                  UNLOCK
                           ENDIF
                           SKIP
                ENDDO
        ENDIF
        ENTREGA()
        NUMREG++
ENDDO
        
NUMREG=1
MQTD=0
TAXA=1
MKM=0
DO WHILE ! BOF()
        ENTREGA()
        GOTO NUMREG
        IF ! DELETED()
                IF SAIDA="S"
                        MQTD++
                        IF KM>MKM
                              MKM=KM
                        ENDIF      
                ENDIF
        ENDIF
        NUMREG++
ENDDO
MDIST=(2 * (MKM * (TAXA+(MQTD/100))))
TCHEGADA=((4*MDIST)+(1.5*MQTD))*60
TCHEGADA=SEC2TIME(TCHEGADA)
TCHEGADA=SEC2TIME(TIME2SEC(TIME())+TIME2SEC(TCHEGADA))
IF TIME2SEC(TCHEGADA) > TIME2SEC(MALMOCO) .AND. TIME2SEC(TIME()) < TIME2SEC(MALMOCO);
.OR. TIME2SEC(TCHEGADA) > TIME2SEC(MEMBORA)
        IF CONFIRMA("CONFIRA O HORARIO DO MOTOBOY!!!")#1
                REST SCREEN FROM FTELA
                KEYNORMAL()
                TRAVA()
                BLOQUEIO()
                REPLACE TRAVA WITH " "
                REPLACE TERMINAL WITH SPACE(12)
                DBCOMMIT()
                UNLOCK
                RETURN(1)
        ENDIF          
ENDIF
MQTD=0
TAXA=1
LIN=0
MKM=0
SET DEVICE TO PRINT
ENTREGA()
ORDSETFOCUS("ENTREGAS")
GOTO TOP
DO WHILE ! EOF()
         IF SAIDA="S"
                 LIN++
                 @ LIN,02 SAY ENTREGAS
                 LIN++
                 @ LIN,02 SAY FORMA
                 @ LIN,15 SAY T_MOTO
         ENDIF
         SKIP
ENDDO
NUMREG=1
DO WHILE ! BOF()
        ENTREGA()
        GOTO NUMREG
        IF ! DELETED()
                IF SAIDA="S"
                        IF KM>MKM
                              MKM=KM
                        ENDIF      
                        MQTD_MOTO=T_MOTO
                        MCLI=ENTREGAS
                        MCODIGO=CODIGO
                        MEND=ENDERECO
                        MTEL=TELEFONE
                        MT_MOTO=T_MOTO
                        BLOQUEIO()
                        DELETE
                        UNLOCK
                        ROTA()                        
                        ORDSETFOCUS("ENDERECO")
                        SEEK MEND
                        IF ! FOUND() .OR. EMPTY(MEND)
                            BLOQUEIO()
                            APPEND BLANK
                            REPLACE ENDERECO WITH MEND
                            UNLOCK
                            DO WHILE MT_MOTO>0
                                MQTD++
                                MT_MOTO--
                            ENDDO
                        ENDIF
                        ENTR_CLI()
                        BLOQUEIO()
                        APPEND BLANK
                        REPLACE ENTREGA WITH MENTREGA
                        REPLACE CLIENTE WITH MCLI
                        REPLACE CODIGO  WITH MCODIGO
                        REPLACE ENDERECO WITH MEND
                        REPLACE T_MOTO   WITH MQTD_MOTO
                        REPLACE TELEFONE WITH MTEL
                        UNLOCK
                        ENVIADOS()
                        ORDSETFOCUS("CODNOT")
                        SEEK MCODIGO
                        IF FOUND()
                                IF TROCO>0
                                   MTROCO++
                                ENDIF
                                BLOQUEIO()
                                REPLACE MOTOCA WITH MMOTOBOY
                                UNLOCK
                        ENDIF
                        NUMREG--
                ENDIF
        ENDIF
        NUMREG++
ENDDO
LIN++
@ LIN,00 SAY MQTD PICT "99"
@ LIN,25 SAY "TROCO:"
@ LIN,32 SAY MTROCO PICT "9"
LIN++
LIN++
@ LIN,00 SAY MMOTOBOY
@ LIN,12 SAY TIME() PICT "99:99"
@ LIN,18 SAY DATE()
MDIST=(2 * (MKM * (TAXA+(MQTD/100))))
@ LIN,30 SAY "KM:"
@ LIN,33 SAY MDIST PICT "99.999"
TCHEGADA=((4*MDIST)+(1.5*MQTD))*60
TCHEGADA=SEC2TIME(TCHEGADA)
*LIN++
*@ LIN+1,00 SAY "ESTIMATIVA CHEGADA:"
*@ LIN+1,22 SAY SEC2TIME(TIME2SEC(TIME())+TIME2SEC(TCHEGADA))
*SET DEVICE TO SCREEN
REL_ENTR()
BLOQUEIO()
APPEND BLANK
REPLACE CODENTR WITH MENTREGA
REPLACE MOTOBOY WITH MMOTOBOY
REPLACE SACOLA  WITH MSACOLA
REPLACE MAQUINA WITH MMAQUINA
REPLACE QTDENTR WITH MQTD
REPLACE HORA_S  WITH TIME()
REPLACE DATA    WITH DATE()
REPLACE PONTO   WITH MPONTO
REPLACE KM      WITH 2 * (MKM * (TAXA+(MQTD/100)))
UNLOCK

SOMA=0
DINICIO=DATE()
DFINAL=DATE()
INDEX ON DATA TO DATA FOR DATA>=DINICIO .AND. DATA<=DFINAL
SET INDEX TO DATA
DO WHILE ! EOF()
       IF MMOTOBOY=MOTOBOY
              SOMA=SOMA+QTDENTR
       ENDIF
       SKIP
ENDDO
LIN++
@ LIN,00 SAY SOMA PICT "999"
LIN++
LIN++
LIN++
@ LIN+5,01 SAY " "
@ PROW(),00 SAY CHR(27)+chr(109)
LIN=0
SET DEVICE TO SCREEN

ENTREGEX()
MOTOBOY()
ORDSETFOCUS("MOTOCA")
SEEK MMOTOBOY
BLOQUEIO()
MTERMINA=ALLTRIM(NETNAME())
REPLACE TERMINAL WITH MTERMINA
REPLACE SAIDA    WITH TIME()
REPLACE QTD      WITH MQTD
REPLACE KM       WITH 2 * (MKM * (TAXA+(MQTD/100)))
REPLACE CHEGADA  WITH SPACE(8)
UNLOCK
DBCOMMIT()
KEYNORMAL()
ROTA()
BLOQUEIO()
ZAP
UNLOCK
DBCOMMIT()
TRAVA()
BLOQUEIO()
REPLACE TRAVA WITH " "
REPLACE TERMINAL WITH SPACE (12)
UNLOCK
REST SCREEN FROM FTELA
RETURN

***************************************************************************

*****************************/FUN€AO CHEGADA MOTOBOY***********************

FUNCTION CHEGADA
CLEAR GETS
TRAVA()
MTERMINA=TERMINAL
IF EMPTY(TRAVA)
       BLOQUEIO()
       REPLACE TRAVA WITH "S"
       MTERMINA=ALLTRIM(NETNAME())
       REPLACE TERMINAL WITH MTERMINA
       UNLOCK
       DBCOMMIT()
    ELSE
    OL_Yield()
        ALERT('FUN€AO ATIVA NO &MTERMINA !!!!')
        RETURN(1)
ENDIF          
KEYOTARIOS()
SAVE SCREEN TO FTELA
MOTOBOY()
ORDSETFOCUS("CHEGA")
GOTO TOP
IF EOF()
OL_Yield()
        ALERT('TODAS MOTOS ESTACIONADAS!!!')
        KEYNORMAL()        
        TRAVA()
        BLOQUEIO()
        REPLACE TRAVA WITH " "
        REPLACE TERMINAL WITH SPACE (12)
        UNLOCK
        DBCOMMIT()
        RETURN
ENDIF
SETCOLOR("GR/B+")
PRIVATE V1[2], V2[2], V3[2]

V1[01]="MOTOCA"
V1[02]="TERMINAL"

V2[01]="@!"
V2[02]="@!"

V3[01]="MOTOBOY"
V3[02]="TERMINAL"

@ 04,01 TO 14,14 DOUBLE


DBEDIT(05,02,13,13,v1,"PDBEDIT",v2,v3,chr(205),space(1)+chr(179))

function Pdbedit(modo,coluna)
if modo=1
        return(1)
    elseif modo=2
        return(1)
    elseif modo=3
        REST SCREEN FROM FTELA
        KEYNORMAL()
        TRAVA()
        BLOQUEIO()
        REPLACE TRAVA WITH " "
        REPLACE TERMINAL WITH SPACE (12)
        UNLOCK
        DBCOMMIT()
        return(0)
    elseif modo=4
        if lastkey() == 27
                set softseek off
                REST SCREEN FROM FTELA
                KEYNORMAL()
                TRAVA()
                BLOQUEIO()
                REPLACE TRAVA WITH " "
                REPLACE TERMINAL WITH SPACE (12)
                UNLOCK
                DBCOMMIT()
                return(0)
            ELSEIF LASTKEY() == 13   && "ENTER"

                        MMOTOBOY=MOTOCA
                        MCHEGADA=CHEGADA
                        REL_ENTR()
                        NUMREG=LASTREC()
                        DO WHILE ! BOF()
                                GOTO NUMREG
                                IF MOTOBOY=MMOTOBOY
                                        MSACOLA=SACOLA
                                        MMAQUINA=MAQUINA
                                        SET ESCAP OFF
                                        IF MSACOLA > 0
                                                @10,10 CLEAR TO 12,40
                                                @10,10 TO 13,40 DOUBLE
                                                @11,12 SAY "SACOLA PENDENTE:" GET MSACOLA PICT "99" VALID MSACOLA >=0
                                        ENDIF
                                        IF MMAQUINA > 0 
                                                @13,10 CLEAR TO 15,40
                                                @13,10 TO 15,40 DOUBLE
                                                @14,12 SAY "MAQUINA PENDENTE:" GET MMAQUINA PICT "99" VALID MMAQUINA >=0
                                        ENDIF
                                        IF SACOLA > 0 .OR. MAQUINA > 0
                                                READ
                                        ENDIF
                                        SET ESCAP ON
                                        BLOQUEIO()
                                        REPLACE HORA_C  WITH TIME()
                                        REPLACE SACOLA  WITH MSACOLA
                                        REPLACE MAQUINA WITH MMAQUINA
                                        UNLOCK
                                        IF ACESSO=1
                                                CTEMPO="00:00:10"
                                             ELSE
                                                CTEMPO="00:05:00"
                                        ENDIF
                                        IF HORA_C > HORA_S
                                                SomaH:=SEC2TIME( TIME2SEC(HORA_C)-TIME2SEC(HORA_S) )
                                                IF SOMAH < CTEMPO
                                                                OL_Yield()
                                                                ALERT('TEMPO SAIDA INFERIOR A 5 Minutos')
                                                                REST SCREEN FROM FTELA
                                                                KEYNORMAL()
                                                                BLOQUEIO()
                                                                REPLACE HORA_C WITH SPACE(08)
                                                                UNLOCK
                                                                TRAVA()
                                                                BLOQUEIO()
                                                                REPLACE TRAVA WITH " "
                                                                REPLACE TERMINAL WITH SPACE (12)
                                                                UNLOCK
                                                                DBCOMMIT()
                                                                RETURN(0)
                                                ENDIF
                                                BLOQUEIO()
                                                REPLACE TEMPO WITH SOMAH
                                                MTERMINA=ALLTRIM(NETNAME())
                                                REPLACE TERMINAL WITH MTERMINA
                                                UNLOCK
                                                CTEMPO="00:05:00"
                                                IF TIME() > SEC2TIME(TIME2SEC(HORA_S)+TIME2SEC(SEC2TIME(((4*KM)+(1.5*QTDENTR))*60))+TIME2SEC(CTEMPO))
                                                        ALERT('FORA DO HORARIO DE CHEGADA')
                                                        BLOQUEIO()
                                                        REPLACE ATRASO WITH "S"
                                                        UNLOCK
                                                        DBCOMMIT()
                                                    ELSE
                                                        BLOQUEIO()
                                                        REPLACE ATRASO WITH "N"
                                                        UNLOCK
                                                        DBCOMMIT()            
                                                ENDIF

                                            ELSE
                                                BLOQUEIO()
                                                REPLACE TEMPO WITH "**:**:**"
                                                UNLOCK
                                        ENDIF
                                        DBCOMMIT()
                                        EXIT
                                ENDIF
                                NUMREG--
                        ENDDO
                        MOTOBOY()
                        ORDSETFOCUS("MOTOCA")
                        SEEK MMOTOBOY
                        BLOQUEIO()
                        REPLACE CHEGADA WITH TIME()
                        UNLOCK
                        REST SCREEN FROM FTELA
                        KEYNORMAL()
                        TRAVA()
                        BLOQUEIO()
                        REPLACE TRAVA WITH " "
                        REPLACE TERMINAL WITH SPACE (12)
                        UNLOCK
                        DBCOMMIT()
                        RETURN(0)
        ENDIF
ENDIF
RETURN(1)

*****************************************************************************

*****************************************************************************

Function SEC2TIME(segundos)
Local hor,min,seg 
hor := int(segundos / (60 * 60)) 
min := int( ((segundos - (hor * 60 * 60)) / 60) ) 
seg := int((segundos - (hor * 60 * 60) - (min * 60)) ) 
RETURN STRZERO(hor,if(hor>99,len(alltrim(str(hor))),2))+":"+STRZERO(min,2)+":"+STRZERO(seg,2) 
  
Function TIME2SEC(cHor) 
Local hor, min, seg 
hor := VAL( SUBSTR( cHor,1, AT(":",cHor)-1 ) ) 
cHor:= SUBSTR( cHor, AT(":",cHor)+1 ) 
IF AT(":",cHor)=0 
   min := VAL( cHor ) 
   seg := 0 
ELSE 
   min := VAL( SUBSTR( cHor,1, AT(":",cHor)-1 ) ) 
   seg := VAL( SUBSTR( cHor, AT(":",cHor)+1 ) ) 
ENDIF 
Return ( (hor * (60*60)) + (min * 60) + seg )
*******************************************************************************
*
*******************************************************************************

FUNCTION TESTAPONTO

ENTREGA()
NUMREG=1
DO WHILE ! EOF()                                        
        GOTO NUMREG                                        
        IF DELETED()
                NUMREG++
                LOOP
        ENDIF
        CLI=ENTREGAS
        TESTAP=PONTO                                        
        CLIENTES()
        ORDSETFOCUS("NOMECLI")                                                                                
        SEEK CLI
        IF FOUND()
                 P=P1
                 PP=P2
             ELSE
                 ENTREGA()
                 NUMREG++
                 GOTO NUMREG
                 LOOP
        ENDIF
        IF TESTAP#P
                ENTREGA()
                ORDSETFOCUS("PONTO")
                SEEK P
                IF FOUND()                                                 
                         MENTREGA=ENTREGAS
                         IF CLI#MENTREGA
                                   GOTO NUMREG
                                   BLOQUEIO()
                                   REPLACE PONTO WITH P
                                   DBCOMMIT()
                                   UNLOCK
                                   OL_Yield()
                                   ALERT('PONTO &CLI TROCADO PARA &P')
                         ENDIF    
                ENDIF
                ENTREGA()
                ORDSETFOCUS("P_EXC")
                SEEK PP
                IF FOUND() .AND. ! EMPTY(PP)       
                           MENTREGA=ENTREGAS                                                                                         
                           IF CLI#MENTREGA .AND. PONTO = PP
                                   GOTO NUMREG
                                   BLOQUEIO()  
                                   REPLACE PONTO WITH P
                                   DBCOMMIT()
                                   UNLOCK
                                   OL_Yield()
                                   ALERT('PONTO &CLI TROCADO PARA &P')
                           ENDIF     
                ENDIF
        ENDIF
        ENTREGA()
        NUMREG++
        GOTO NUMREG
ENDDO
RETURN

FUNCTION FORMACRE
SET KEY -6 TO OTARIOS() // F7
SAVE SCREEN TO TELAPAG
IF MNOTPAG="CONVENIO"
        ALERT('IMPOSSIVEL CREDITO NO CONVENIO!!!')
        SET KEY -6 TO FORMACRE() // F7
        CRED1="N"
        RETURN
ENDIF
CLEAR GETS
MCODCRE=0
MV_CREDITO=0
@ 06,10 CLEAR TO 10,55
@ 06,10 TO 10,55 DOUBLE
@ 07,11 SAY "CODIGO.:" GET MCODCRE PICT "9999999999"
READ
IF LASTKEY()=27
        PEDIDOEX()
        REST SCREEN FROM TELAPAG
        PEDIDOEX()
        SET KEY -6 TO FORMACRE() // F7
        CRED1="N"
        RETURN
ENDIF
PAGAMENTO()
ORDSETFOCUS("CODIGO")
SEEK MCODCRE
IF FOUND() .AND. ! EMPTY(MCODCRE)
        CRED1="S"
        MV_CREDITO=VALOR
        MCLICRE=CLIENTE
        MFORMA=FORMA
        IF MV_CREDITO<=0
                ALERT('VALOR CREDITO ZERADO!!!')
                PEDIDOEX()
                REST SCREEN FROM TELAPAG
                SET KEY -6 TO FORMACRE() // F7
                CRED1="N"
                RETURN
        ENDIF
      ELSE
        ALERT('CREDITO NAO EXISTE')
        SET KEY -6 TO FORMACRE() // F7
        CRED1="N"
        PEDIDOEX()
        REST SCREEN FROM TELAPAG
        RETURN
ENDIF
@ 08,11 SAY "CLIENTE:" GET MCLICRE PICT "@!"
@ 09,11 SAY "VALOR..:" GET MV_CREDITO PICT "9,999.99"
CLEAR GETS
INKEY(0)
REST SCREEN FROM TELAPAG
SET KEY -6 TO FORMACRE() // F7
PEDIDOEX()
RETURN

FUNCTION FORMAPAG
        SAVE SCREEN TO TELAPAG
        @ 23,02 CLEAR TO 23,70
        @ 06,10 CLEAR TO 11,22
        @ 06,10 TO 11,22 DOUBLE
        *TOTDESC=MPTOTG
        @ 07,12 PROMPT "1-PIX     " MESS "    VAI PAGAR TRANSFERENCIA   "
        @ 08,12 PROMPT "2-DEBITO  " MESS "  VAI PAGAR COM CARTAO DEBITO "
        @ 09,12 PROMPT "3-DINHEIRO" MESS "   VAI PAGAR COM DINHEIRO     "
        @ 10,12 PROMPT "4-ASSINAR " MESS "      VAI ASSINAR A NOTA      "

        MENU TO MOP
             if lastkey()=13 .OR. LASTKEY()=27
                     formapag()
             endif
             DO CASE
                  CASE MOP == 3
                       MNOTPAG="DINHEIRO"
                  CASE MOP == 2
                       MNOTPAG="DEBITO"
                  CASE MOP == 1
                       MNOTPAG="DEPOSITO"
                  CASE MOP == 4
                       MNOTPAG="ASSINAR"
             ENDCASE
             REST SCREEN FROM TELAPAG
RETURN


*****************************************************************************

*****************************************************************************

FUNC EXT(va_lor,larg,sing,plur)
LOCAL unidades:={"um","doIs","tres","quaTro","cinCo","seIs","seTe","oiTo","noVe"},;
      unidonze:={"onZe","doZe","treZe","quaTorZe","quinZe","deZesSeIs",;
                 "deZesSeTe","deZoiTo","deZeNoVe"},;
      decimais:={"","vinTe","trinTa","quaRenTa","cinQuenTa","sesSenTa","seTenTa",;
                 "oiTenTa","noVenTa"},;
      centos:={"cenTo","duZenTos","treZenTos","quaTroCenTos","quiNhenTos","seIsCenTos",;
               "seTeCenTos","oiToCenTos","noVeCenTos"},;
      vEXTENSO:="", cnum:=LEFT(STR(va_lor,12,2),9), volta:="", calex:="", compri:=0, cents:="", vez:=0, rest:=""

sing=IF(VALTYPE(sing)!='U',sing,'reAl')
plur=IF(VALTYPE(plur)!='U',plur,'reAIs')
larg=IF(VALTYPE(larg)!='U',larg,60)

* cheques Milhoes
IF SUBSTR(cnum,1,1)>"0"
    vEXTENSO=centos[VAL(SUBSTR(cnum,1,1))]
ENDIF
IF vEXTENSO > " "
    IF SUBSTR(cnum,2,2) <> "00"
        vEXTENSO = vEXTENSO + " e "
    ENDIF
ENDIF

*
DO CASE
    CASE SUBSTR(cnum,2,1)>"1"
        vEXTENSO=vEXTENSO+decimais[VAL(SUBSTR(cnum,2,1))]
        IF vEXTENSO > " "
            IF SUBSTR(cnum,3,1) <> "0"
                vEXTENSO = vEXTENSO + " e "
            ENDIF
        ENDIF
        IF SUBSTR(cnum,3,1)>"0"
            vEXTENSO=vEXTENSO+unidades[VAL(SUBSTR(cnum,3,1))]
        ENDIF
        vEXTENSO=vEXTENSO+" miLhoes"
                                 
    CASE SUBSTR(cnum,2,1)="1"
       	vEXTENSO=vEXTENSO+unidonze[VAL(SUBSTR(cnum,3,1))]+" miLhoes"
                       
    CASE SUBSTR(cnum,2,2)="00"
     	vEXTENSO=SUBSTR(vEXTENSO,1,LEN(vEXTENSO)) + " miLhoes"
        IF SUBSTR(cnum,1,1)="1"
            vEXTENSO = "cem miLhoes"
        ENDIF
                            
    CASE SUBSTR(cnum,3,1)>" "
        vEXTENSO=vEXTENSO+unidades[VAL(SUBSTR(cnum,3,1))]+" miLhoes"
                             
ENDCASE
IF vEXTENSO = "um miLhoes"
    vEXTENSO = "um miLhao"
ENDIF
IF SUBSTR(cnum,4,6) = "000000"
    vEXTENSO = vEXTENSO+" de"
ENDIF	                           
                          
* cheques de Centenas e Milhares
                                
IF vEXTENSO > " "
    IF SUBSTR(cnum,4,3) <> "000"
        vEXTENSO = vEXTENSO+", "
    ENDIF
ENDIF
	               	
IF SUBSTR(cnum,4,1)>" "
    IF SUBSTR(cnum,4,1)<>"0"
        vEXTENSO=vEXTENSO+centos[VAL(SUBSTR(cnum,4,1))]	
    ENDIF
ENDIF
IF vEXTENSO > " "
    IF SUBSTR(cnum,5,2) <> "00"
        IF RIGHT(vEXTENSO,2) = ", "
          vEXTENSO = SUBSTR(vEXTENSO,1,LEN(vEXTENSO)-2) + " e "
        ELSE
          vEXTENSO = RTRIM(vEXTENSO) + " e "
        ENDIF
    ENDIF
ENDIF

*
DO CASE
                
    CASE SUBSTR(cnum,5,1)>"1"
        vEXTENSO=vEXTENSO+decimais[VAL(SUBSTR(cnum,5,1))]
        IF vEXTENSO > " "
            IF SUBSTR(cnum,6,1) <> "0"
                vEXTENSO = vEXTENSO + " e "
            ENDIF
       	ENDIF
       	IF SUBSTR(cnum,6,1)>"0"
            vEXTENSO=vEXTENSO+unidades[VAL(SUBSTR(cnum,6,1))]
       	ENDIF
       	vEXTENSO=vEXTENSO+" mil"

    CASE SUBSTR(cnum,5,1)="1"
        IF SUBSTR(cnum,6,1)<>"0"
            vEXTENSO=vEXTENSO+unidonze[VAL(SUBSTR(cnum,6,1))]+" mil"
        ELSE
            vEXTENSO=vEXTENSO+"dez mil"
        ENDIF

    CASE SUBSTR(cnum,5,2)="00"
	IF RIGHT(vEXTENSO,2) <> "de"
            IF SUBSTR(cnum,4,3) <> "000"
             vEXTENSO=SUBSTR(vEXTENSO,1,LEN(vEXTENSO)) + " mil"
            ENDIF
       	    IF SUBSTR(cnum,4,1)="1"
                vEXTENSO = LEFT(vEXTENSO,LEN(vEXTENSO)-9)+"cem mil"
	    ENDIF
	ENDIF

    CASE SUBSTR(cnum,6,1)>" "
        vEXTENSO=vEXTENSO+unidades[VAL(SUBSTR(cnum,6,1))]+" mil"

ENDCASE

* cheques Centenas
IF vEXTENSO > " "
    IF SUBSTR(cnum,7,3) <> "000"
        vEXTENSO = vEXTENSO + ", "
    ENDIF
ENDIF
IF SUBSTR(cnum,7,1)>"0"
    vEXTENSO=vEXTENSO+centos[VAL(SUBSTR(cnum,7,1))]
ENDIF

IF SUBSTR(cnum,7,3) = "100"
    vEXTENSO = SUBSTR(vEXTENSO,1,LEN(vEXTENSO)-5) + "cem"
ENDIF

* cheques dezenas e unidades

IF vEXTENSO > " "
    IF SUBSTR(cnum,8,2) <> "00"
        IF RIGHT(vEXTENSO,2)=", "
          vEXTENSO = SUBSTR(vEXTENSO,1,LEN(vEXTENSO)-2) + " e "
        ELSE
          vEXTENSO = RTRIM(vEXTENSO) + " e "
        ENDIF
    ENDIF
ENDIF
DO CASE
    CASE SUBSTR(cnum,8,1)>"1"
        vEXTENSO=vEXTENSO+decimais[VAL(SUBSTR(cnum,8,1))]
	IF RIGHT(cnum,1)>"0"
            vEXTENSO=vEXTENSO+" e "+ unidades[VAL(RIGHT(cnum,1))]
       	ENDIF
    CASE SUBSTR(cnum,8,1)="1"
        IF RIGHT(cnum,1)<>"0"
    	    vEXTENSO=vEXTENSO+unidonze[VAL(RIGHT(cnum,1))]
        ELSE
            vEXTENSO=vEXTENSO+"dez"
        ENDIF

    CASE RIGHT(cnum,2)=" 0"
        vEXTENSO=" "

    OTHERWISE
        IF RIGHT(cnum,1)<>"0"
            vEXTENSO=vEXTENSO+unidades[VAL(RIGHT(cnum,1))]
        ENDIF
ENDCASE
IF vEXTENSO = "cem e "
    vEXTENSO = "cem"
ENDIF

*
cents=RIGHT(STR(va_lor,12,2),2)
vEXTENSO=RTRIM(vEXTENSO)+" "+ALLTRIM(plur)
IF vEXTENSO = "um "+ALLTRIM(plur)
    vEXTENSO = "um "+ALLTRIM(sing)
ENDIF

* cheque Centavos
IF LTRIM(vEXTENSO) = ALLTRIM(plur)
    vEXTENSO =""
ENDIF
IF cents <> "00"
    IF vEXTENSO > " "
        vEXTENSO = vEXTENSO + " e "
    ENDIF
ENDIF

DO CASE
    CASE SUBSTR(cents,1,1)>"1"
    	vEXTENSO=vEXTENSO+decimais[VAL(SUBSTR(cents,1,1))]
       	IF RIGHT(cents,1)>"0"
            vEXTENSO=vEXTENSO+" e "+ unidades[VAL(RIGHT(cents,1))]
       	ENDIF
    CASE SUBSTR(cents,1,1)="1"
        IF RIGHT(cents,1)="0"
           vEXTENSO=vEXTENSO+"dez"
        ELSE
           vEXTENSO=vEXTENSO+unidonze[VAL(RIGHT(cents,1))]
        ENDIF

    OTHERWISE
        IF RIGHT(cents,1)<>"0"
            vEXTENSO=vEXTENSO+unidades[VAL(RIGHT(cents,1))]
        ENDIF
ENDCASE
IF cents <> "00"
    vEXTENSO=vEXTENSO + " cenTaVos"
ENDIF
IF cents = "01"
    vEXTENSO=SUBSTR(vEXTENSO,1,LEN(vEXTENSO)-8) + "cenTaVo"
ENDIF

compri = LEN(vEXTENSO)

*
IF compri > larg
    vez:=compri/larg
    vez:=INT(IF((vez-INT(vez))>0,vez+1,vez))
    rest:=vEXTENSO
    DO WHILE vez!=0
        IF SUBSTR(rest,larg,1)<>" "
            IF ISUPPER(SUBSTR(rest,larg,1))
                calex:=SUBSTR(rest,1,larg-1)+"-"
                contar = larg
            ENDIF
        ELSE
            calex:=SUBSTR(rest,1,larg-1)+"/"
            contar = larg
        ENDIF
        IF SUBSTR(rest,larg+1,1)=" "
            calex:=SUBSTR(rest,1,larg)
            contar = larg+1
        ENDIF
        IF EMPT(calex)        
            contar = larg
        ENDIF
        DO WHILE .NOT. SUBSTR(rest,contar,1)=" " .AND. EMPTY(calex)
            IF ISUPPER(SUBSTR(rest,contar,1))
                calex:=SUBSTR(rest,1,contar-1)+"-"+REPLIC("/",larg-contar)
                EXIT
            ENDIF
            contar-=1
        ENDDO
        IF EMPTY(calex)
            calex:=SUBSTR(rest,1,contar-1)+REPLI("/",larg-(contar-1))
        ENDIF
        volta+=calex
        calex:=""
        rest:=LTRIM(SUBSTR(rest,contar))
        vez-=1
        IF vez=1
            volta=volta+rest+REPLIC("/",larg-LEN(rest))
            EXIT
        ENDIF
    ENDDO
ELSE
    volta:=vEXTENSO+REPLIC("/",larg-compri)
ENDIF
RETURN(UPPER(volta))

            
******************************************************************************
                                                                                            
FUNC LETRAALETRA()

LOCAL Ar_dbf:=ALIAS(), nCol:=20, nKey, v_tel_p, cor_ant:=SETCOLOR()
v_tel_p:=SAVESCREEN(0,0,MAXROW(),79)
nVar="0000"
CUPOM()
ORDSETFOCUS("NOTCLIUNI")
GO TOP
KEYBOARD CHR(27)

aColunas:={'NOTCLI'}
SETCOLOR("W/B")
@ 03, 02, 21, 78 BOX "ÚÄ¿³ÙÄÀ³ "
@ 05,03 SAY REPLIC('Ä',75)
DBEDIT(6,3,20,77,aColunas)
@ 04, 05 SAY "Digite o Nome:"
@ 04, 20 SAY SPAC(35) COLOR "N/W"
nCol=20
@ 04, 20 SAY "" COLOR "N/W"
MNOTCLI=SPAC(00)
DO WHILE .T.
 IF LASTKEY()=13
  CLIENTES()
  SETCOLOR(cor_ant)
  RESTSCREEN(0,0,MAXROW(),79,v_tel_p)
  KEYBOARD nVar
  RETURN (.t.)
 ELSE
  nKey=INKEY(0)
  IF nKey=27
   EXIT
  ENDIF
  IF nKey=13
   CLIENTES()  
   SETCOLOR(cor_ant)
   RESTSCREEN(0,0,MAXROW(),79,v_tel_p)
   KEYBOARD nVar
   RETURN (.t.)
  ENDIF
 ENDIF
 IF nKey=8 .or. nKey=19
  nCol=nCol-1
  IF nCol < 20
   nCol=20
  ENDIF
  MNOTCLI=SUBS(MNOTCLI,1,LEN(MNOTCLI)-1)
  @ 04, 20 SAY MNOTCLI+"  " COLOR "N/W"
 ELSEIF (nKey>=32 .and. nKey<=165)
  nCol=nCol+1
  IF nCol>=56
   nCol=56
   MNOTCLI=SUBS(MNOTCLI,1,LEN(MNOTCLI)-1)
  ENDIF
  MNOTCLI=UPPER(MNOTCLI+CHR(nKey))
  @ 04,20 SAY MNOTCLI COLOR "N/W"
 ENDIF
 IF !PESQ_DBEDIT(MNOTCLI)
  IF nCol <20
   nCol=20
  ENDIF
  @ 04,20 SAY MNOTCLI COLOR "N/W"
 ENDIF
 @ 04,20 SAY MNOTCLI COLOR "N/W"
ENDDO
SETCOLOR(cor_ant)
RESTSCREEN(0,0,MAXROW(),79,v_tel_p)
RETURN

FUNC PESQ_DBEDIT(MNOTCLI)
IF DBSEEK(MNOTCLI,.T.)
 MNOTCLI=NOTCLI
 IF LASTKEY() <> 5 .AND. LASTKEY() <> 24
  KEYBOARD CHR(27)
 ENDIF
 DBEDIT(6,3,20,77,aColunas,"CONTROLE")
ELSE
 RETURN (.F.)
ENDIF
RETURN (.T.)

FUNC CONTROLE(nMod)
IF nMod=4
 IF LASTKEY()=13
  MNOTCLI=NOTCLI
  RETURN(0)
 ELSE
  RETURN(0)
 ENDIF
ENDIF
RETURN(1)

FUNCTION KEYOTARIOS

SET KEY 28 TO OTARIOS() // F1
SET KEY -6 TO OTARIOS() // F7
SET KEY -7 TO OTARIOS() // F8
SET KEY -8 TO OTARIOS() // F9
SET KEY -9 TO OTARIOS() // F10
SET KEY -40 TO OTARIOS() // F11
RETURN

FUNCTION KEYNORMAL

SET KEY 28 TO ACESSO()  // F1
SET KEY -6 TO SAIDA()   // F7
SET KEY -7 TO CHEGADA() // F8
SET KEY -8 TO ENTRE()   // F9
SET KEY -9 TO RENTR()   // F10
SET KEY -40 TO ENTRCLI() //F11
RETURN

FUNCTION DESTRAVA
IF ACESSO#1
OL_Yield()
      ALERT('ACESSO NAO AUTORIZADO')
      RETURN(.T.)
ENDIF
TRAVA()
BLOQUEIO()
REPLACE TRAVA WITH " "
REPLACE TERMINAL WITH SPACE (12)
UNLOCK
TRAVAPED()
BLOQUEIO()
REPLACE TRAVAPED WITH " "
UNLOCK
DBCOMMITALL()
PECAS()
DO WHILE ! EOF()
    IF TEMPPED < 0
            BLOQUEIO()
            REPLACE TEMPPED WITH 0
            UNLOCK
    ENDIF
    IF TEMP < 0
            BLOQUEIO()
            REPLACE TEMP WITH 0
            UNLOCK
    ENDIF
    IF ! EMPTY(TRAVA)
            BLOQUEIO()
            REPLACE TRAVA WITH " "
            UNLOCK
    ENDIF
    SKIP
ENDDO                
RETURN

FUNCTION ZEBRA
CAM="C:\KARVAN\"
EXT=".TXT"
EX=".Tmp"
VDATA=DTOC(date())
IF CONTZEBRA=3
        CONTZEBRA=0
        LINZEBRA=-255
        NOMEZEBRA++
ENDIF
NZEBRA=STRZERO(NOMEZEBRA,5)
IF CONPEC=0
        NOMEZEBRA=MCODPECA
        NZEBRA=NOMEZEBRA
ENDIF      
IF ! FILE (CAM+NZEBRA+EXT)
        HANDLE:=fcreate(CAM+NZEBRA+EXT)
        HANDLE := FOPEN(CAM+NZEBRA+EXT, 2)
        FWRITE(HANDLE,"I8,A,001")
        FWRITE(HANDLE,+CHR(13)+CHR(10))
        FWRITE(HANDLE,+CHR(13)+CHR(10))
        FWRITE(HANDLE,"Q400,024")
        FWRITE(HANDLE,+CHR(13)+CHR(10))
        FWRITE(HANDLE,"q831")
        FWRITE(HANDLE,+CHR(13)+CHR(10))
        FWRITE(HANDLE,"rN")
        FWRITE(HANDLE,+CHR(13)+CHR(10))
        FWRITE(HANDLE,"S6")
        FWRITE(HANDLE,+CHR(13)+CHR(10))
        FWRITE(HANDLE,"D10")
        FWRITE(HANDLE,+CHR(13)+CHR(10))
        FWRITE(HANDLE,"ZT")
        FWRITE(HANDLE,+CHR(13)+CHR(10))
        FWRITE(HANDLE,"JF")
        FWRITE(HANDLE,+CHR(13)+CHR(10))
        FWRITE(HANDLE,"O")
        FWRITE(HANDLE,+CHR(13)+CHR(10))
        FWRITE(HANDLE,"R00,0")
        FWRITE(HANDLE,+CHR(13)+CHR(10))
        FWRITE(HANDLE,"f100")
        FWRITE(HANDLE,+CHR(13)+CHR(10))
        FWRITE(HANDLE,"N")
        FWRITE(HANDLE,+CHR(13)+CHR(10))
ENDIF
CONTZEBRA++
LINZEBRA=LINZEBRA+285
HANDLE := FOPEN(CAM+NZEBRA+EXT, 2)
BUFFER=SPACE(54)
BLOCO=54
DO WHILE FREAD(HANDLE,@BUFFER,BLOCO) # 0
         FREAD(HANDLE,@BUFFER,BLOCO)
ENDDO
FWRITE(HANDLE,+CHR(13)+CHR(10))
FWRITE(HANDLE,+CHR(13)+CHR(10))
FWRITE(HANDLE,"B"+ALLTRIM(STR(LINZEBRA))+",00,0,1,1,2,50,B,"+CHR(34))
LINZEBRA=LINZEBRA-10
FWRITE(HANDLE,"#"+MPCODPEC)
FWRITE(HANDLE,"-"+MDIGITO)
FWRITE(HANDLE,ALLTRIM(STR(BARRA)))
FWRITE(HANDLE,CHR(34))                 
FWRITE(HANDLE,+CHR(13)+CHR(10))
FWRITE(HANDLE,"A"+ALLTRIM(STR(LINZEBRA))+",90,0,4,1,3,N,"+CHR(34))
FWRITE(HANDLE,MPNFABRIC)
FWRITE(HANDLE,CHR(34))                 
FWRITE(HANDLE,+CHR(13)+CHR(10))
FWRITE(HANDLE,"A"+ALLTRIM(STR(LINZEBRA+5))+",160,0,1,1,1,N,"+CHR(34))
FWRITE(HANDLE,VDATA)
FWRITE(HANDLE,CHR(34))                 
FWRITE(HANDLE,+CHR(13)+CHR(10))
FWRITE(HANDLE,"A"+ALLTRIM(STR(LINZEBRA+105))+",160,0,1,1,1,N,"+CHR(34))
FWRITE(HANDLE,MNOTFUNC)
FWRITE(HANDLE,CHR(34))
FWRITE(HANDLE,+CHR(13)+CHR(10))
FWRITE(HANDLE,"A"+ALLTRIM(STR(LINZEBRA+165))+",05,1,1,1,1,N,"+CHR(34))
FWRITE(HANDLE,ALLTRIM(TIME()))
FWRITE(HANDLE,CHR(34))                 

IF ETIQ_EST="S"
        FWRITE(HANDLE,+CHR(13)+CHR(10))
        FWRITE(HANDLE,"A"+ALLTRIM(STR(LINZEBRA+200))+",05,1,1,2,2,N,"+CHR(34))
        IF ! EMPTY(MLOCAL_E)
                FWRITE(HANDLE,ALLTRIM(MLOCAL_E))
             ELSE
                FWRITE(HANDLE,ALLTRIM("ESTOQUE"))
        ENDIF
        FWRITE(HANDLE,CHR(34))                 
ENDIF

FWRITE(HANDLE,+CHR(13)+CHR(10))
FWRITE(HANDLE,"A"+ALLTRIM(STR(LINZEBRA+250))+",05,1,2,3,2,N,"+CHR(34))
FWRITE(HANDLE,ALLTRIM(MLOCAL))
FWRITE(HANDLE,CHR(34))                 
IF CONTZEBRA=3
        FWRITE(HANDLE,+CHR(13)+CHR(10))
        FWRITE(HANDLE,"P1")
        FWRITE(HANDLE,+CHR(13)+CHR(10))
        FWRITE(HANDLE,+CHR(13)+CHR(10))
        FWRITE(HANDLE,+CHR(13)+CHR(10))
        FCLOSE(HANDLE)        
        RUN RENAME &CAM&NZEBRA&EXT &NZEBRA&EX
        INKEY(0.1)
        SAVE SCREEN TO FTELA
        RUN NET USE LPT1 /DELETE
        IF ALLTRIM(NETNAME())="CPU12"
                RUN NET USE LPT1 \\CPU12\GENERICO
            ELSEIF ALLTRIM(NETNAME())="CPU14"
                RUN NET USE LPT1 \\CPU14\GENERICO
            ELSEIF ALLTRIM(NETNAME())="CPU13"
                RUN NET USE LPT1 \\CPU13\GENERICO
            ELSE
                RUN NET USE LPT1 \\CPU12\GENERICO
        ENDIF
        RESTORE SCREEN FROM FTELA
        RUN TYPE &NZEBRA&EX >PRN
ENDIF
FCLOSE(HANDLE)
RETURN


FUNCTION TESTACOD(VARI)
TECLA="N"
VARIA=SPACE(01)
VARDIG=SPACE(01)
IF SUBSTR(VARI,1,1)="#"                 
        TECLA="S"
        VARDIG=SUBSTR(VARI,8,2)
        VARIA=SUBSTR(VARI,2,5)
ENDIF
RETURN

***********************************/FUN€AO PEDIDO.DBF\************************

FUNCTION DBFPEDIDO
ARQ5:={}
AADD (ARQ5, {"PCODPEC ","C",05,00})
AADD (ARQ5, {"PNOMPEC ","C",45,00})
AADD (ARQ5, {"PFABRIC ","C",10,00})
AADD (ARQ5, {"PNFABRIC","C",12,00})
AADD (ARQ5, {"PPREPEC ","N",10,02})
AADD (ARQ5, {"PQTDPEC ","N",03,00})
AADD (ARQ5, {"PUNIDAD ","C",02,00})
AADD (ARQ5, {"PPRETOT ","N",15,02})
AADD (ARQ5, {"PCUSTO  ","N",09,02})
AADD (ARQ5, {"LOCAL   ","C",10,02})
AADD (ARQ5, {"BARRAS  ","C",15,00})
AADD (ARQ5, {"PNCM    ","C",08,00})
*AADD (ARQ5, {"PCEST   ","C",07,00})
AADD (ARQ5, {"VERIFIC ","N",01,00})
     DBCREATE("PEDIDO",ARQ5)
RETURN(.T.)

**********************/FUN€AO ORCAMENTOPEDIDO.DBF\************************

FUNCTION DBFPEDORCA
ARQ6:={}
AADD (ARQ6, {"PCODPEC ","C",05,00})
AADD (ARQ6, {"PNOMPEC ","C",45,00})
AADD (ARQ6, {"PFABRIC ","C",10,00})
AADD (ARQ6, {"PNFABRIC","C",12,00})
AADD (ARQ6, {"PPREPEC ","N",10,02})
AADD (ARQ6, {"PQTDPEC ","N",03,00})
AADD (ARQ6, {"PUNIDAD ","C",02,00})
AADD (ARQ6, {"PPRETOT ","N",15,02})
AADD (ARQ6, {"PCUSTO  ","N",09,02})
AADD (ARQ6, {"LOCAL   ","C",10,02})
AADD (ARQ6, {"BARRAS  ","C",15,00})
AADD (ARQ6, {"PNCM    ","C",08,00})
AADD (ARQ6, {"VERIFIC ","N",01,00})
     DBCREATE("C:\TEMP\PEDIDO",ARQ6)
RETURN(.T.)


********************************/FUN€AO **************************************

FUNCTION PEDIDODBF
ARQ16:={}
AADD (ARQ16, {"CFUNC",   "C",10,00})
AADD (ARQ16, {"CDISTRIB","C",20,00})
AADD (ARQ16, {"CDATA",   "D",08,00})
AADD (ARQ16, {"CCODNOT", "C",09,00})
     DBCREATE("d:\karvan\PEDIDO\PEDIDO",ARQ16)
RETURN(.T.)

********************************/FUN€AO ARQUIVO DEVOLUCOES/CREDITO************

FUNCTION DEVOLCREDBF
ARQ17:={}
AADD (ARQ17, {"NOMECLI", "C",35,00})
AADD (ARQ17, {"CODPECA", "C",05,00})
AADD (ARQ17, {"PRECO",   "N",10,02})
AADD (ARQ17, {"QTD",     "N",03,00})
AADD (ARQ17, {"NOMEPECA","C",45,02})
AADD (ARQ17, {"CODNOT",  "N",09,00})
AADD (ARQ17, {"BAIXA",   "C",01,00})
AADD (ARQ17, {"DATA",    "D",08,00})
AADD (ARQ17, {"NOMEFUNC","C",10,00})
     DBCREATE("d:\karvan\DEVOLCRE",ARQ17)
RETURN(.T.)

************************/FUN€AO ARQUIVO DEVOLUCOES/CREDITO TEMPORARIO*******

FUNCTION DEVTEMPDBF
ARQ18:={}
AADD (ARQ18, {"NOMECLI", "C",35,00})
AADD (ARQ18, {"CODPECA", "C",05,00})
AADD (ARQ18, {"PRECO",   "N",10,02})
AADD (ARQ18, {"QTD",     "N",03,00})
AADD (ARQ18, {"NOMEPECA","C",45,02})
AADD (ARQ18, {"CODNOT",  "N",09,00})
AADD (ARQ18, {"BAIXA",   "C",01,00})
     DBCREATE("C:\karvan\DEVTEMP",ARQ18)

***********************************/FUN€AO CONFERE.DBF\*********************

FUNCTION DBFCONFERE
ARQ25:={}
AADD (ARQ25, {"XML     ","C",44,00})
AADD (ARQ25, {"FECHA   ","C",01,00})
AADD (ARQ25, {"CFUNC   ","C",10,00})
AADD (ARQ25, {"CDISTRIB","C",20,00})
AADD (ARQ25, {"CDATA   ","D",08,00})
AADD (ARQ25, {"CCODNOT ","C",09,00})
     DBCREATE("D:\KARVAN\CONFERE\CONFERE",ARQ25)
RETURN(.T.)


FUNCTION TESTAIMP
TERMINAL=NETNAME()    
*IF ALLTRIM(UPPER(TERMINAL))="CPU1" .OR. ALLTRIM(UPPER(TERMINAL))="CPU2" 
*        IF FILE ("\\CPU2\C\KARVAN\KARVAN.EXE")
*                RUN NET USE LPT1 /DELETE
*                RUN NET USE LPT1 \\CPU2\GENERICO
*             ELSEIF FILE ("\\CPU3\C\KARVAN\KARVAN.EXE")
*                RUN NET USE LPT1 /DELETE
*                RUN NET USE LPT1 \\CPU3\GENERICO
*             ELSEIF FILE ("\\CPU5\C\KARVAN\KARVAN.EXE")
*                RUN NET USE LPT1 /DELETE
*                RUN NET USE LPT1 \\CPU5\GENERICO
*             ELSEIF FILE ("\\CPU7\C\KARVAN\KARVAN.EXE")
*                RUN NET USE LPT1 /DELETE
*                RUN NET USE LPT1 \\CPU7\GENERICO
*        ENDIF
*ENDIF

*IF ALLTRIM(UPPER(TERMINAL))="CPU4" .OR. ALLTRIM(UPPER(TERMINAL))="CPU3"
*        IF FILE ("\\CPU3\C\KARVAN\KARVAN.EXE")
*                RUN NET USE LPT1 /DELETE
*                RUN NET USE LPT1 \\CPU3\GENERICO
*             ELSEIF FILE ("\\CPU2\C\KARVAN\KARVAN.EXE")
*                RUN NET USE LPT1 /DELETE
*                RUN NET USE LPT1 \\CPU2\GENERICO
*             ELSEIF FILE ("\\CPU5\C\KARVAN\KARVAN.EXE")
*                RUN NET USE LPT1 /DELETE
*                RUN NET USE LPT1 \\CPU5\GENERICO
*             ELSEIF FILE ("\\CPU7\C\KARVAN\KARVAN.EXE")
*                RUN NET USE LPT1 /DELETE
*                RUN NET USE LPT1 \\CPU7\GENERICO
*        ENDIF
*ENDIF
*IF ALLTRIM(UPPER(TERMINAL))="CPU6"
*        IF FILE ("\\CPU5\C\KARVAN\KARVAN.EXE")
*                RUN NET USE LPT1 /DELETE
*                RUN NET USE LPT1 \\CPU5\GENERICO
*             ELSEIF FILE ("\\CPU3\C\KARVAN\KARVAN.EXE")
**                RUN NET USE LPT1 /DELETE
*                RUN NET USE LPT1 \\CPU3\GENERICO
*             ELSEIF FILE ("\\CPU2\C\KARVAN\KARVAN.EXE")
*                RUN NET USE LPT1 /DELETE
*                RUN NET USE LPT1 \\CPU2\GENERICO
*             ELSEIF FILE ("\\CPU7\C\KARVAN\KARVAN.EXE")
*                RUN NET USE LPT1 /DELETE
*                RUN NET USE LPT1 \\CPU7\GENERICO
*        ENDIF
*ENDIF

*IF ALLTRIM(UPPER(TERMINAL))="CPU-10" .OR. ALLTRIM(UPPER(TERMINAL))="CPU9" 
*        IF FILE ("\\CPU-10\C\KARVAN\KARVAN.EXE")
*                RUN NET USE LPT1 /DELETE
*                RUN NET USE LPT1 \\CPU-10\GENERICO
*             ELSEIF FILE ("\\CPU3\C\KARVAN\KARVAN.EXE")
*                RUN NET USE LPT1 /DELETE
*                RUN NET USE LPT1 \\CPU3\GENERICO
*             ELSEIF FILE ("\\CPU5\C\KARVAN\KARVAN.EXE")
*                RUN NET USE LPT1 /DELETE
*                RUN NET USE LPT1 \\CPU5\GENERICO
**             ELSEIF FILE ("\\CPU7\C\KARVAN\KARVAN.EXE")
*                RUN NET USE LPT1 /DELETE
*                RUN NET USE LPT1 \\CPU7\GENERICO
*        ENDIF
*ENDIF

*IF ALLTRIM(UPPER(TERMINAL))="CPU7" .OR. ALLTRIM(UPPER(TERMINAL))="CPU8" 
*        IF FILE ("\\CPU7\C\KARVAN\KARVAN.EXE")
*                RUN NET USE LPT1 /DELETE
*                RUN NET USE LPT1 \\CPU7\GENERICO
*             ELSEIF FILE ("\\CPU3\C\KARVAN\KARVAN.EXE")
*                RUN NET USE LPT1 /DELETE
*                RUN NET USE LPT1 \\CPU3\GENERICO
*             ELSEIF FILE ("\\CPU5\C\KARVAN\KARVAN.EXE")
*                RUN NET USE LPT1 /DELETE
*                RUN NET USE LPT1 \\CPU5\GENERICO
*             ELSEIF FILE ("\\CPU2\C\KARVAN\KARVAN.EXE")
*                RUN NET USE LPT1 /DELETE
*                RUN NET USE LPT1 \\CPU2\GENERICO
*        ENDIF
*ENDIF

*IF ALLTRIM(UPPER(TERMINAL))="CPU10" .OR. ALLTRIM(UPPER(TERMINAL))="CPU11"
*        IF FILE ("\\CPU10\C\KARVAN\KARVAN.EXE")
*                RUN NET USE LPT1 /DELETE
*                RUN NET USE LPT1 \\CPU10\GENERICO
*             ELSEIF FILE ("\\CPU2\C\KARVAN\KARVAN.EXE")
*                RUN NET USE LPT1 /DELETE
*                RUN NET USE LPT1 \\CPU2\GENERICO
*             ELSEIF FILE ("\\CPU3\C\KARVAN\KARVAN.EXE")
*                RUN NET USE LPT1 /DELETE
*                RUN NET USE LPT1 \\CPU3\GENERICO
*             ELSEIF FILE ("\\CPU5\C\KARVAN\KARVAN.EXE")
*                RUN NET USE LPT1 /DELETE
*                RUN NET USE LPT1 \\CPU5\GENERICO
*        ENDIF
*ENDIF

RETURN

FUNCTION NORMAL
@ PROW(),00 SAY CHR(27)+"!"+CHR(00)
RETURN

FUNCTION PEQUENO
@ PROW(),00 SAY CHR(27)+"!"+CHR(9) && PEQUENO
RETURN
FUNCTION L_DUPLA
@ PROW(),00 SAY CHR(27)+"!"+CHR(16) && LINHA DUPLA
RETURN

FUNCTION GUILHOTINA
@ PROW(),00 SAY CHR(27)+chr(109)
RETURN

FUNCTION SAIDISTRIB
                     BLOQUEIO()
                     MP_CUSTO=0
                     IF DISTRIBQTD > 0 .AND. EQTD4 > 0
                          MEQTD4=EQTD4
                          FOR MQTD1 = 1 TO EQTD4
                                MEQTD4--
                                MP_CUSTO=MP_CUSTO+P_CUSTO4
                                DISTRIBQTD--
                                IF DISTRIBQTD=0
                                        EXIT
                                ENDIF
                          NEXT
                          REPLACE EQTD4 WITH MEQTD4
                     ENDIF     
                     IF DISTRIBQTD >0 .AND. EQTD3> 0
                          MEQTD3=EQTD3
                          FOR MQTD1 = 1 TO EQTD3
                                MEQTD3--
                                DISTRIBQTD--
                                MP_CUSTO=MP_CUSTO+P_CUSTO3
                                IF DISTRIBQTD=0
                                        EXIT
                                ENDIF
                          NEXT
                          REPLACE EQTD3 WITH MEQTD3
                     ENDIF
                     IF DISTRIBQTD >0 .AND. EQTD2> 0
                          MEQTD2=EQTD2
                          FOR MQTD1 = 1 TO EQTD2
                                MEQTD2--
                                DISTRIBQTD--
                                MP_CUSTO=MP_CUSTO+P_CUSTO2
                                IF DISTRIBQTD=0
                                        EXIT
                                ENDIF
                          NEXT
                          REPLACE EQTD2 WITH MEQTD2
                     ENDIF
                     IF DISTRIBQTD >0
                          MEQTD1=EQTD1
                          FOR MQTD1 = 1 TO DISTRIBQTD
                                MEQTD1--
                                MP_CUSTO=MP_CUSTO+P_CUSTO
                                IF DISTRIBQTD=0
                                        EXIT
                                ENDIF
                          NEXT
                          REPLACE EQTD1 WITH MEQTD1                     
                     ENDIF
                     UNLOCK
RETURN

FUNCTION ENTRADISTRIB
                   MP_CUSTO=0
                   IF DISTRIBQTD > 0
                          MQTD1=EQTD1
                          DO WHILE MQTD1 < XQTD1
                                DISTRIBQTD--
                                MQTD1++
                                MP_CUSTO=MP_CUSTO+P_CUSTO
                                IF DISTRIBQTD=0
                                        EXIT
                                ENDIF
                          ENDDO
                          REPLACE EQTD1 WITH MQTD1
                   ENDIF
                   IF DISTRIBQTD >0
                          MQTD2=EQTD2
                          DO WHILE MQTD2 < XQTD2
                                DISTRIBQTD--
                                MQTD2++
                                MP_CUSTO=MP_CUSTO+P_CUSTO2
                                IF DISTRIBQTD=0
                                        EXIT
                                ENDIF
                          ENDDO
                          REPLACE EQTD2 WITH MQTD2
                   ENDIF
                   IF DISTRIBQTD >0
                          MQTD3=EQTD3
                          DO WHILE MQTD3 < XQTD3
                                DISTRIBQTD--
                                MQTD3++
                                MP_CUSTO=MP_CUSTO+P_CUSTO3
                                IF DISTRIBQTD=0           
                                        EXIT
                                ENDIF
                          ENDDO
                          REPLACE EQTD3 WITH MQTD3
                   ENDIF
                   IF DISTRIBQTD >0
                          MQTD4=EQTD4
                          DO WHILE .T.
                                DISTRIBQTD--
                                MQTD4++
                                MP_CUSTO=MP_CUSTO+P_CUSTO4
                                IF DISTRIBQTD=0
                                        EXIT
                                ENDIF
                          ENDDO
                          REPLACE EQTD4 WITH MQTD4
                   ENDIF     
RETURN



FUNCTION IMPRI_ORCA
                IF CONFIRMA("DESEJA IMPRIMIR ESSE OR€AMENTO?")=1
                        *IF TECLA="F2"
                        *        IMPRIME()
                        *        SET DEVICE TO SCREEN
                        *        SET KEY -8 TO OTARIOS() // F9
                        *        RETURN(0)
                        *ENDIF
                        SET DEVICE TO PRINT
                        *Printer()
                        LIN++
                        USE C:\TEMP\PEDIDO
                        CONPEC=1
                        SEPARA=1
                        @ LIN,00 SAY MNOTCLI
                        LIN++
                        @ LIN,00 SAY MNOTFUNC
                        LIN++
                        @ LIN,00 SAY "N:"
                        L_DUPLA()
                        @ LIN,02 SAY MCODNOT PICT "999999999"
                        LIN++
                        @ LIN,05 SAY "------------SEPARACAO-------------"
                        LIN++
                        IMPARQPED()
                        LIN++
                        IF TECLA="F2"
                                FORMPAG()
                            ELSE
                                @ LIN,05 SAY "TOTAL:"
                                @ LIN,12 SAY MPTOTG PICT "99,999.99"
                                LIN++
                                LIN++              
                                @ LIN,03 SAY TOT PICT "99"
                                @ LIN,07 SAY "PRODUTO(S)"
                        ENDIF
                        LIN=LIN+2
                        LIN=LIN+3
                        @ LIN,00 SAY " "
                        @ PROW(),00 SAY CHR(27)+CHR(109)
                        LIN=0
                ENDIF                
                SET DEVICE TO SCREEN
                SET KEY -8 TO OTARIOS() // F9
                RETURN
            

***********************************/FUN€AO CONFIRMA***************************
FUNCTION CONFIRMA(TEXTO)
LOCAL LES,CES,LARGJAN,TELAVELHA
LARGJAN=LEN(TEXTO)+2
IF LARGJAN<16
       ARGJAN=16
ENDIF
CES=(80-LARGJAN)/2
LES=19
TELAVELHA=SAVESCREEN(LES,0,LES+4,79)
CORANTIG=SETCOLOR()
CORNOVA=("W+/R,N/W")
SET COLOR TO &CORNOVA
@ LES,CES CLEAR TO LES+3,CES+LARGJAN
@ LES,CES TO LES+3,CES+LARGJAN DOUBLE
@ LES+1,CES+2 SAY TEXTO
COLUNA=(LARGJAN-9)/2
OP=1
@ LES+2,CES+COLUNA PROMPT "SIM"
@ LES+2,CES+COLUNA+6 PROMPT "NAO"
MENU TO OP
SET COLOR TO &CORANTIG
RESTSCREEN(LES,0,LES+4,79,TELAVELHA)
RETURN (OP) 

*************************/FUN€AO MOSTRATEXTO GARANTIA********************

FUNCTION MOSTEXGAR
SAVE SCREEN TO FTELA
SET CURSOR ON
SETCOLOR("W+/BG,N/W")
@ 02,12 CLEAR TO 22,76
@ 02,12 TO 22,76 DOUBLE
PUVARGA()
IGUAVARGA()
@ 03,13 SAY "Cliente.......:" GET MGARCLI PICT "@!"
@ 06,13 SAY "Vendedor......:" GET MGARVEN PICT "@!"
@ 08,13 SAY "Aplica‡„o.....:" GET MGARPECA PICT "@!"
@ 10,13 SAY "Fabricante....:" GET MGARFABR PICT "@!"
@ 10,40 SAY "N§ Fabricante.:" GET MGARNFAB PICT "@!"
@ 12,13 SAY "Quantidade....:" GET MGARQTD PICT "999"
@ 12,40 SAY "Hora:" GET Mhoragar PICT "99:99"
@ 12,53 SAY "Baixa..:" GET MGARBAIXA PICT "@!"
@ 14,13 SAY "Data Entrega..:" GET MGARDATA PICT"@D"      
@ 14,40 SAY "Fornecedor....:" GET MGARdistr PICT"@!"      
@ 16,13 SAY "Nota fornec...:" GET MGNUMNOTA PICT "@!"
@ 16,40 SAY "VALOR CUSTO..:"  GET MGCUSTO PICT "99999.99"
@ 18,13 SAY "Protocolo.....:" GET MGARPROTO PICT "@!"
@ 18,51 SAY "D.ENVIO:" GET MDATAENVIO PICT "@D"
@ 20,13 SAY "Defeito.......:" GET MGARDEF1 PICT  "@!"
@ 21,29 GET MGARDEF2 PICT  "@!"
RETURN(0)

FUNCTION DBFXLS
******************************************************************
* Exemplo de como criar um arquivo XLS (Excel) a partir de um
* arquivo DBF (VENDAS.DBF).
* Note abaixo que para fazer a divisao das colunas e' usado CHR(9).
* Voce tambem pode utilizar formulas no conteudo das colunas.
* Exemplo 1: 
* "=C2*D2" onde o conteudo da celula C2 sera multiplicado pela celula D2
* 
* o exemplo acima corresponde a
* ( "=C"+LTRIM(STR(v_l,5,0))+"*D"+LTRIM(STR(v_l,5,0)) )
*
* Exemplo 2:
* "=SOMA(C2:C11)"  soma da celula C2 ate C11
*
* o exemplo acima corresponde a
* "=SOMA(C2:C"+LTRIM(STR(v_l,5,0))+")"
* 
* Este exemplo vai criar um arquivo chamado VENDAS.XLS
*
* Para compilar este Exemplo, digite:
* CLIPPER DBFXLS
* RTLINK FI DBFXLS
*
* Site Clipper On Line (www.pctoledo.com.br)
* Autor: Paulo Cesar Toledo (toledo@expressnet.com.br)
*
* P.S.: abra primeiro o EXCEL para depois abrir o arquivo VENDAS.XLS.
*       Se o Assistente de Importacao for aberto, clique no botao
*       Concluir.
******************************************************************
IF ACESSO#1
        RETURN
ENDIF
clientes()
ORDSETFOCUS("NOMECLI")
GOTO TOP
vArq:="C:\VENDAS.XLS"
SET PRINTER TO (vArq)
SET DEVICE TO PRINT
vTit:="=HOJE()"
@ 00,00 SAY vTit
v_l=1
DO WHILE !EOF()
 v_l++
 vValor:=STRTRAN(LTRIM(STR(VALSEMANA,10,2)),'.',',')
 mcod:=str(codcli)
 vLinha:=mcod+chr(9)+nomecli+chr(9)+vValor+chr(9)

 IF VALSEMANA#0
        @ PROW()+1,00 SAY vLinha
 ENDIF
 SKIP
ENDDO
vRod:="TOTAL GERAL ===>>>"
@ PROW()+1,00 SAY vRod
SET PRINTER TO
SET DEVICE TO SCREEN
CLOSE ALL
TONE(400,3)
vMen:="O ARQUIVO VENDAS.XLS FOI CRIADO COM SUCESSO...;"+;
      "ABRA O ARQUIVO NO EXCEL E FA€A AS FORMATA€OES;"+;
      "NECESSARIAS."
ALERT(vMen,,"15/3")
RETURN


**************************************************************************
******************************FORMAS DE PAGAMENTO*************************
FUNCTION FORMPAG
                        @ LIN,05 SAY "----------------------------------"
                        LIN++
                        @ LIN,05 SAY "TOTAL:"
                        @ LIN,12 SAY MPTOTG PICT "99,999.99"
                        IF MPTOTG > 50
                                @ LIN,24 SAY "C/DESC.:"        
                                @ LIN,33 SAY MPTOTG * V_DESC PICT "99,999.99"
                        ENDIF                                                                
                        LIN++
                        LIN++
                        @ LIN,02 SAY "***FORMAS DE PAGAMENTO***"
                        LIN++
                        IF MPTOTG < 50
                             @ LIN,02 SAY "EM DINHEIRO / DEBITO:"
                             @ LIN,24 SAY  MPTOTG PICT "9999.99"
                             LIN++
                        ENDIF
                        IF MPTOTG >=50 
                             @ LIN,02 SAY "EM DINHEIRO / DEBITO:"
                             @ LIN,24 SAY  MPTOTG * V_DESC PICT "9999.99"
                             LIN++
                             IF MPTOTG > 50 .AND. MPTOTG <=100
                                     @ LIN,02 SAY "CARTAO DE CREDITO...:"
                                     @ LIN,24 SAY  MPTOTG PICT "9999.99"
                                     LIN++
                             ENDIF
                             IF MPTOTG > 100 .AND. MPTOTG < 250
                                     @ LIN,02 SAY "NO CARTAO 2X .......:"
                                     @ LIN,24 SAY  MPTOTG/2 PICT "9999.99"
                                     @ LIN,32 SAY "="
                                     @ LIN,34 SAY MPTOTG PICT "9999.99"
                                     LIN++
                             ENDIF                          
                        ENDIF
                        IF MPTOTG>=250 .AND. MPTOTG <400
                             @ LIN,02 SAY "NO CARTAO 3X .......:"
                             @ LIN,24 SAY  MPTOTG/3 PICT "9999.99"
                             @ LIN,32 SAY "="        
                             @ LIN,34 SAY MPTOTG PICT "9999.99"
                             LIN++
                        ENDIF
                        IF MPTOTG >=400 
                             @ LIN,02 SAY "NO CARTAO CREDITO 6X:"
                             @ LIN,24 SAY  MPTOTG / 6 PICT "9999.99"
                             @ LIN,32 SAY "="
                             @ LIN,34 SAY MPTOTG PICT "9999.99"
                             LIN++
                        ENDIF
                        LIN++              
                        @ LIN,03 SAY TOT PICT "99"
                        @ LIN,07 SAY "PRODUTO(S)"
RETURN


*******************IMPRIME E REIMPRIME GARANTIAS*****************************

FUNCTION IMPRI_GAR
            set device to print
            LIN++
            @ LIN,01 SAY PADC("GARANTIA",40)
            LIN=LIN+2                                        
            @ lin,01 SAY PADC(MGARCLI,40)
            LIN=LIN+2                                        
            @ LIN,01 SAY MGARVEN
            @ lin,15 SAY MGARDATA
            @ lin,30 SAY MHORAGAR
            LIN=LIN+2
            @ LIN,01 SAY MGARCOD
            @ LIN,07 SAY LEFT(MGARPECA,30)
            @ LIN,38 SAY MGARQTD PICT "999"
            LIN++
            @ PROW(),00 SAY CHR(27)+CHR(51)
            @ PROW(),00 SAY CHR(27)+CHR(83)
            @ PROW(),00 SAY CHR(27)+CHR(33)
            @ LIN,00 SAY MGARNFAB
            @ LIN,10 SAY MGARFABR
            @ PROW(),00 SAY CHR(27)+CHR(64)
            LIN++
            LIN++
            LIN++
            LIN++
            LIN=LIN+04
            @ LIN,01 SAY " "
            GUILHOTINA()
            SET DEVICE TO SCREEN
            SET KEY -40 TO OTARIOS() // F11
return

FUNCTION CANHOTO
IF ALLTRIM(MNOTPAG) <> "CONVENIO"
                             BLOQUEIO()
                             REPLACE CODNOT  WITH MCODNOT
                             REPLACE NOTPAG  WITH MNOTPAG
                             REPLACE NOTFUNC WITH MNOTFUNC
                             REPLACE NOTCLI  WITH MNOTCLI
                             IF MTROCO>0
                                REPLACE TROCO WITH MTROCO-TOTDESC
                             ENDIF
                             IF MTROCO=0
                                REPLACE TROCO WITH 0
                             ENDIF
                             REPLACE D_NOT   WITH MD_NOT
                             IF DESC1="N"
                                REPLACE NOTTOTG WITH MPTOTG
                                REPLACE NOTDESC  WITH MPTOTG
                             ELSE
                                REPLACE NOTTOTG  WITH MPTOTG
                                REPLACE NOTDESC  WITH TOTDESC
                             ENDIF
                             IF CRED1="S"
                                REPLACE NOTDESC WITH MPTOTG+MABATIMENTO
                                REPLACE NOTTOTG WITH MPTOTG+(TOTDESC-MPTOTG)
                             ENDIF
                             UNLOCK
ENDIF
RETURN

